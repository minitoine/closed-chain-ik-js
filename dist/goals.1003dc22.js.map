{"mappings":"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","sources":["example/goals.js"],"sourcesContent":["import {\n\tWebGLRenderer,\n\tPerspectiveCamera,\n\tColor,\n\tScene,\n\tDirectionalLight,\n\tAmbientLight,\n\tsRGBEncoding,\n\tGroup,\n} from 'three';\nimport {\n\tOrbitControls,\n} from 'three/examples/jsm/controls/OrbitControls.js';\nimport {\n\tTransformControls\n} from 'three/examples/jsm/controls/TransformControls.js';\nimport {\n\tGUI,\n} from 'three/examples/jsm/libs/lil-gui.module.min.js';\nimport Stats from 'three/examples/jsm/libs/stats.module.js';\nimport {\n\tSolver,\n\tLink,\n\tJoint,\n\tIKRootsHelper,\n\tGoal,\n\tDOF,\n\tSOLVE_STATUS_NAMES,\n} from '../src/index.js';\n\nconst params = {\n\tcontrols: 'translate',\n\tsolvePosition: true,\n\tsolveRotation: false,\n};\n\n// TODO: why is the solve stalling so frequently? Only when goal is set with rotation.\n// Matching rotation goal doesn't seem to work.\nconst solverOptions = {\n\tmaxIterations: 3,\n\tdivergeThreshold: 0.005,\n\tstallThreshold: 1e-3,\n\ttranslationErrorClamp: 0.25,\n\trotationErrorClamp: 0.25,\n\ttranslationConvergeThreshold: 1e-3,\n\trotationConvergeThreshold: 1e-3,\n\trestPoseFactor: 0.001,\n};\n\nlet gui, stats;\nlet outputContainer, renderer, scene, camera;\nlet solver, ikHelper, ikRoot, goal;\nlet controls, transformControls, targetObject;\n\ninit();\nrender();\n\nfunction init() {\n\n\tstats = new Stats();\n\tdocument.body.appendChild( stats.dom );\n\n\toutputContainer = document.getElementById( 'output' );\n\n\t// init renderer\n\trenderer = new WebGLRenderer( { antialias: true } );\n\trenderer.setPixelRatio( window.devicePixelRatio );\n\trenderer.setSize( window.innerWidth, window.innerHeight );\n\trenderer.outputEncoding = sRGBEncoding;\n\tdocument.body.appendChild( renderer.domElement );\n\n\tcamera = new PerspectiveCamera( 50, window.innerWidth / window.innerHeight );\n\tcamera.position.set( 8, 8, 8 );\n\n\tscene = new Scene();\n\tscene.background = new Color( 0x131619 );\n\n\tconst directionalLight = new DirectionalLight();\n\tdirectionalLight.position.set( 1, 3, 2 );\n\tscene.add( directionalLight );\n\n\tconst ambientLight = new AmbientLight( 0x263238, 1 );\n\tscene.add( ambientLight );\n\n\tcontrols = new OrbitControls( camera, renderer.domElement );\n\ttransformControls = new TransformControls( camera, renderer.domElement );\n\ttransformControls.setSpace( 'local' );\n\tscene.add( transformControls );\n\n\ttransformControls.addEventListener( 'mouseDown', () => controls.enabled = false );\n\ttransformControls.addEventListener( 'mouseUp', () => controls.enabled = true );\n\n\ttargetObject = new Group();\n\ttargetObject.position.set( 0, 1, 1 );\n\tscene.add( targetObject );\n\ttransformControls.attach( targetObject );\n\n\tikRoot = null;\n\tlet currRoot = null;\n\tfor ( let i = 0; i < 6; i ++ ) {\n\n\t\tconst link = new Link();\n\t\tconst joint = new Joint();\n\t\tjoint.setPosition( 0, 0.5, 0 );\n\t\tjoint.setDoF( i % 2 ? DOF.EX : DOF.EZ );\n\t\tjoint.setDoFValues( Math.PI / 4 );\n\t\tjoint.setRestPoseValues( Math.PI / 4 );\n\t\tjoint.restPoseSet = true;\n\t\tjoint.setMinLimits( - 0.9 * Math.PI );\n\t\tjoint.setMaxLimits( 0.9 * Math.PI );\n\n\t\tlink.addChild( joint );\n\n\t\tif ( currRoot ) {\n\n\t\t\tcurrRoot.addChild( link );\n\n\t\t}\n\n\t\tif ( ikRoot === null ) {\n\n\t\t\tikRoot = link;\n\n\t\t}\n\n\t\tcurrRoot = joint;\n\n\t}\n\n\tconst finalLink = new Link();\n\tfinalLink.setPosition( 0, 0.5, 0 );\n\tcurrRoot.addChild( finalLink );\n\n\tikRoot.updateMatrixWorld( true );\n\ttargetObject.matrix.set( ...finalLink.matrixWorld ).transpose();\n\ttargetObject.matrix\n\t\t.decompose( targetObject.position, targetObject.quaternion, targetObject.scale );\n\n\t// TODO: rotation seems not to work here\n\tgoal = new Goal();\n\tgoal.makeClosure( finalLink );\n\n\tikHelper = new IKRootsHelper( ikRoot );\n\tikHelper.setResolution( window.innerWidth, window.innerHeight );\n\tikHelper.traverse( c => {\n\n\t\tif ( c.material ) {\n\n\t\t\tc.material.color.set( 0xe91e63 ).convertSRGBToLinear();\n\n\t\t}\n\n\t} );\n\tscene.add( ikHelper );\n\n\tsolver = new Solver( ikRoot );\n\tObject.assign( solver, solverOptions );\n\n\tfunction updateGoalDoF() {\n\n\t\tconst dof = [];\n\t\tif ( params.solvePosition ) {\n\n\t\t\tdof.push( DOF.X, DOF.Y, DOF.Z );\n\n\t\t}\n\n\t\tif ( params.solveRotation ) {\n\n\t\t\tdof.push( DOF.EX, DOF.EY, DOF.EZ );\n\n\t\t}\n\n\t\tgoal.setGoalDoF( ...dof );\n\n\t}\n\n\tupdateGoalDoF();\n\n\tgui = new GUI();\n\tgui.width = 350;\n\tgui.add( params, 'controls', [ 'rotate', 'translate' ] ).listen().onChange( v => {\n\n\t\ttransformControls.setMode( v );\n\n\t} );\n\tgui.add( params, 'solvePosition' ).onChange( updateGoalDoF );\n\tgui.add( params, 'solveRotation' ).onChange( updateGoalDoF );\n\n\n\ttransformControls.addEventListener( 'mouseUp', () => {\n\n\t\tikRoot.updateMatrixWorld( true );\n\t\ttargetObject.matrix.set( ...finalLink.matrixWorld ).transpose();\n\t\ttargetObject.matrix\n\t\t\t.decompose( targetObject.position, targetObject.quaternion, targetObject.scale );\n\n\t} );\n\n\twindow.addEventListener( 'resize', () => {\n\n\t\tconst w = window.innerWidth;\n\t\tconst h = window.innerHeight;\n\t\tconst aspect = w / h;\n\n\t\trenderer.setSize( w, h );\n\n\t\tcamera.aspect = aspect;\n\t\tcamera.updateProjectionMatrix();\n\n\t\tikHelper.setResolution( window.innerWidth, window.innerHeight );\n\n\t} );\n\n\twindow.addEventListener( 'keydown', e => {\n\n\t\tswitch ( e.key ) {\n\n\t\t\tcase 'w':\n\t\t\t\ttransformControls.setMode( 'translate' );\n\t\t\t\tparams.controls = 'translate';\n\t\t\t\tbreak;\n\t\t\tcase 'e':\n\t\t\t\ttransformControls.setMode( 'rotate' );\n\t\t\t\tparams.controls = 'rotate';\n\t\t\t\tbreak;\n\t\t\tcase 'f':\n\t\t\t\tcontrols.target.set( 0, 0, 0 );\n\t\t\t\tcontrols.update();\n\t\t\t\tbreak;\n\n\t\t}\n\n\t} );\n\n}\n\nfunction render() {\n\n\trequestAnimationFrame( render );\n\n\tgoal.setPosition(\n\t\ttargetObject.position.x,\n\t\ttargetObject.position.y,\n\t\ttargetObject.position.z,\n\t);\n\tgoal.setQuaternion(\n\t\ttargetObject.quaternion.x,\n\t\ttargetObject.quaternion.y,\n\t\ttargetObject.quaternion.z,\n\t\ttargetObject.quaternion.w,\n\t);\n\n\toutputContainer.textContent = solver.solve().map( s => SOLVE_STATUS_NAMES[ s ] ).join( '\\n' );\n\n\trenderer.render( scene, camera );\n\tstats.update();\n\n}\n"],"names":["$0ebc7c3f4b9f066a$var$params","controls","solvePosition","solveRotation","$0ebc7c3f4b9f066a$var$solverOptions","maxIterations","divergeThreshold","stallThreshold","translationErrorClamp","rotationErrorClamp","translationConvergeThreshold","rotationConvergeThreshold","restPoseFactor","$0ebc7c3f4b9f066a$var$gui","$0ebc7c3f4b9f066a$var$stats","$0ebc7c3f4b9f066a$var$outputContainer","$0ebc7c3f4b9f066a$var$renderer","$0ebc7c3f4b9f066a$var$scene","$0ebc7c3f4b9f066a$var$camera","$0ebc7c3f4b9f066a$var$solver","$0ebc7c3f4b9f066a$var$ikHelper","$0ebc7c3f4b9f066a$var$ikRoot","$0ebc7c3f4b9f066a$var$goal","$0ebc7c3f4b9f066a$var$controls","$0ebc7c3f4b9f066a$var$transformControls","$0ebc7c3f4b9f066a$var$targetObject","$7MGRS","default","document","body","appendChild","dom","getElementById","$ilwiq","WebGLRenderer","antialias","setPixelRatio","window","devicePixelRatio","setSize","innerWidth","innerHeight","outputEncoding","sRGBEncoding","domElement","PerspectiveCamera","position","set","Scene","background","Color","directionalLight","DirectionalLight","add","ambientLight","AmbientLight","$5Rd1x","OrbitControls","$fUhpq","TransformControls","setSpace","addEventListener","enabled","Group","attach","currRoot","i","link","$4CEV9","Link","joint","Joint","setPosition","setDoF","DOF","EX","EZ","setDoFValues","Math","PI","setRestPoseValues","restPoseSet","setMinLimits","setMaxLimits","addChild","finalLink","updateGoalDoF","dof","push","X","Y","Z","EY","setGoalDoF","updateMatrixWorld","matrix","matrixWorld","transpose","decompose","quaternion","scale","Goal","makeClosure","IKRootsHelper","setResolution","traverse","c","material","color","convertSRGBToLinear","Solver","Object","assign","$jiuw3","GUI","width","listen","onChange","v","setMode","w","h","aspect","updateProjectionMatrix","e","key","target","update","$0ebc7c3f4b9f066a$var$init","$0ebc7c3f4b9f066a$var$render","requestAnimationFrame","x","y","z","setQuaternion","textContent","solve","map","s","SOLVE_STATUS_NAMES","join","render"],"version":3,"file":"goals.1003dc22.js.map"}