(()=>{var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};function r(t,r,e,o){Object.defineProperty(t,r,{get:e,set:o,enumerable:!0,configurable:!0})}function e(t){return t&&t.__esModule?t.default:t}var o={};r(o,"create",(()=>s)),r(o,"clone",(()=>l)),r(o,"copy",(()=>h)),r(o,"fromValues",(()=>u)),r(o,"set",(()=>c)),r(o,"identity",(()=>f)),r(o,"transpose",(()=>d)),r(o,"invert",(()=>M)),r(o,"adjoint",(()=>m)),r(o,"determinant",(()=>g)),r(o,"multiply",(()=>p)),r(o,"translate",(()=>v)),r(o,"scale",(()=>F)),r(o,"rotate",(()=>x)),r(o,"rotateX",(()=>w)),r(o,"rotateY",(()=>y)),r(o,"rotateZ",(()=>b)),r(o,"fromTranslation",(()=>E)),r(o,"fromScaling",(()=>D)),r(o,"fromRotation",(()=>C)),r(o,"fromXRotation",(()=>A)),r(o,"fromYRotation",(()=>T)),r(o,"fromZRotation",(()=>V)),r(o,"fromRotationTranslation",(()=>P)),r(o,"fromQuat2",(()=>S)),r(o,"getTranslation",(()=>W)),r(o,"getScaling",(()=>q)),r(o,"getRotation",(()=>J)),r(o,"fromRotationTranslationScale",(()=>L)),r(o,"fromRotationTranslationScaleOrigin",(()=>N)),r(o,"fromQuat",(()=>R)),r(o,"frustum",(()=>U)),r(o,"perspectiveNO",(()=>k)),r(o,"perspective",(()=>I)),r(o,"perspectiveZO",(()=>_)),r(o,"perspectiveFromFieldOfView",(()=>Z)),r(o,"orthoNO",(()=>X)),r(o,"ortho",(()=>Y)),r(o,"orthoZO",(()=>O)),r(o,"lookAt",(()=>Q)),r(o,"targetTo",(()=>G)),r(o,"str",(()=>j)),r(o,"frob",(()=>z)),r(o,"add",(()=>B)),r(o,"subtract",(()=>H)),r(o,"multiplyScalar",(()=>K)),r(o,"multiplyScalarAndAdd",(()=>$)),r(o,"exactEquals",(()=>tt)),r(o,"equals",(()=>rt)),r(o,"mul",(()=>et)),r(o,"sub",(()=>ot));var n=1e-6,a="undefined"!=typeof Float32Array?Float32Array:Array,i=Math.random;Math.PI;function s(){var t=new a(16);return a!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function l(t){var r=new a(16);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function h(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t}function u(t,r,e,o,n,i,s,l,h,u,c,f,d,M,m,g){var p=new a(16);return p[0]=t,p[1]=r,p[2]=e,p[3]=o,p[4]=n,p[5]=i,p[6]=s,p[7]=l,p[8]=h,p[9]=u,p[10]=c,p[11]=f,p[12]=d,p[13]=M,p[14]=m,p[15]=g,p}function c(t,r,e,o,n,a,i,s,l,h,u,c,f,d,M,m,g){return t[0]=r,t[1]=e,t[2]=o,t[3]=n,t[4]=a,t[5]=i,t[6]=s,t[7]=l,t[8]=h,t[9]=u,t[10]=c,t[11]=f,t[12]=d,t[13]=M,t[14]=m,t[15]=g,t}function f(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function d(t,r){if(t===r){var e=r[1],o=r[2],n=r[3],a=r[6],i=r[7],s=r[11];t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=e,t[6]=r[9],t[7]=r[13],t[8]=o,t[9]=a,t[11]=r[14],t[12]=n,t[13]=i,t[14]=s}else t[0]=r[0],t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=r[1],t[5]=r[5],t[6]=r[9],t[7]=r[13],t[8]=r[2],t[9]=r[6],t[10]=r[10],t[11]=r[14],t[12]=r[3],t[13]=r[7],t[14]=r[11],t[15]=r[15];return t}function M(t,r){var e=r[0],o=r[1],n=r[2],a=r[3],i=r[4],s=r[5],l=r[6],h=r[7],u=r[8],c=r[9],f=r[10],d=r[11],M=r[12],m=r[13],g=r[14],p=r[15],v=e*s-o*i,F=e*l-n*i,x=e*h-a*i,w=o*l-n*s,y=o*h-a*s,b=n*h-a*l,E=u*m-c*M,D=u*g-f*M,C=u*p-d*M,A=c*g-f*m,T=c*p-d*m,V=f*p-d*g,P=v*V-F*T+x*A+w*C-y*D+b*E;return P?(P=1/P,t[0]=(s*V-l*T+h*A)*P,t[1]=(n*T-o*V-a*A)*P,t[2]=(m*b-g*y+p*w)*P,t[3]=(f*y-c*b-d*w)*P,t[4]=(l*C-i*V-h*D)*P,t[5]=(e*V-n*C+a*D)*P,t[6]=(g*x-M*b-p*F)*P,t[7]=(u*b-f*x+d*F)*P,t[8]=(i*T-s*C+h*E)*P,t[9]=(o*C-e*T-a*E)*P,t[10]=(M*y-m*x+p*v)*P,t[11]=(c*x-u*y-d*v)*P,t[12]=(s*D-i*A-l*E)*P,t[13]=(e*A-o*D+n*E)*P,t[14]=(m*F-M*w-g*v)*P,t[15]=(u*w-c*F+f*v)*P,t):null}function m(t,r){var e=r[0],o=r[1],n=r[2],a=r[3],i=r[4],s=r[5],l=r[6],h=r[7],u=r[8],c=r[9],f=r[10],d=r[11],M=r[12],m=r[13],g=r[14],p=r[15];return t[0]=s*(f*p-d*g)-c*(l*p-h*g)+m*(l*d-h*f),t[1]=-(o*(f*p-d*g)-c*(n*p-a*g)+m*(n*d-a*f)),t[2]=o*(l*p-h*g)-s*(n*p-a*g)+m*(n*h-a*l),t[3]=-(o*(l*d-h*f)-s*(n*d-a*f)+c*(n*h-a*l)),t[4]=-(i*(f*p-d*g)-u*(l*p-h*g)+M*(l*d-h*f)),t[5]=e*(f*p-d*g)-u*(n*p-a*g)+M*(n*d-a*f),t[6]=-(e*(l*p-h*g)-i*(n*p-a*g)+M*(n*h-a*l)),t[7]=e*(l*d-h*f)-i*(n*d-a*f)+u*(n*h-a*l),t[8]=i*(c*p-d*m)-u*(s*p-h*m)+M*(s*d-h*c),t[9]=-(e*(c*p-d*m)-u*(o*p-a*m)+M*(o*d-a*c)),t[10]=e*(s*p-h*m)-i*(o*p-a*m)+M*(o*h-a*s),t[11]=-(e*(s*d-h*c)-i*(o*d-a*c)+u*(o*h-a*s)),t[12]=-(i*(c*g-f*m)-u*(s*g-l*m)+M*(s*f-l*c)),t[13]=e*(c*g-f*m)-u*(o*g-n*m)+M*(o*f-n*c),t[14]=-(e*(s*g-l*m)-i*(o*g-n*m)+M*(o*l-n*s)),t[15]=e*(s*f-l*c)-i*(o*f-n*c)+u*(o*l-n*s),t}function g(t){var r=t[0],e=t[1],o=t[2],n=t[3],a=t[4],i=t[5],s=t[6],l=t[7],h=t[8],u=t[9],c=t[10],f=t[11],d=t[12],M=t[13],m=t[14],g=t[15];return(r*i-e*a)*(c*g-f*m)-(r*s-o*a)*(u*g-f*M)+(r*l-n*a)*(u*m-c*M)+(e*s-o*i)*(h*g-f*d)-(e*l-n*i)*(h*m-c*d)+(o*l-n*s)*(h*M-u*d)}function p(t,r,e){var o=r[0],n=r[1],a=r[2],i=r[3],s=r[4],l=r[5],h=r[6],u=r[7],c=r[8],f=r[9],d=r[10],M=r[11],m=r[12],g=r[13],p=r[14],v=r[15],F=e[0],x=e[1],w=e[2],y=e[3];return t[0]=F*o+x*s+w*c+y*m,t[1]=F*n+x*l+w*f+y*g,t[2]=F*a+x*h+w*d+y*p,t[3]=F*i+x*u+w*M+y*v,F=e[4],x=e[5],w=e[6],y=e[7],t[4]=F*o+x*s+w*c+y*m,t[5]=F*n+x*l+w*f+y*g,t[6]=F*a+x*h+w*d+y*p,t[7]=F*i+x*u+w*M+y*v,F=e[8],x=e[9],w=e[10],y=e[11],t[8]=F*o+x*s+w*c+y*m,t[9]=F*n+x*l+w*f+y*g,t[10]=F*a+x*h+w*d+y*p,t[11]=F*i+x*u+w*M+y*v,F=e[12],x=e[13],w=e[14],y=e[15],t[12]=F*o+x*s+w*c+y*m,t[13]=F*n+x*l+w*f+y*g,t[14]=F*a+x*h+w*d+y*p,t[15]=F*i+x*u+w*M+y*v,t}function v(t,r,e){var o,n,a,i,s,l,h,u,c,f,d,M,m=e[0],g=e[1],p=e[2];return r===t?(t[12]=r[0]*m+r[4]*g+r[8]*p+r[12],t[13]=r[1]*m+r[5]*g+r[9]*p+r[13],t[14]=r[2]*m+r[6]*g+r[10]*p+r[14],t[15]=r[3]*m+r[7]*g+r[11]*p+r[15]):(o=r[0],n=r[1],a=r[2],i=r[3],s=r[4],l=r[5],h=r[6],u=r[7],c=r[8],f=r[9],d=r[10],M=r[11],t[0]=o,t[1]=n,t[2]=a,t[3]=i,t[4]=s,t[5]=l,t[6]=h,t[7]=u,t[8]=c,t[9]=f,t[10]=d,t[11]=M,t[12]=o*m+s*g+c*p+r[12],t[13]=n*m+l*g+f*p+r[13],t[14]=a*m+h*g+d*p+r[14],t[15]=i*m+u*g+M*p+r[15]),t}function F(t,r,e){var o=e[0],n=e[1],a=e[2];return t[0]=r[0]*o,t[1]=r[1]*o,t[2]=r[2]*o,t[3]=r[3]*o,t[4]=r[4]*n,t[5]=r[5]*n,t[6]=r[6]*n,t[7]=r[7]*n,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=r[11]*a,t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t}function x(t,r,e,o){var a,i,s,l,h,u,c,f,d,M,m,g,p,v,F,x,w,y,b,E,D,C,A,T,V=o[0],P=o[1],S=o[2],W=Math.hypot(V,P,S);return W<n?null:(V*=W=1/W,P*=W,S*=W,a=Math.sin(e),s=1-(i=Math.cos(e)),l=r[0],h=r[1],u=r[2],c=r[3],f=r[4],d=r[5],M=r[6],m=r[7],g=r[8],p=r[9],v=r[10],F=r[11],x=V*V*s+i,w=P*V*s+S*a,y=S*V*s-P*a,b=V*P*s-S*a,E=P*P*s+i,D=S*P*s+V*a,C=V*S*s+P*a,A=P*S*s-V*a,T=S*S*s+i,t[0]=l*x+f*w+g*y,t[1]=h*x+d*w+p*y,t[2]=u*x+M*w+v*y,t[3]=c*x+m*w+F*y,t[4]=l*b+f*E+g*D,t[5]=h*b+d*E+p*D,t[6]=u*b+M*E+v*D,t[7]=c*b+m*E+F*D,t[8]=l*C+f*A+g*T,t[9]=h*C+d*A+p*T,t[10]=u*C+M*A+v*T,t[11]=c*C+m*A+F*T,r!==t&&(t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t)}function w(t,r,e){var o=Math.sin(e),n=Math.cos(e),a=r[4],i=r[5],s=r[6],l=r[7],h=r[8],u=r[9],c=r[10],f=r[11];return r!==t&&(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[4]=a*n+h*o,t[5]=i*n+u*o,t[6]=s*n+c*o,t[7]=l*n+f*o,t[8]=h*n-a*o,t[9]=u*n-i*o,t[10]=c*n-s*o,t[11]=f*n-l*o,t}function y(t,r,e){var o=Math.sin(e),n=Math.cos(e),a=r[0],i=r[1],s=r[2],l=r[3],h=r[8],u=r[9],c=r[10],f=r[11];return r!==t&&(t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=a*n-h*o,t[1]=i*n-u*o,t[2]=s*n-c*o,t[3]=l*n-f*o,t[8]=a*o+h*n,t[9]=i*o+u*n,t[10]=s*o+c*n,t[11]=l*o+f*n,t}function b(t,r,e){var o=Math.sin(e),n=Math.cos(e),a=r[0],i=r[1],s=r[2],l=r[3],h=r[4],u=r[5],c=r[6],f=r[7];return r!==t&&(t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=a*n+h*o,t[1]=i*n+u*o,t[2]=s*n+c*o,t[3]=l*n+f*o,t[4]=h*n-a*o,t[5]=u*n-i*o,t[6]=c*n-s*o,t[7]=f*n-l*o,t}function E(t,r){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function D(t,r){return t[0]=r[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=r[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function C(t,r,e){var o,a,i,s=e[0],l=e[1],h=e[2],u=Math.hypot(s,l,h);return u<n?null:(s*=u=1/u,l*=u,h*=u,o=Math.sin(r),i=1-(a=Math.cos(r)),t[0]=s*s*i+a,t[1]=l*s*i+h*o,t[2]=h*s*i-l*o,t[3]=0,t[4]=s*l*i-h*o,t[5]=l*l*i+a,t[6]=h*l*i+s*o,t[7]=0,t[8]=s*h*i+l*o,t[9]=l*h*i-s*o,t[10]=h*h*i+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function A(t,r){var e=Math.sin(r),o=Math.cos(r);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=e,t[7]=0,t[8]=0,t[9]=-e,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function T(t,r){var e=Math.sin(r),o=Math.cos(r);return t[0]=o,t[1]=0,t[2]=-e,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=e,t[9]=0,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function V(t,r){var e=Math.sin(r),o=Math.cos(r);return t[0]=o,t[1]=e,t[2]=0,t[3]=0,t[4]=-e,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function P(t,r,e){var o=r[0],n=r[1],a=r[2],i=r[3],s=o+o,l=n+n,h=a+a,u=o*s,c=o*l,f=o*h,d=n*l,M=n*h,m=a*h,g=i*s,p=i*l,v=i*h;return t[0]=1-(d+m),t[1]=c+v,t[2]=f-p,t[3]=0,t[4]=c-v,t[5]=1-(u+m),t[6]=M+g,t[7]=0,t[8]=f+p,t[9]=M-g,t[10]=1-(u+d),t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function S(t,r){var e=new a(3),o=-r[0],n=-r[1],i=-r[2],s=r[3],l=r[4],h=r[5],u=r[6],c=r[7],f=o*o+n*n+i*i+s*s;return f>0?(e[0]=2*(l*s+c*o+h*i-u*n)/f,e[1]=2*(h*s+c*n+u*o-l*i)/f,e[2]=2*(u*s+c*i+l*n-h*o)/f):(e[0]=2*(l*s+c*o+h*i-u*n),e[1]=2*(h*s+c*n+u*o-l*i),e[2]=2*(u*s+c*i+l*n-h*o)),P(t,r,e),t}function W(t,r){return t[0]=r[12],t[1]=r[13],t[2]=r[14],t}function q(t,r){var e=r[0],o=r[1],n=r[2],a=r[4],i=r[5],s=r[6],l=r[8],h=r[9],u=r[10];return t[0]=Math.hypot(e,o,n),t[1]=Math.hypot(a,i,s),t[2]=Math.hypot(l,h,u),t}function J(t,r){var e=new a(3);q(e,r);var o=1/e[0],n=1/e[1],i=1/e[2],s=r[0]*o,l=r[1]*n,h=r[2]*i,u=r[4]*o,c=r[5]*n,f=r[6]*i,d=r[8]*o,M=r[9]*n,m=r[10]*i,g=s+c+m,p=0;return g>0?(p=2*Math.sqrt(g+1),t[3]=.25*p,t[0]=(f-M)/p,t[1]=(d-h)/p,t[2]=(l-u)/p):s>c&&s>m?(p=2*Math.sqrt(1+s-c-m),t[3]=(f-M)/p,t[0]=.25*p,t[1]=(l+u)/p,t[2]=(d+h)/p):c>m?(p=2*Math.sqrt(1+c-s-m),t[3]=(d-h)/p,t[0]=(l+u)/p,t[1]=.25*p,t[2]=(f+M)/p):(p=2*Math.sqrt(1+m-s-c),t[3]=(l-u)/p,t[0]=(d+h)/p,t[1]=(f+M)/p,t[2]=.25*p),t}function L(t,r,e,o){var n=r[0],a=r[1],i=r[2],s=r[3],l=n+n,h=a+a,u=i+i,c=n*l,f=n*h,d=n*u,M=a*h,m=a*u,g=i*u,p=s*l,v=s*h,F=s*u,x=o[0],w=o[1],y=o[2];return t[0]=(1-(M+g))*x,t[1]=(f+F)*x,t[2]=(d-v)*x,t[3]=0,t[4]=(f-F)*w,t[5]=(1-(c+g))*w,t[6]=(m+p)*w,t[7]=0,t[8]=(d+v)*y,t[9]=(m-p)*y,t[10]=(1-(c+M))*y,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function N(t,r,e,o,n){var a=r[0],i=r[1],s=r[2],l=r[3],h=a+a,u=i+i,c=s+s,f=a*h,d=a*u,M=a*c,m=i*u,g=i*c,p=s*c,v=l*h,F=l*u,x=l*c,w=o[0],y=o[1],b=o[2],E=n[0],D=n[1],C=n[2],A=(1-(m+p))*w,T=(d+x)*w,V=(M-F)*w,P=(d-x)*y,S=(1-(f+p))*y,W=(g+v)*y,q=(M+F)*b,J=(g-v)*b,L=(1-(f+m))*b;return t[0]=A,t[1]=T,t[2]=V,t[3]=0,t[4]=P,t[5]=S,t[6]=W,t[7]=0,t[8]=q,t[9]=J,t[10]=L,t[11]=0,t[12]=e[0]+E-(A*E+P*D+q*C),t[13]=e[1]+D-(T*E+S*D+J*C),t[14]=e[2]+C-(V*E+W*D+L*C),t[15]=1,t}function R(t,r){var e=r[0],o=r[1],n=r[2],a=r[3],i=e+e,s=o+o,l=n+n,h=e*i,u=o*i,c=o*s,f=n*i,d=n*s,M=n*l,m=a*i,g=a*s,p=a*l;return t[0]=1-c-M,t[1]=u+p,t[2]=f-g,t[3]=0,t[4]=u-p,t[5]=1-h-M,t[6]=d+m,t[7]=0,t[8]=f+g,t[9]=d-m,t[10]=1-h-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function U(t,r,e,o,n,a,i){var s=1/(e-r),l=1/(n-o),h=1/(a-i);return t[0]=2*a*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*l,t[6]=0,t[7]=0,t[8]=(e+r)*s,t[9]=(n+o)*l,t[10]=(i+a)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=i*a*2*h,t[15]=0,t}function k(t,r,e,o,n){var a,i=1/Math.tan(r/2);return t[0]=i/e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(a=1/(o-n),t[10]=(n+o)*a,t[14]=2*n*o*a):(t[10]=-1,t[14]=-2*o),t}Math.hypot||(Math.hypot=function(){for(var t=0,r=arguments.length;r--;)t+=arguments[r]*arguments[r];return Math.sqrt(t)});var I=k;function _(t,r,e,o,n){var a,i=1/Math.tan(r/2);return t[0]=i/e,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(a=1/(o-n),t[10]=n*a,t[14]=n*o*a):(t[10]=-1,t[14]=-o),t}function Z(t,r,e,o){var n=Math.tan(r.upDegrees*Math.PI/180),a=Math.tan(r.downDegrees*Math.PI/180),i=Math.tan(r.leftDegrees*Math.PI/180),s=Math.tan(r.rightDegrees*Math.PI/180),l=2/(i+s),h=2/(n+a);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=-(i-s)*l*.5,t[9]=(n-a)*h*.5,t[10]=o/(e-o),t[11]=-1,t[12]=0,t[13]=0,t[14]=o*e/(e-o),t[15]=0,t}function X(t,r,e,o,n,a,i){var s=1/(r-e),l=1/(o-n),h=1/(a-i);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(r+e)*s,t[13]=(n+o)*l,t[14]=(i+a)*h,t[15]=1,t}var Y=X;function O(t,r,e,o,n,a,i){var s=1/(r-e),l=1/(o-n),h=1/(a-i);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=h,t[11]=0,t[12]=(r+e)*s,t[13]=(n+o)*l,t[14]=a*h,t[15]=1,t}function Q(t,r,e,o){var a,i,s,l,h,u,c,d,M,m,g=r[0],p=r[1],v=r[2],F=o[0],x=o[1],w=o[2],y=e[0],b=e[1],E=e[2];return Math.abs(g-y)<n&&Math.abs(p-b)<n&&Math.abs(v-E)<n?f(t):(c=g-y,d=p-b,M=v-E,a=x*(M*=m=1/Math.hypot(c,d,M))-w*(d*=m),i=w*(c*=m)-F*M,s=F*d-x*c,(m=Math.hypot(a,i,s))?(a*=m=1/m,i*=m,s*=m):(a=0,i=0,s=0),l=d*s-M*i,h=M*a-c*s,u=c*i-d*a,(m=Math.hypot(l,h,u))?(l*=m=1/m,h*=m,u*=m):(l=0,h=0,u=0),t[0]=a,t[1]=l,t[2]=c,t[3]=0,t[4]=i,t[5]=h,t[6]=d,t[7]=0,t[8]=s,t[9]=u,t[10]=M,t[11]=0,t[12]=-(a*g+i*p+s*v),t[13]=-(l*g+h*p+u*v),t[14]=-(c*g+d*p+M*v),t[15]=1,t)}function G(t,r,e,o){var n=r[0],a=r[1],i=r[2],s=o[0],l=o[1],h=o[2],u=n-e[0],c=a-e[1],f=i-e[2],d=u*u+c*c+f*f;d>0&&(u*=d=1/Math.sqrt(d),c*=d,f*=d);var M=l*f-h*c,m=h*u-s*f,g=s*c-l*u;return(d=M*M+m*m+g*g)>0&&(M*=d=1/Math.sqrt(d),m*=d,g*=d),t[0]=M,t[1]=m,t[2]=g,t[3]=0,t[4]=c*g-f*m,t[5]=f*M-u*g,t[6]=u*m-c*M,t[7]=0,t[8]=u,t[9]=c,t[10]=f,t[11]=0,t[12]=n,t[13]=a,t[14]=i,t[15]=1,t}function j(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function z(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function B(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t[2]=r[2]+e[2],t[3]=r[3]+e[3],t[4]=r[4]+e[4],t[5]=r[5]+e[5],t[6]=r[6]+e[6],t[7]=r[7]+e[7],t[8]=r[8]+e[8],t[9]=r[9]+e[9],t[10]=r[10]+e[10],t[11]=r[11]+e[11],t[12]=r[12]+e[12],t[13]=r[13]+e[13],t[14]=r[14]+e[14],t[15]=r[15]+e[15],t}function H(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t[2]=r[2]-e[2],t[3]=r[3]-e[3],t[4]=r[4]-e[4],t[5]=r[5]-e[5],t[6]=r[6]-e[6],t[7]=r[7]-e[7],t[8]=r[8]-e[8],t[9]=r[9]-e[9],t[10]=r[10]-e[10],t[11]=r[11]-e[11],t[12]=r[12]-e[12],t[13]=r[13]-e[13],t[14]=r[14]-e[14],t[15]=r[15]-e[15],t}function K(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t[3]=r[3]*e,t[4]=r[4]*e,t[5]=r[5]*e,t[6]=r[6]*e,t[7]=r[7]*e,t[8]=r[8]*e,t[9]=r[9]*e,t[10]=r[10]*e,t[11]=r[11]*e,t[12]=r[12]*e,t[13]=r[13]*e,t[14]=r[14]*e,t[15]=r[15]*e,t}function $(t,r,e,o){return t[0]=r[0]+e[0]*o,t[1]=r[1]+e[1]*o,t[2]=r[2]+e[2]*o,t[3]=r[3]+e[3]*o,t[4]=r[4]+e[4]*o,t[5]=r[5]+e[5]*o,t[6]=r[6]+e[6]*o,t[7]=r[7]+e[7]*o,t[8]=r[8]+e[8]*o,t[9]=r[9]+e[9]*o,t[10]=r[10]+e[10]*o,t[11]=r[11]+e[11]*o,t[12]=r[12]+e[12]*o,t[13]=r[13]+e[13]*o,t[14]=r[14]+e[14]*o,t[15]=r[15]+e[15]*o,t}function tt(t,r){return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]&&t[3]===r[3]&&t[4]===r[4]&&t[5]===r[5]&&t[6]===r[6]&&t[7]===r[7]&&t[8]===r[8]&&t[9]===r[9]&&t[10]===r[10]&&t[11]===r[11]&&t[12]===r[12]&&t[13]===r[13]&&t[14]===r[14]&&t[15]===r[15]}function rt(t,r){var e=t[0],o=t[1],a=t[2],i=t[3],s=t[4],l=t[5],h=t[6],u=t[7],c=t[8],f=t[9],d=t[10],M=t[11],m=t[12],g=t[13],p=t[14],v=t[15],F=r[0],x=r[1],w=r[2],y=r[3],b=r[4],E=r[5],D=r[6],C=r[7],A=r[8],T=r[9],V=r[10],P=r[11],S=r[12],W=r[13],q=r[14],J=r[15];return Math.abs(e-F)<=n*Math.max(1,Math.abs(e),Math.abs(F))&&Math.abs(o-x)<=n*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-w)<=n*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(i-y)<=n*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(s-b)<=n*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(l-E)<=n*Math.max(1,Math.abs(l),Math.abs(E))&&Math.abs(h-D)<=n*Math.max(1,Math.abs(h),Math.abs(D))&&Math.abs(u-C)<=n*Math.max(1,Math.abs(u),Math.abs(C))&&Math.abs(c-A)<=n*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(f-T)<=n*Math.max(1,Math.abs(f),Math.abs(T))&&Math.abs(d-V)<=n*Math.max(1,Math.abs(d),Math.abs(V))&&Math.abs(M-P)<=n*Math.max(1,Math.abs(M),Math.abs(P))&&Math.abs(m-S)<=n*Math.max(1,Math.abs(m),Math.abs(S))&&Math.abs(g-W)<=n*Math.max(1,Math.abs(g),Math.abs(W))&&Math.abs(p-q)<=n*Math.max(1,Math.abs(p),Math.abs(q))&&Math.abs(v-J)<=n*Math.max(1,Math.abs(v),Math.abs(J))}var et=p,ot=H,nt={};r(nt,"create",(()=>Xr)),r(nt,"identity",(()=>Yr)),r(nt,"setAxisAngle",(()=>Or)),r(nt,"getAxisAngle",(()=>Qr)),r(nt,"getAngle",(()=>Gr)),r(nt,"dot",(()=>be)),r(nt,"multiply",(()=>jr)),r(nt,"rotateX",(()=>zr)),r(nt,"rotateY",(()=>Br)),r(nt,"rotateZ",(()=>Hr)),r(nt,"calculateW",(()=>Kr)),r(nt,"exp",(()=>$r)),r(nt,"ln",(()=>te)),r(nt,"pow",(()=>re)),r(nt,"scale",(()=>ye)),r(nt,"slerp",(()=>ee)),r(nt,"random",(()=>oe)),r(nt,"invert",(()=>ne)),r(nt,"conjugate",(()=>ae)),r(nt,"fromMat3",(()=>ie)),r(nt,"fromEuler",(()=>se)),r(nt,"str",(()=>le)),r(nt,"clone",(()=>ge)),r(nt,"fromValues",(()=>pe)),r(nt,"copy",(()=>ve)),r(nt,"set",(()=>Fe)),r(nt,"add",(()=>xe)),r(nt,"mul",(()=>we)),r(nt,"lerp",(()=>Ee)),r(nt,"length",(()=>De)),r(nt,"len",(()=>Ce)),r(nt,"squaredLength",(()=>Ae)),r(nt,"sqrLen",(()=>Te)),r(nt,"normalize",(()=>Ve)),r(nt,"exactEquals",(()=>Pe)),r(nt,"equals",(()=>Se)),r(nt,"rotationTo",(()=>We)),r(nt,"sqlerp",(()=>qe)),r(nt,"setAxes",(()=>Je));var at={};function it(){var t=new a(3);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function st(t){var r=new a(3);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r}function lt(t){var r=t[0],e=t[1],o=t[2];return Math.hypot(r,e,o)}function ht(t,r,e){var o=new a(3);return o[0]=t,o[1]=r,o[2]=e,o}function ut(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t}function ct(t,r,e,o){return t[0]=r,t[1]=e,t[2]=o,t}function ft(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t[2]=r[2]+e[2],t}function dt(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t[2]=r[2]-e[2],t}function Mt(t,r,e){return t[0]=r[0]*e[0],t[1]=r[1]*e[1],t[2]=r[2]*e[2],t}function mt(t,r,e){return t[0]=r[0]/e[0],t[1]=r[1]/e[1],t[2]=r[2]/e[2],t}function gt(t,r){return t[0]=Math.ceil(r[0]),t[1]=Math.ceil(r[1]),t[2]=Math.ceil(r[2]),t}function pt(t,r){return t[0]=Math.floor(r[0]),t[1]=Math.floor(r[1]),t[2]=Math.floor(r[2]),t}function vt(t,r,e){return t[0]=Math.min(r[0],e[0]),t[1]=Math.min(r[1],e[1]),t[2]=Math.min(r[2],e[2]),t}function Ft(t,r,e){return t[0]=Math.max(r[0],e[0]),t[1]=Math.max(r[1],e[1]),t[2]=Math.max(r[2],e[2]),t}function xt(t,r){return t[0]=Math.round(r[0]),t[1]=Math.round(r[1]),t[2]=Math.round(r[2]),t}function wt(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t}function yt(t,r,e,o){return t[0]=r[0]+e[0]*o,t[1]=r[1]+e[1]*o,t[2]=r[2]+e[2]*o,t}function bt(t,r){var e=r[0]-t[0],o=r[1]-t[1],n=r[2]-t[2];return Math.hypot(e,o,n)}function Et(t,r){var e=r[0]-t[0],o=r[1]-t[1],n=r[2]-t[2];return e*e+o*o+n*n}function Dt(t){var r=t[0],e=t[1],o=t[2];return r*r+e*e+o*o}function Ct(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t}function At(t,r){return t[0]=1/r[0],t[1]=1/r[1],t[2]=1/r[2],t}function Tt(t,r){var e=r[0],o=r[1],n=r[2],a=e*e+o*o+n*n;return a>0&&(a=1/Math.sqrt(a)),t[0]=r[0]*a,t[1]=r[1]*a,t[2]=r[2]*a,t}function Vt(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]}function Pt(t,r,e){var o=r[0],n=r[1],a=r[2],i=e[0],s=e[1],l=e[2];return t[0]=n*l-a*s,t[1]=a*i-o*l,t[2]=o*s-n*i,t}function St(t,r,e,o){var n=r[0],a=r[1],i=r[2];return t[0]=n+o*(e[0]-n),t[1]=a+o*(e[1]-a),t[2]=i+o*(e[2]-i),t}function Wt(t,r,e,o,n,a){var i=a*a,s=i*(2*a-3)+1,l=i*(a-2)+a,h=i*(a-1),u=i*(3-2*a);return t[0]=r[0]*s+e[0]*l+o[0]*h+n[0]*u,t[1]=r[1]*s+e[1]*l+o[1]*h+n[1]*u,t[2]=r[2]*s+e[2]*l+o[2]*h+n[2]*u,t}function qt(t,r,e,o,n,a){var i=1-a,s=i*i,l=a*a,h=s*i,u=3*a*s,c=3*l*i,f=l*a;return t[0]=r[0]*h+e[0]*u+o[0]*c+n[0]*f,t[1]=r[1]*h+e[1]*u+o[1]*c+n[1]*f,t[2]=r[2]*h+e[2]*u+o[2]*c+n[2]*f,t}function Jt(t,r){r=r||1;var e=2*i()*Math.PI,o=2*i()-1,n=Math.sqrt(1-o*o)*r;return t[0]=Math.cos(e)*n,t[1]=Math.sin(e)*n,t[2]=o*r,t}function Lt(t,r,e){var o=r[0],n=r[1],a=r[2],i=e[3]*o+e[7]*n+e[11]*a+e[15];return i=i||1,t[0]=(e[0]*o+e[4]*n+e[8]*a+e[12])/i,t[1]=(e[1]*o+e[5]*n+e[9]*a+e[13])/i,t[2]=(e[2]*o+e[6]*n+e[10]*a+e[14])/i,t}function Nt(t,r,e){var o=r[0],n=r[1],a=r[2];return t[0]=o*e[0]+n*e[3]+a*e[6],t[1]=o*e[1]+n*e[4]+a*e[7],t[2]=o*e[2]+n*e[5]+a*e[8],t}function Rt(t,r,e){var o=e[0],n=e[1],a=e[2],i=e[3],s=r[0],l=r[1],h=r[2],u=n*h-a*l,c=a*s-o*h,f=o*l-n*s,d=n*f-a*c,M=a*u-o*f,m=o*c-n*u,g=2*i;return u*=g,c*=g,f*=g,d*=2,M*=2,m*=2,t[0]=s+u+d,t[1]=l+c+M,t[2]=h+f+m,t}function Ut(t,r,e,o){var n=[],a=[];return n[0]=r[0]-e[0],n[1]=r[1]-e[1],n[2]=r[2]-e[2],a[0]=n[0],a[1]=n[1]*Math.cos(o)-n[2]*Math.sin(o),a[2]=n[1]*Math.sin(o)+n[2]*Math.cos(o),t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t}function kt(t,r,e,o){var n=[],a=[];return n[0]=r[0]-e[0],n[1]=r[1]-e[1],n[2]=r[2]-e[2],a[0]=n[2]*Math.sin(o)+n[0]*Math.cos(o),a[1]=n[1],a[2]=n[2]*Math.cos(o)-n[0]*Math.sin(o),t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t}function It(t,r,e,o){var n=[],a=[];return n[0]=r[0]-e[0],n[1]=r[1]-e[1],n[2]=r[2]-e[2],a[0]=n[0]*Math.cos(o)-n[1]*Math.sin(o),a[1]=n[0]*Math.sin(o)+n[1]*Math.cos(o),a[2]=n[2],t[0]=a[0]+e[0],t[1]=a[1]+e[1],t[2]=a[2]+e[2],t}function _t(t,r){var e=t[0],o=t[1],n=t[2],a=r[0],i=r[1],s=r[2],l=Math.sqrt(e*e+o*o+n*n)*Math.sqrt(a*a+i*i+s*s),h=l&&Vt(t,r)/l;return Math.acos(Math.min(Math.max(h,-1),1))}function Zt(t){return t[0]=0,t[1]=0,t[2]=0,t}function Xt(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Yt(t,r){return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]}function Ot(t,r){var e=t[0],o=t[1],a=t[2],i=r[0],s=r[1],l=r[2];return Math.abs(e-i)<=n*Math.max(1,Math.abs(e),Math.abs(i))&&Math.abs(o-s)<=n*Math.max(1,Math.abs(o),Math.abs(s))&&Math.abs(a-l)<=n*Math.max(1,Math.abs(a),Math.abs(l))}r(at,"create",(()=>it)),r(at,"clone",(()=>st)),r(at,"length",(()=>lt)),r(at,"fromValues",(()=>ht)),r(at,"copy",(()=>ut)),r(at,"set",(()=>ct)),r(at,"add",(()=>ft)),r(at,"subtract",(()=>dt)),r(at,"multiply",(()=>Mt)),r(at,"divide",(()=>mt)),r(at,"ceil",(()=>gt)),r(at,"floor",(()=>pt)),r(at,"min",(()=>vt)),r(at,"max",(()=>Ft)),r(at,"round",(()=>xt)),r(at,"scale",(()=>wt)),r(at,"scaleAndAdd",(()=>yt)),r(at,"distance",(()=>bt)),r(at,"squaredDistance",(()=>Et)),r(at,"squaredLength",(()=>Dt)),r(at,"negate",(()=>Ct)),r(at,"inverse",(()=>At)),r(at,"normalize",(()=>Tt)),r(at,"len",(()=>Kt)),r(at,"dot",(()=>Vt)),r(at,"cross",(()=>Pt)),r(at,"lerp",(()=>St)),r(at,"hermite",(()=>Wt)),r(at,"bezier",(()=>qt)),r(at,"random",(()=>Jt)),r(at,"transformMat4",(()=>Lt)),r(at,"transformMat3",(()=>Nt)),r(at,"transformQuat",(()=>Rt)),r(at,"rotateX",(()=>Ut)),r(at,"rotateY",(()=>kt)),r(at,"rotateZ",(()=>It)),r(at,"angle",(()=>_t)),r(at,"zero",(()=>Zt)),r(at,"str",(()=>Xt)),r(at,"exactEquals",(()=>Yt)),r(at,"equals",(()=>Ot)),r(at,"sub",(()=>Gt)),r(at,"mul",(()=>jt)),r(at,"div",(()=>zt)),r(at,"dist",(()=>Bt)),r(at,"sqrDist",(()=>Ht)),r(at,"sqrLen",(()=>$t)),r(at,"forEach",(()=>tr));var Qt,Gt=dt,jt=Mt,zt=mt,Bt=bt,Ht=Et,Kt=lt,$t=Dt,tr=(Qt=it(),function(t,r,e,o,n,a){var i,s;for(r||(r=3),e||(e=0),s=o?Math.min(o*r+e,t.length):t.length,i=e;i<s;i+=r)Qt[0]=t[i],Qt[1]=t[i+1],Qt[2]=t[i+2],n(Qt,Qt,a),t[i]=Qt[0],t[i+1]=Qt[1],t[i+2]=Qt[2];return t}),rr={};function er(){var t=new a(4);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function or(t){var r=new a(4);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r}function nr(t,r,e,o){var n=new a(4);return n[0]=t,n[1]=r,n[2]=e,n[3]=o,n}function ar(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t}function ir(t,r,e,o,n){return t[0]=r,t[1]=e,t[2]=o,t[3]=n,t}function sr(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t[2]=r[2]+e[2],t[3]=r[3]+e[3],t}function lr(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t[2]=r[2]-e[2],t[3]=r[3]-e[3],t}function hr(t,r,e){return t[0]=r[0]*e[0],t[1]=r[1]*e[1],t[2]=r[2]*e[2],t[3]=r[3]*e[3],t}function ur(t,r,e){return t[0]=r[0]/e[0],t[1]=r[1]/e[1],t[2]=r[2]/e[2],t[3]=r[3]/e[3],t}function cr(t,r){return t[0]=Math.ceil(r[0]),t[1]=Math.ceil(r[1]),t[2]=Math.ceil(r[2]),t[3]=Math.ceil(r[3]),t}function fr(t,r){return t[0]=Math.floor(r[0]),t[1]=Math.floor(r[1]),t[2]=Math.floor(r[2]),t[3]=Math.floor(r[3]),t}function dr(t,r,e){return t[0]=Math.min(r[0],e[0]),t[1]=Math.min(r[1],e[1]),t[2]=Math.min(r[2],e[2]),t[3]=Math.min(r[3],e[3]),t}function Mr(t,r,e){return t[0]=Math.max(r[0],e[0]),t[1]=Math.max(r[1],e[1]),t[2]=Math.max(r[2],e[2]),t[3]=Math.max(r[3],e[3]),t}function mr(t,r){return t[0]=Math.round(r[0]),t[1]=Math.round(r[1]),t[2]=Math.round(r[2]),t[3]=Math.round(r[3]),t}function gr(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t[3]=r[3]*e,t}function pr(t,r,e,o){return t[0]=r[0]+e[0]*o,t[1]=r[1]+e[1]*o,t[2]=r[2]+e[2]*o,t[3]=r[3]+e[3]*o,t}function vr(t,r){var e=r[0]-t[0],o=r[1]-t[1],n=r[2]-t[2],a=r[3]-t[3];return Math.hypot(e,o,n,a)}function Fr(t,r){var e=r[0]-t[0],o=r[1]-t[1],n=r[2]-t[2],a=r[3]-t[3];return e*e+o*o+n*n+a*a}function xr(t){var r=t[0],e=t[1],o=t[2],n=t[3];return Math.hypot(r,e,o,n)}function wr(t){var r=t[0],e=t[1],o=t[2],n=t[3];return r*r+e*e+o*o+n*n}function yr(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t[3]=-r[3],t}function br(t,r){return t[0]=1/r[0],t[1]=1/r[1],t[2]=1/r[2],t[3]=1/r[3],t}function Er(t,r){var e=r[0],o=r[1],n=r[2],a=r[3],i=e*e+o*o+n*n+a*a;return i>0&&(i=1/Math.sqrt(i)),t[0]=e*i,t[1]=o*i,t[2]=n*i,t[3]=a*i,t}function Dr(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]+t[3]*r[3]}function Cr(t,r,e,o){var n=e[0]*o[1]-e[1]*o[0],a=e[0]*o[2]-e[2]*o[0],i=e[0]*o[3]-e[3]*o[0],s=e[1]*o[2]-e[2]*o[1],l=e[1]*o[3]-e[3]*o[1],h=e[2]*o[3]-e[3]*o[2],u=r[0],c=r[1],f=r[2],d=r[3];return t[0]=c*h-f*l+d*s,t[1]=-u*h+f*i-d*a,t[2]=u*l-c*i+d*n,t[3]=-u*s+c*a-f*n,t}function Ar(t,r,e,o){var n=r[0],a=r[1],i=r[2],s=r[3];return t[0]=n+o*(e[0]-n),t[1]=a+o*(e[1]-a),t[2]=i+o*(e[2]-i),t[3]=s+o*(e[3]-s),t}function Tr(t,r){var e,o,n,a,s,l;r=r||1;do{s=(e=2*i()-1)*e+(o=2*i()-1)*o}while(s>=1);do{l=(n=2*i()-1)*n+(a=2*i()-1)*a}while(l>=1);var h=Math.sqrt((1-s)/l);return t[0]=r*e,t[1]=r*o,t[2]=r*n*h,t[3]=r*a*h,t}function Vr(t,r,e){var o=r[0],n=r[1],a=r[2],i=r[3];return t[0]=e[0]*o+e[4]*n+e[8]*a+e[12]*i,t[1]=e[1]*o+e[5]*n+e[9]*a+e[13]*i,t[2]=e[2]*o+e[6]*n+e[10]*a+e[14]*i,t[3]=e[3]*o+e[7]*n+e[11]*a+e[15]*i,t}function Pr(t,r,e){var o=r[0],n=r[1],a=r[2],i=e[0],s=e[1],l=e[2],h=e[3],u=h*o+s*a-l*n,c=h*n+l*o-i*a,f=h*a+i*n-s*o,d=-i*o-s*n-l*a;return t[0]=u*h+d*-i+c*-l-f*-s,t[1]=c*h+d*-s+f*-i-u*-l,t[2]=f*h+d*-l+u*-s-c*-i,t[3]=r[3],t}function Sr(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function Wr(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function qr(t,r){return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]&&t[3]===r[3]}function Jr(t,r){var e=t[0],o=t[1],a=t[2],i=t[3],s=r[0],l=r[1],h=r[2],u=r[3];return Math.abs(e-s)<=n*Math.max(1,Math.abs(e),Math.abs(s))&&Math.abs(o-l)<=n*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(a-h)<=n*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(i-u)<=n*Math.max(1,Math.abs(i),Math.abs(u))}r(rr,"create",(()=>er)),r(rr,"clone",(()=>or)),r(rr,"fromValues",(()=>nr)),r(rr,"copy",(()=>ar)),r(rr,"set",(()=>ir)),r(rr,"add",(()=>sr)),r(rr,"subtract",(()=>lr)),r(rr,"multiply",(()=>hr)),r(rr,"divide",(()=>ur)),r(rr,"ceil",(()=>cr)),r(rr,"floor",(()=>fr)),r(rr,"min",(()=>dr)),r(rr,"max",(()=>Mr)),r(rr,"round",(()=>mr)),r(rr,"scale",(()=>gr)),r(rr,"scaleAndAdd",(()=>pr)),r(rr,"distance",(()=>vr)),r(rr,"squaredDistance",(()=>Fr)),r(rr,"length",(()=>xr)),r(rr,"squaredLength",(()=>wr)),r(rr,"negate",(()=>yr)),r(rr,"inverse",(()=>br)),r(rr,"normalize",(()=>Er)),r(rr,"len",(()=>Ir)),r(rr,"dot",(()=>Dr)),r(rr,"cross",(()=>Cr)),r(rr,"lerp",(()=>Ar)),r(rr,"random",(()=>Tr)),r(rr,"transformMat4",(()=>Vr)),r(rr,"transformQuat",(()=>Pr)),r(rr,"zero",(()=>Sr)),r(rr,"str",(()=>Wr)),r(rr,"exactEquals",(()=>qr)),r(rr,"equals",(()=>Jr)),r(rr,"sub",(()=>Lr)),r(rr,"mul",(()=>Nr)),r(rr,"div",(()=>Rr)),r(rr,"dist",(()=>Ur)),r(rr,"sqrDist",(()=>kr)),r(rr,"sqrLen",(()=>_r)),r(rr,"forEach",(()=>Zr));var Lr=lr,Nr=hr,Rr=ur,Ur=vr,kr=Fr,Ir=xr,_r=wr,Zr=function(){var t=er();return function(r,e,o,n,a,i){var s,l;for(e||(e=4),o||(o=0),l=n?Math.min(n*e+o,r.length):r.length,s=o;s<l;s+=e)t[0]=r[s],t[1]=r[s+1],t[2]=r[s+2],t[3]=r[s+3],a(t,t,i),r[s]=t[0],r[s+1]=t[1],r[s+2]=t[2],r[s+3]=t[3];return r}}();function Xr(){var t=new a(4);return a!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Yr(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Or(t,r,e){e*=.5;var o=Math.sin(e);return t[0]=o*r[0],t[1]=o*r[1],t[2]=o*r[2],t[3]=Math.cos(e),t}function Qr(t,r){var e=2*Math.acos(r[3]),o=Math.sin(e/2);return o>n?(t[0]=r[0]/o,t[1]=r[1]/o,t[2]=r[2]/o):(t[0]=1,t[1]=0,t[2]=0),e}function Gr(t,r){var e=be(t,r);return Math.acos(2*e*e-1)}function jr(t,r,e){var o=r[0],n=r[1],a=r[2],i=r[3],s=e[0],l=e[1],h=e[2],u=e[3];return t[0]=o*u+i*s+n*h-a*l,t[1]=n*u+i*l+a*s-o*h,t[2]=a*u+i*h+o*l-n*s,t[3]=i*u-o*s-n*l-a*h,t}function zr(t,r,e){e*=.5;var o=r[0],n=r[1],a=r[2],i=r[3],s=Math.sin(e),l=Math.cos(e);return t[0]=o*l+i*s,t[1]=n*l+a*s,t[2]=a*l-n*s,t[3]=i*l-o*s,t}function Br(t,r,e){e*=.5;var o=r[0],n=r[1],a=r[2],i=r[3],s=Math.sin(e),l=Math.cos(e);return t[0]=o*l-a*s,t[1]=n*l+i*s,t[2]=a*l+o*s,t[3]=i*l-n*s,t}function Hr(t,r,e){e*=.5;var o=r[0],n=r[1],a=r[2],i=r[3],s=Math.sin(e),l=Math.cos(e);return t[0]=o*l+n*s,t[1]=n*l-o*s,t[2]=a*l+i*s,t[3]=i*l-a*s,t}function Kr(t,r){var e=r[0],o=r[1],n=r[2];return t[0]=e,t[1]=o,t[2]=n,t[3]=Math.sqrt(Math.abs(1-e*e-o*o-n*n)),t}function $r(t,r){var e=r[0],o=r[1],n=r[2],a=r[3],i=Math.sqrt(e*e+o*o+n*n),s=Math.exp(a),l=i>0?s*Math.sin(i)/i:0;return t[0]=e*l,t[1]=o*l,t[2]=n*l,t[3]=s*Math.cos(i),t}function te(t,r){var e=r[0],o=r[1],n=r[2],a=r[3],i=Math.sqrt(e*e+o*o+n*n),s=i>0?Math.atan2(i,a)/i:0;return t[0]=e*s,t[1]=o*s,t[2]=n*s,t[3]=.5*Math.log(e*e+o*o+n*n+a*a),t}function re(t,r,e){return te(t,r),ye(t,t,e),$r(t,t),t}function ee(t,r,e,o){var a,i,s,l,h,u=r[0],c=r[1],f=r[2],d=r[3],M=e[0],m=e[1],g=e[2],p=e[3];return(i=u*M+c*m+f*g+d*p)<0&&(i=-i,M=-M,m=-m,g=-g,p=-p),1-i>n?(a=Math.acos(i),s=Math.sin(a),l=Math.sin((1-o)*a)/s,h=Math.sin(o*a)/s):(l=1-o,h=o),t[0]=l*u+h*M,t[1]=l*c+h*m,t[2]=l*f+h*g,t[3]=l*d+h*p,t}function oe(t){var r=i(),e=i(),o=i(),n=Math.sqrt(1-r),a=Math.sqrt(r);return t[0]=n*Math.sin(2*Math.PI*e),t[1]=n*Math.cos(2*Math.PI*e),t[2]=a*Math.sin(2*Math.PI*o),t[3]=a*Math.cos(2*Math.PI*o),t}function ne(t,r){var e=r[0],o=r[1],n=r[2],a=r[3],i=e*e+o*o+n*n+a*a,s=i?1/i:0;return t[0]=-e*s,t[1]=-o*s,t[2]=-n*s,t[3]=a*s,t}function ae(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t[3]=r[3],t}function ie(t,r){var e,o=r[0]+r[4]+r[8];if(o>0)e=Math.sqrt(o+1),t[3]=.5*e,e=.5/e,t[0]=(r[5]-r[7])*e,t[1]=(r[6]-r[2])*e,t[2]=(r[1]-r[3])*e;else{var n=0;r[4]>r[0]&&(n=1),r[8]>r[3*n+n]&&(n=2);var a=(n+1)%3,i=(n+2)%3;e=Math.sqrt(r[3*n+n]-r[3*a+a]-r[3*i+i]+1),t[n]=.5*e,e=.5/e,t[3]=(r[3*a+i]-r[3*i+a])*e,t[a]=(r[3*a+n]+r[3*n+a])*e,t[i]=(r[3*i+n]+r[3*n+i])*e}return t}function se(t,r,e,o){var n=.5*Math.PI/180;r*=n,e*=n,o*=n;var a=Math.sin(r),i=Math.cos(r),s=Math.sin(e),l=Math.cos(e),h=Math.sin(o),u=Math.cos(o);return t[0]=a*l*u-i*s*h,t[1]=i*s*u+a*l*h,t[2]=i*l*h-a*s*u,t[3]=i*l*u+a*s*h,t}function le(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var he,ue,ce,fe,de,Me,me,ge=or,pe=nr,ve=ar,Fe=ir,xe=sr,we=jr,ye=gr,be=Dr,Ee=Ar,De=xr,Ce=De,Ae=wr,Te=Ae,Ve=Er,Pe=qr,Se=Jr,We=(he=it(),ue=ht(1,0,0),ce=ht(0,1,0),function(t,r,e){var o=Vt(r,e);return o<-.999999?(Pt(he,ue,r),Kt(he)<1e-6&&Pt(he,ce,r),Tt(he,he),Or(t,he,Math.PI),t):o>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Pt(he,r,e),t[0]=he[0],t[1]=he[1],t[2]=he[2],t[3]=1+o,Ve(t,t))}),qe=(fe=Xr(),de=Xr(),function(t,r,e,o,n,a){return ee(fe,r,n,a),ee(de,e,o,a),ee(t,fe,de,2*a*(1-a)),t}),Je=(Me=new a(9),a!=Float32Array&&(Me[1]=0,Me[2]=0,Me[3]=0,Me[5]=0,Me[6]=0,Me[7]=0),Me[0]=1,Me[4]=1,Me[8]=1,me=Me,function(t,r,e,o){return me[0]=e[0],me[3]=e[1],me[6]=e[2],me[1]=o[0],me[4]=o[1],me[7]=o[2],me[2]=-r[0],me[5]=-r[1],me[8]=-r[2],Ve(t,ie(t,me))});const Le=new Float64Array(16);function Ne(t,r,e){rr.scale(Le,e,-1),rr.squaredDistance(r,Le)<rr.squaredDistance(r,e)?rr.subtract(t,r,Le):rr.subtract(t,r,e)}const Re=new Float64Array(16);const Ue=Math.PI,ke=2*Ue,Ie=Ue/2,_e=Math.PI/180,Ze=1/_e,Xe=new Float32Array(16),Ye=new Float32Array(16),Oe=new Float32Array(4),Qe=new Float32Array(3),Ge=new Set,je=[];let ze=!1;class Be{constructor(){this.name="",this.quaternion=new Float32Array([0,0,0,1]),this.position=new Float32Array(3),this.matrix=new Float32Array(16),o.identity(this.matrix),this.matrixWorld=new Float32Array(16),o.identity(this.matrixWorld),this.matrixNeedsUpdate=!1,this.matrixWorldNeedsUpdate=!1,this.parent=null,this.children=[]}setPosition(...t){const r=this.position;at.sqrDist(r,t)>1e-10&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],this.setMatrixNeedsUpdate())}setEuler(t,r,e){nt.fromEuler(Oe,t*Ze,r*Ze,e*Ze),this.setQuaternion(...Oe)}setQuaternion(...t){const r=this.quaternion;Ne(Re,r,t),rr.squaredLength(Re)>1e-10&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],this.setMatrixNeedsUpdate())}setWorldPosition(t,r,e){const n=this.parent;Qe[0]=t,Qe[1]=r,Qe[2]=e,n&&(n.updateMatrixWorld(),o.invert(Xe,n.matrixWorld),at.transformMat4(Qe,Qe,Xe)),this.setPosition(...Qe)}setWorldEuler(t,r,e){nt.fromEuler(Oe,t*Ze,r*Ze,e*Ze),this.setWorldQuaternion(...Oe)}setWorldQuaternion(t,r,e,n){const a=this;Oe[0]=t,Oe[1]=r,Oe[2]=e,Oe[3]=n,a&&(a.updateMatrixWorld(),o.invert(Xe,a.matrixWorld),o.fromQuat(Ye,Oe),o.multiply(Ye,Xe,Ye),o.getRotation(Oe,Ye)),this.setQuaternion(...Oe)}getWorldPosition(t){this.updateMatrixWorld(),o.getTranslation(t,this.matrixWorld)}getWorldQuaternion(t){this.updateMatrixWorld(),o.getRotation(t,this.matrixWorld)}traverseParents(t){let r;const e=ze;ze?r=new Set:(r=Ge,r.clear()),ze=!0;let o=this.parent;for(;o&&!r.has(o);){if(t(o))return;r.add(o),o=o.parent}ze=e,r.clear()}traverse(t){const r=ze;let e,o;ze?(e=new Set,o=[this]):(e=Ge,e.clear(),o=je,o[0]=this),ze=!0;let n=0,a=1;for(;n<a;){const r=o[n];if(!t(r)){const t=r.children;for(let r=0,n=t.length;r<n;r++){const n=t[r];e.has(n)||(e.add(n),o[a]=n,a++)}}n++}ze=r,e.clear(),o.fill(null)}find(t){let r=null;return this.traverse((e=>!!r||(t(e)?(r=e,!0):void 0))),r}addChild(t){if(t.parent)throw new Error("Frame: Added child must not already have a parent.");if(t===this)throw new Error("Frame: Frame cannot be added as a child to itself.");this.traverseParents((r=>{if(r===t)throw new Error("Frame: Added child is an ancestor of this Frame. Use Joint.makeClosure instead.")})),t.parent=this,this.children.push(t),t.setMatrixWorldNeedsUpdate()}removeChild(t){if(t.parent!==this)throw new Error("Frame: Child to be removed is not a child of this Frame.");const r=this.children.indexOf(t);this.children.splice(r,1),t.parent=null,t.setMatrixWorldNeedsUpdate()}attachChild(t){this.updateMatrixWorld(),t.updateMatrixWorld(),this.addChild(t),o.invert(Xe,this.matrixWorld),o.multiply(t.matrix,Xe,t.matrixWorld),o.getTranslation(t.position,t.matrix),o.getRotation(t.quaternion,t.matrix)}detachChild(t){this.updateMatrixWorld(),t.updateMatrixWorld(),this.removeChild(t),o.copy(t.matrix,t.matrixWorld),o.getTranslation(t.position,t.matrix),o.getRotation(t.quaternion,t.matrix)}computeMatrixWorld(){this.parent?o.multiply(this.matrixWorld,this.parent.matrixWorld,this.matrix):o.copy(this.matrixWorld,this.matrix)}setMatrixNeedsUpdate(){!1===this.matrixNeedsUpdate&&(this.matrixNeedsUpdate=!0,this.setMatrixWorldNeedsUpdate())}setMatrixWorldNeedsUpdate(){this.traverse((t=>!!t.matrixWorldNeedsUpdate||(t.matrixWorldNeedsUpdate=!0,!1)))}updateMatrix(){this.matrixNeedsUpdate&&(o.fromRotationTranslation(this.matrix,this.quaternion,this.position),this.matrixNeedsUpdate=!1)}updateMatrixWorld(t=!1){const{parent:r}=this;this.matrixWorldNeedsUpdate&&(r&&r.matrixWorldNeedsUpdate&&r.updateMatrixWorld(!1),this.updateMatrix(),this.computeMatrixWorld(),this.matrixWorldNeedsUpdate=!1),t&&this.traverse((t=>{this!==t&&t.updateMatrixWorld(!1)}))}}function He(t){let r=t%ke;return r>Ue?r-=ke:r<=-Ue&&(r+=ke),r}function Ke(t,r){let e=Math.round(t/ke)*ke+He(r);const o=e-t;return Math.abs(o)>Ue&&(e-=Math.sign(o)*ke),e}function $e(t,r,e){t[0]=Ke(r[0],e[0]),t[1]=Ke(r[1],e[1]),t[2]=Ke(r[2],e[2])}function to(t,r){return Math.abs(t[0]-r[0])+Math.abs(t[1]-r[1])+Math.abs(t[2]-r[2])}function ro(t,r){t[0]=r[0]+Ue,t[1]=Ue-r[1],t[2]=r[2]+Ue}function eo(t){const r=He(t[1]);return!(Math.abs(Math.abs(r)-Ie)>1e-7)}function oo(t,r,e){if(!eo(e))return!1;const o=He(e[1]),n=-1*Math.sign(o),a=e[0]+n*e[2];return t[0]=r[0],t[1]=Ke(r[1],e[1]),t[2]=Ke(r[2],n*(a-r[0])),$e(t,r,t),!0}const no=new Float64Array(3),ao=new Float64Array(3);function io(t,r,e){let o=1/0;if(eo(e)){oo(no,r,e),ro(ao,e),oo(ao,r,ao);const n=to(r,no),a=to(r,ao);n<a?(at.copy(t,no),o=n):(at.copy(t,ao),o=a)}$e(no,r,e),ro(ao,e),$e(ao,r,ao);const n=to(r,no),a=to(r,ao);(n<o||a<o)&&(n<a?at.copy(t,no):at.copy(t,ao))}const so=new Float64Array(3),lo=new Float64Array(4),ho=new Float64Array(3),uo=new Float64Array(4);function co(t,r,e,n){o.getTranslation(so,t),o.getRotation(lo,t),o.getTranslation(ho,r),o.getRotation(uo,r),at.subtract(e,so,ho),Ne(n,lo,uo)}const fo={X:0,Y:1,Z:2,EX:3,EY:4,EZ:5},Mo=Object.entries(fo).sort(((t,r)=>t[1]-r[1])).map((t=>t[0])),mo=new Float32Array(16),go=new Float32Array(16),po=new Float32Array(4),vo=new Float32Array(3),Fo=new Float32Array(3),xo=new Float32Array(3),wo=new Float32Array(6);function yo(t,r){nt.fromEuler(po,r[fo.EX]*Ze,r[fo.EY]*Ze,r[fo.EZ]*Ze),o.fromRotationTranslation(t,po,r)}class bo extends Be{constructor(){super(),this.isJoint=!0,this.child=null,this.isClosure=!1,this.trackJointWrap=!1,this.rotationDoFCount=0,this.translationDoFCount=0,this.dof=[],this.dofFlags=new Uint8Array(6),this.dofValues=new Float32Array(6),this.dofTarget=new Float32Array(6),this.dofRestPose=new Float32Array(6),this.minDoFLimit=new Float32Array(6).fill(-1/0),this.maxDoFLimit=new Float32Array(6).fill(1/0),this.targetSet=!1,this.restPoseSet=!1,this.matrixDoFNeedsUpdate=!1,this.matrixDoF=new Float32Array(16),o.identity(this.matrixDoF),this.cachedIdentityDoFMatrixWorld=new Float32Array(16),o.identity(this.cachedIdentityDoFMatrixWorld)}_getQuaternion(t,r){nt.fromEuler(r,t[fo.EX],t[fo.EY],t[fo.EZ])}_getEuler(t,r){r[0]=t[fo.EX],r[1]=t[fo.EY],r[2]=t[fo.EZ]}_getPosition(t,r){r[0]=t[fo.X],r[1]=t[fo.Y],r[2]=t[fo.Z]}_setValue(t,r,e){if(t===this.minDoFLimit||t==this.maxDoFLimit)throw new Error("Joint: Cannot set minDoFLimit or maxDoFLimit with _setValue.");if(r<0||r>6||"number"!=typeof r)throw new Error("Joint: Invalid DoF.");if(!this.dofFlags[r])return!1;const o=this.minDoFLimit[r],n=this.maxDoFLimit[r];return e<o&&(e=o),e>n&&(e=n),t[r]=e,e===n||e===o}_setValues(t,r){const e=this.dof;for(let o=0,n=r.length;o<n;o++)this._setValue(t,e[o],r[o])}_setViaFullPosition(t,r){const e=this.dofFlags;for(let o=0;o<3;o++)t[o]=e[o]*r[o]}_setViaFullEuler(t,r){const e=this.dofFlags;for(let o=3;o<6;o++)t[o]=e[o]*r[o-3];this.tryMinimizeEulerAngles()}_setViaQuaternion(t,r){if(function(t,r){const[e,o,n,a]=r,i=2*(a*e+o*n),s=1-2*(e*e+o*o),l=Math.atan2(i,s);let h=2*(a*o-n*e);h=h>1?1:h,h=h<-1?-1:h;const u=Math.asin(h),c=2*(a*n+e*o),f=1-2*(o*o+n*n),d=Math.atan2(c,f);t[0]=l*Ze,t[1]=u*Ze,t[2]=d*Ze}(xo,r),xo[0]*=_e,xo[1]*=_e,xo[2]*=_e,this.trackJointWrap){const t=this.dofValues;vo[0]=t[fo.EX],vo[1]=t[fo.EY],vo[2]=t[fo.EZ],io(xo,vo,xo)}this._setViaFullEuler(t,xo)}clearDoF(){this.setDoF()}setDoF(...t){t.forEach(((r,e)=>{if(r<0||r>=6)throw new Error("Joint: Invalid degree of freedom enum "+r+".");if(t.includes(r,e+1))throw new Error("Joint: Duplicate degree of freedom "+Mo[r]+"specified.");if(0!==e&&t[e-1]>r)throw new Error("Joint: Joints degrees of freedom must be specified in position then rotation, XYZ order")})),this.dof=t,this.dofValues.fill(0),this.dofTarget.fill(0),this.dofRestPose.fill(0),this.minDoFLimit.fill(-1/0),this.maxDoFLimit.fill(1/0),this.setMatrixDoFNeedsUpdate();for(let r=0;r<6;r++)this.dofFlags[r]=Number(t.includes(r));this.rotationDoFCount=this.dofFlags[fo.EX]+this.dofFlags[fo.EY]+this.dofFlags[fo.EZ],this.translationDoFCount=this.dofFlags[fo.X]+this.dofFlags[fo.Y]+this.dofFlags[fo.Z]}setDoFValues(...t){this.setMatrixDoFNeedsUpdate(),this._setValues(this.dofValues,t)}setDoFValue(t,r){return this.setMatrixDoFNeedsUpdate(),this._setValue(this.dofValues,t,r)}getDoFValue(t){return this.dofValues[t]}getDoFQuaternion(t){this._getQuaternion(this.dofValues,t)}getDoFEuler(t){this._getEuler(this.dofValues,t)}getDoFPosition(t){this._getPosition(this.dofValues,t)}setRestPoseValues(...t){this._setValues(this.dofRestPose,t)}setRestPoseValue(t,r){return this._setValue(this.dofRestPose,t,r)}getRestPoseValue(t){return this.dofRestPose[t]}getRestPoseQuaternion(t){this._getQuaternion(this.dofRestPose,t)}getRestPoseEuler(t){this._getEuler(this.dofRestPose,t)}getRestPosePosition(t){this._getPosition(this.dofRestPose,t)}setTargetValues(...t){this._setValues(this.dofTarget,t)}setTargetValue(t,r){this._setValue(this.dofTarget,t,r)}getTargetValue(t){return this.dofTarget[t]}getTargetQuaternion(t){this._getQuaternion(this.dofTarget,t)}getTargetEuler(t){this._getEuler(this.dofTarget,t)}getTargetPosition(t){this._getPosition(this.dofTarget,t)}setMinLimits(...t){const{dof:r}=this;for(const e in t){const o=r[e];this.setMinLimit(o,t[e])}}setMinLimit(t,r){this.minDoFLimit[t]=r,this.setDoFValue(t,this.dofValues[t])}getMinLimit(t){return this.minDoFLimit[t]}setMaxLimits(...t){const{dof:r}=this;for(const e in t){const o=r[e];this.setMaxLimit(o,t[e])}}setMaxLimit(t,r){this.maxDoFLimit[t]=r,this.setDoFValue(t,this.dofValues[t])}getMaxLimit(t){return this.maxDoFLimit[t]}getClosureError(t,r){if(!this.isClosure)throw new Error("Joint: Cannot get closure error on non closure Joint.");this.updateMatrixWorld(),this.child.updateMatrixWorld(),co(this.matrixWorld,this.child.matrixWorld,t,r)}tryMinimizeEulerAngles(){const{trackJointWrap:t,rotationDoFCount:r,dofRestPose:e,dofTarget:o,dofValues:n}=this;if(!t)if(r<3)for(let t=fo.EX;t<=fo.EZ;t++)o[t]=Ke(n[t],o[t]),e[t]=Ke(n[t],e[t]);else Fo[0]=n[fo.EX],Fo[1]=n[fo.EY],Fo[2]=n[fo.EZ],vo[0]=o[fo.EX],vo[1]=o[fo.EY],vo[2]=o[fo.EZ],io(vo,Fo,vo),o[fo.EX]=vo[0],o[fo.EY]=vo[1],o[fo.EZ]=vo[2],vo[0]=e[fo.EX],vo[1]=e[fo.EY],vo[2]=e[fo.EZ],io(vo,Fo,vo),e[fo.EX]=vo[0],e[fo.EY]=vo[1],e[fo.EZ]=vo[2]}getDeltaWorldMatrix(t,r,e){const{dofValues:n,minDoFLimit:a,maxDoFLimit:i,cachedIdentityDoFMatrixWorld:s}=this;this.updateMatrixWorld(),wo.set(n);const l=a[t],h=i[t],u=wo[t],c=u-l,f=h-u;let d=u+r;const M=r>0&&d>h&&c>f||r<0&&d<l&&f>c;return M&&(d=u-r),wo[t]=d,yo(go,wo),o.multiply(e,s,go),M}setMatrixDoFNeedsUpdate(){!1===this.matrixDoFNeedsUpdate&&(this.matrixDoFNeedsUpdate=!0,this.setMatrixWorldNeedsUpdate())}updateDoFMatrix(){this.matrixDoFNeedsUpdate&&(yo(this.matrixDoF,this.dofValues),this.matrixDoFNeedsUpdate=!1)}computeMatrixWorld(){const{parent:t,matrixWorld:r,matrix:e,matrixDoF:n,cachedIdentityDoFMatrixWorld:a}=this;this.updateDoFMatrix(),o.multiply(r,e,n),t?(o.multiply(r,t.matrixWorld,r),o.multiply(a,t.matrixWorld,e)):o.copy(a,e)}makeClosure(t){if(!t.isLink||this.child||t.parent===this)throw new Error("Joint: Given child cannot be used to make closure.");this.child=t,this.isClosure=!0,t.closureJoints.push(this)}addChild(t){if(!t.isLink||this.child||t.parent===this)throw new Error("Joint: Given child cannot be added to Joint.");super.addChild(t),this.child=t,this.isClosure=!1}removeChild(t){if(this.isClosure){if(this.child!==t)throw new Error("Frame: Child to be removed is not a child of this Joint.");{this.child=null,this.isClosure=!1;const r=t.closureJoints.indexOf(this);t.closureJoints.splice(r,1)}}else super.removeChild(t)}attachChild(t){super.attachChild(t),o.invert(mo,this.matrixDoF),o.multiply(t.matrix,mo,t.matrix),o.getTranslation(t.position,t.matrix),o.getRotation(t.quaternion,t.matrix)}detachChild(t){super.detachChild(t),o.invert(mo,this.matrixDoF),o.multiply(t.matrix,mo,t.matrix),o.getTranslation(t.position,t.matrix),o.getRotation(t.quaternion,t.matrix)}}const Eo=new Float64Array(3),Do=new Float64Array(4),Co=new Float64Array(3);function Ao(t,r,e,o=null,n={isConverged:!1,rowCount:7,totalError:0}){const{translationConvergeThreshold:a,rotationConvergeThreshold:i,translationErrorClamp:s,rotationErrorClamp:l,translationFactor:h,rotationFactor:u}=t,{translationDoFCount:c,rotationDoFCount:f,dofFlags:d,dof:M}=r;r.getClosureError(Eo,Do);let m=7;r.isGoal&&(Eo[0]*=d[0],Eo[1]*=d[1],Eo[2]*=d[2],m=c,0===f?(Do[0]=0,Do[1]=0,Do[2]=0,Do[3]=0):m+=4);let g=!1,p=0;const v=at.length(Eo),F=rr.length(Do);if(v<a&&F<i&&(g=!0),p+=v+F,o)if(v>s&&at.scale(Eo,Eo,s/v),rr.scale(Eo,Eo,h),F>l&&rr.scale(Do,Do,l/F),rr.scale(Do,Do,u),r.isGoal){for(let t=0;t<c;t++){const r=M[t];o[e+t][0]=Eo[r]}3===r.rotationDoFCount&&(o[e+c+0][0]=Do[0],o[e+c+1][0]=Do[1],o[e+c+2][0]=Do[2],o[e+c+3][0]=Do[3])}else o[e+0][0]=Eo[0],o[e+1][0]=Eo[1],o[e+2][0]=Eo[2],o[e+3][0]=Do[0],o[e+4][0]=Do[1],o[e+5][0]=Do[2],o[e+6][0]=Do[3];return n.totalError=p,n.isConverged=g,n.rowCount=m,n}function To(t,r,e,o=null,n={isConverged:!1,rowCount:7,totalError:0}){const{translationConvergeThreshold:a,rotationConvergeThreshold:i,lockedJointDoFCount:s,translationErrorClamp:l,rotationErrorClamp:h,lockedJointDoF:u}=t,{dofTarget:c,dofValues:f,translationDoFCount:d,rotationDoFCount:M,translationFactor:m,rotationFactor:g,dofList:p}=r,v=at.distance(f,c);let F=c[fo.EX]-f[fo.EX]+c[fo.EY]-f[fo.EY]+c[fo.EZ]-f[fo.EZ];const x=s.get(r)||0;if(n.rowCount=d+M-x,n.isConverged=v<a&&F<i,n.totalError=v+F,o){const t=u.get(r),n=0!==x;let a=0;Eo[0]=c[0]-f[0],Eo[1]=c[1]-f[1],Eo[2]=c[2]-f[2];const i=at.length(Eo);at.scale(Eo,Eo,m*l/i);for(let r=0,i=d;r<i;r++){const i=p[r];n&&t[i]||(o[e+a][0]=Eo[i],a++)}Co[0]=r.dofTarget[3]-r.dofValues[3],Co[1]=r.dofTarget[4]-r.dofValues[4],Co[2]=r.dofTarget[5]-r.dofValues[5];const s=at.length(Co);at.scale(Co,Co,g*h/s);for(let r=d,i=d+M;r<i;r++){const i=p[r];n&&t[i]||(o[e+a][0]=Co[i],a++)}}}var Vo={},Po=function(){function t(r,e){this.data=new Array(r.length);for(var o=0,n=r[0].length;o<r.length;o++){this.data[o]=new Array(n);for(var a=0;a<n;a++)this.data[o][a]=r[o][a]}if(e){if("object"!=typeof e[0])for(o=0;o<e.length;o++)e[o]=[e[o]];this.mirror=new t(e)}}return t.prototype.swap=function(t,r){this.mirror&&this.mirror.swap(t,r);var e=this.data[t];this.data[t]=this.data[r],this.data[r]=e},t.prototype.multline=function(t,r){this.mirror&&this.mirror.multline(t,r);for(var e=this.data[t],o=e.length-1;o>=0;o--)e[o]*=r},t.prototype.addmul=function(t,r,e){this.mirror&&this.mirror.addmul(t,r,e);for(var o=this.data[t],n=this.data[r],a=o.length-1;a>=0;a--)o[a]=o[a]+e*n[a]},t.prototype.hasNullLine=function(t){for(var r=0;r<this.data[t].length;r++)if(0!==this.data[t][r])return!1;return!0},t.prototype.gauss=function(){for(var t=0,r=this.data.length,e=this.data[0].length,o=[],n=0;n<e;n++){for(var a=0,i=0,s=t;s<r;s++){var l=this.data[s][n];Math.abs(l)>Math.abs(a)&&(i=s,a=l)}if(0===a)o.push(t);else{this.multline(i,1/a),this.swap(i,t);for(var h=0;h<r;h++)h!==t&&this.addmul(h,t,-this.data[h][n])}t++}for(h=0;h<o.length;h++)if(!this.mirror.hasNullLine(o[h]))throw new Error("singular matrix");return this.mirror.data},Vo.solve=function(r,e){var o=new t(r,e).gauss();if(o.length>0&&1===o[0].length)for(var n=0;n<o.length;n++)o[n]=o[n][0];return o},Vo.invert=function(r){return new t(r,function(t){for(var r=new Array(t),e=0;e<t;e++){r[e]=new Array(t);for(var o=0;o<t;o++)r[e][o]=e===o?1:0}return r}(r.length)).gauss()},Vo}();"object"==typeof Vo&&(Vo=Po);var So,Wo,qo={};function Jo(t,r){const e=new Array(t);for(let o=0;o<t;o++)e[o]=new Float64Array(r);return e}function Lo(t,r){const e=r.length,o=r[0].length;for(let n=0;n<e;n++)for(let e=0;e<o;e++)t[n][e]=r[n][e]}function No(t){let r=0;const e=t.length,o=t[0].length;for(let n=0;n<e;n++)for(let e=0;e<o;e++)r+=t[n][e]**2;return r}function Ro(t,r=3){const e=t.length,o=t[0].length;let n="";for(let a=0;a<e;a++){for(let e=0;e<o;e++)n+=t[a][e].toFixed(r)+", ";n+="\n"}return n}So=qo,Wo=function(t){"use strict";t.SVD=function(t,r,e,o,n){if(r=void 0===r||r,e=void 0===e||e,n=1e-64/(o=o||Math.pow(2,-52)),!t)throw new TypeError("Matrix a is not defined");var a,i,s,l,h,u,c,f,d,M,m,g,p=t[0].length,v=t.length;if(v<p)throw new TypeError("Invalid matrix: m < n");for(var F=[],x=[],w=[],y="f"===r?v:p,b=M=c=0;b<v;b++)x[b]=new Array(y).fill(0);for(b=0;b<p;b++)w[b]=new Array(p).fill(0);var E,D=new Array(p).fill(0);for(b=0;b<v;b++)for(a=0;a<p;a++)x[b][a]=t[b][a];for(b=0;b<p;b++){for(F[b]=c,d=0,s=b+1,a=b;a<v;a++)d+=Math.pow(x[a][b],2);if(d<n)c=0;else for(f=(u=x[b][b])*(c=u<0?Math.sqrt(d):-Math.sqrt(d))-d,x[b][b]=u-c,a=s;a<p;a++){for(d=0,i=b;i<v;i++)d+=x[i][b]*x[i][a];for(u=d/f,i=b;i<v;i++)x[i][a]=x[i][a]+u*x[i][b]}for(D[b]=c,d=0,a=s;a<p;a++)d+=Math.pow(x[b][a],2);if(d<n)c=0;else{for(f=(u=x[b][b+1])*(c=u<0?Math.sqrt(d):-Math.sqrt(d))-d,x[b][b+1]=u-c,a=s;a<p;a++)F[a]=x[b][a]/f;for(a=s;a<v;a++){for(d=0,i=s;i<p;i++)d+=x[a][i]*x[b][i];for(i=s;i<p;i++)x[a][i]=x[a][i]+d*F[i]}}M<(m=Math.abs(D[b])+Math.abs(F[b]))&&(M=m)}if(e)for(b=p-1;0<=b;b--){if(0!==c){for(f=x[b][b+1]*c,a=s;a<p;a++)w[a][b]=x[b][a]/f;for(a=s;a<p;a++){for(d=0,i=s;i<p;i++)d+=x[b][i]*w[i][a];for(i=s;i<p;i++)w[i][a]=w[i][a]+d*w[i][b]}}for(a=s;a<p;a++)w[b][a]=0,w[a][b]=0;w[b][b]=1,c=F[b],s=b}if(r){if("f"===r)for(b=p;b<v;b++){for(a=p;a<v;a++)x[b][a]=0;x[b][b]=1}for(b=p-1;0<=b;b--){for(s=b+1,c=D[b],a=s;a<y;a++)x[b][a]=0;if(0!==c){for(f=x[b][b]*c,a=s;a<y;a++){for(d=0,i=s;i<v;i++)d+=x[i][b]*x[i][a];for(u=d/f,i=b;i<v;i++)x[i][a]=x[i][a]+u*x[i][b]}for(a=b;a<v;a++)x[a][b]=x[a][b]/c}else for(a=b;a<v;a++)x[a][b]=0;x[b][b]=x[b][b]+1}}for(o*=M,i=p-1;0<=i;i--)for(var C=0;C<50;C++){for(E=!1,s=i;0<=s;s--){if(Math.abs(F[s])<=o){E=!0;break}if(Math.abs(D[s-1])<=o)break}if(!E)for(h=0,l=s-(d=1),b=s;b<i+1&&(u=d*F[b],F[b]=h*F[b],!(Math.abs(u)<=o));b++)if(c=D[b],D[b]=Math.sqrt(u*u+c*c),h=c/(f=D[b]),d=-u/f,r)for(a=0;a<v;a++)m=x[a][l],g=x[a][b],x[a][l]=m*h+g*d,x[a][b]=-m*d+g*h;if(g=D[i],s===i){if(g<0&&(D[i]=-g,e))for(a=0;a<p;a++)w[a][i]=-w[a][i];break}for(M=D[s],u=(((m=D[i-1])-g)*(m+g)+((c=F[i-1])-(f=F[i]))*(c+f))/(2*f*m),c=Math.sqrt(u*u+1),u=((M-g)*(M+g)+f*(m/(u<0?u-c:u+c)-f))/M,b=s+(d=h=1);b<i+1;b++){if(c=F[b],m=D[b],f=d*c,c*=h,g=Math.sqrt(u*u+f*f),u=M*(h=u/(F[b-1]=g))+c*(d=f/g),c=-M*d+c*h,f=m*d,m*=h,e)for(a=0;a<p;a++)M=w[a][b-1],g=w[a][b],w[a][b-1]=M*h+g*d,w[a][b]=-M*d+g*h;if(g=Math.sqrt(u*u+f*f),u=(h=u/(D[b-1]=g))*c+(d=f/g)*m,M=-d*c+h*m,r)for(a=0;a<v;a++)m=x[a][b-1],g=x[a][b],x[a][b-1]=m*h+g*d,x[a][b]=-m*d+g*h}F[s]=0,F[i]=u,D[i]=M}for(b=0;b<p;b++)D[b]<o&&(D[b]=0);return{u:x,q:D,v:w}},t.VERSION="1.1.1",Object.defineProperty(t,"__esModule",{value:!0})},"object"==typeof qo?Wo(qo):"function"==typeof define&&define.amd?define(["exports"],Wo):Wo((So="undefined"!=typeof globalThis?globalThis:So||self).SVDJS={});const Uo={transpose:function(t,r){const e=r.length,o=r[0].length;for(let n=0;n<e;n++)for(let e=0;e<o;e++)t[e][n]=r[n][e]},identity:function(t){for(let r=0,e=t.length;r<e;r++)for(let e=0,o=t.length;e<o;e++)t[r][e]=r===e?1:0},scale:function(t,r,e){for(let o=0,n=t.length;o<n;o++)for(let n=0,a=t.length;n<a;n++)t[o][n]=r[o][n]*e},multiply:function(t,r,e){if(r===t||e===t)throw new Error("Matrix: Cannot multiply to a matrix in place.");const o=r.length,n=e.length,a=e[0].length;for(let i=0,s=o;i<s;i++)for(let o=0,s=a;o<s;o++){let a=0;for(let t=0,s=n;t<s;t++)a+=r[i][t]*e[t][o];t[i][o]=a}},create:Jo,copy:Lo,clone:function(t){const r=Jo(t.length,t[0].length);return Lo(r,t),r},solve:function(t,r,o){const n=e(Vo).solve(r,o);for(let r=0,e=n.length;r<e;r++)t[r].set(n[r])},svd:function(t,r,e,o){const{u:n,v:a,q:i}=qo.SVD(o),s=n.length;for(let r=0;r<s;r++)t[r].set(n[r]);const l=a.length;for(let t=0;t<l;t++)e[t].set(a[t]);const h=i.length;for(let t=0;t<h;t++){const e=r[t],o=i[t];e.fill(0),e[t]=o}},invert:function(t,r){const o=e(Vo).invert(r),n=r[0].length,a=r.length;for(let r=0;r<n;r++)for(let e=0;e<a;e++)t[r][e]=o[r][e]},add:function(t,r,e){const o=r.length,n=r[0].length;for(let a=0;a<o;a++)for(let o=0;o<n;o++)t[a][o]=r[a][o]+e[a][o]},subtract:function(t,r,e){const o=r.length,n=r[0].length;for(let a=0;a<o;a++)for(let o=0;o<n;o++)t[a][o]=r[a][o]-e[a][o]},magnitudeSquared:No,magnitude:function(t){return Math.sqrt(No(t))},toString:Ro,log:function(t,r){console.log(Ro(t,r))}},ko=new Float64Array(16),Io=new Float64Array(16),_o=new Float64Array(16),Zo=new Float64Array(16),Xo=new Float64Array(4),Yo=new Float64Array(3),Oo=new Float64Array(4),Qo=new Float64Array(3),Go=[],jo=[],zo={rowCount:0,isConverged:!1,totalError:0},Bo={errorRows:0,freeDoF:0,totalError:0},Ho={CONVERGED:0,STALLED:1,DIVERGED:2,TIMEOUT:3};Object.entries(Ho).sort(((t,r)=>t[1]-r[1])).map((t=>t[0]));class Ko{constructor(t){this.chain=Array.from(t),this.targets=null,this.affectedClosures=null,this.affectedConnectedClosures=null,this.lockedJointDoFCount=null,this.lockedJointDoF=null,this.prevDoFValues=null,this.maxIterations=-1,this.matrixPool=null,this.useSVD=!1,this.translationConvergeThreshold=-1,this.rotationConvergeThreshold=-1,this.translationFactor=-1,this.rotationFactor=-1,this.translationStep=-1,this.rotationStep=-1,this.translationErrorClamp=-1,this.rotationErrorClamp=-1,this.stallThreshold=-1,this.dampingFactor=-1,this.divergeThreshold=-1,this.restPoseFactor=-1,this.init()}init(){const t=this.chain,r=t.filter((t=>t.targetSet||t.isClosure)),e=new Map,o=new Map,n=new Map,a=new Map,i=new Map;t.forEach((t=>{a.set(t,new Set),i.set(t,new Set),e.set(t,new Uint8Array(6)),n.set(t,new Float64Array(6))})),r.forEach((t=>{if(t.isClosure){let r=t;for(;r;)r.isJoint&&a.get(r).add(t),r=r.parent;for(r=t.child;r;)r.isJoint&&i.get(r).add(t),r=r.parent}})),this.targets=r,this.affectedClosures=a,this.affectedConnectedClosures=i,this.lockedJointDoF=e,this.lockedJointDoFCount=o,this.prevDoFValues=n}solve(){const{divergeThreshold:t,stallThreshold:r,chain:e,restPoseFactor:o,lockedJointDoFCount:n,prevDoFValues:a,useSVD:i,matrixPool:s}=this;let l=0,h=1/0,u=-1;n.clear();for(let t=0,r=e.length;t<r;t++){const r=e[t];(r.targetSet||r.restPoseSet)&&r.tryMinimizeEulerAngles()}for(;;){s.releaseAll();for(let t=0,r=e.length;t<r;t++){e[t].updateMatrixWorld()}Go.length=0,jo.length=0,this.countUnconvergedVariables(jo,Go,Bo);const{freeDoF:n,errorRows:c,totalError:f}=Bo;if(0===c){u=Ho.CONVERGED;break}if(f>h+t){a.forEach(((t,r)=>{r.dofValues.set(t),r.setMatrixDoFNeedsUpdate()})),u=Ho.DIVERGED;break}if(h=f,l++,l>this.maxIterations){u=Ho.TIMEOUT;break}const d=s.get(c,1);this.fillErrorVector(Go,d);const M=s.get(c,n);this.fillJacobian(Go,jo,M);const m=s.get(n,c);let g=!1;if(i)try{const t=c,r=n,e=Math.min(t,r),o=s.get(t,e),a=s.get(e,e),i=s.get(r,e);Uo.svd(o,a,i,M);const l=s.get(e,t),h=s.get(e,e);Uo.transpose(l,o);for(let t=0,r=a.length;t<r;t++){const r=a[t][t];let e;e=Math.abs(r)<.001?0:1/r,h[t][t]=e}const u=s.get(r,e);Uo.multiply(u,i,h),Uo.multiply(m,u,l)}catch(t){g=!0}if(!i||g){const t=s.get(c,c);Uo.identity(t),Uo.scale(t,t,this.dampingFactor**2);const r=s.get(n,c);Uo.transpose(r,M);const e=s.get(c,c);Uo.multiply(e,M,r);const o=s.get(c,c);Uo.add(o,e,t);const a=s.get(c,c);Uo.invert(a,o),Uo.multiply(m,r,a)}const p=s.get(n,1);if(Uo.multiply(p,m,d),0!==o){const t=s.get(n,1),r=s.get(n,1);let e=0;for(let r=0,o=jo.length;r<o;r++){const o=jo[r],n=this.lockedJointDoFCount.get(o)||0,a=0!==n,i=this.lockedJointDoF.get(o),s=o.rotationDoFCount+o.translationDoFCount-n;if(o.restPoseSet){const r=o.dof,n=o.dofValues,l=o.dofRestPose;for(let o=0;o<s;o++){const s=r[o];a&&i[s]||(t[e][0]=l[s]-n[s],e++)}}else for(let r=0;r<s;r++)t[e][0]=0,e++}const a=s.get(n,n);Uo.multiply(a,m,M);const i=s.get(n,n);Uo.identity(i);const l=s.get(n,n);Uo.subtract(l,i,a),Uo.multiply(r,l,t);for(let t=0;t<n;t++){const e=r[t][0];p[t][0]+=e*o}}if(r>0){let t=!0;for(let e=0,o=p.length;e<o;e++){const o=p[e][0];if(Math.abs(o)>r){t=!1;break}}if(t){u=Ho.STALLED;break}}a.forEach(((t,r)=>{t.set(r.dofValues)})),this.applyJointAngles(jo,p)}return Go.length=0,jo.length=0,u}applyJointAngles(t,r){const{lockedJointDoF:e,lockedJointDoFCount:o}=this;let n=!1,a=0;for(let i=0,s=t.length;i<s;i++){const s=t[i],l=s.dof,h=e.get(s),u=o.has(s);for(let t=0,e=l.length;t<e;t++){const e=l[t];if(u&&h[e])continue;const i=s.getDoFValue(e);if(s.setDoFValue(e,i+r[a][0])){o.has(s)||(o.set(s,0),h.fill(0));const t=o.get(s);o.set(s,t+1),h[e]=1,n=!0}a++}}if(a!==r.length)throw new Error;return n}fillJacobian(t,r,e){const{translationStep:n,rotationStep:a,lockedJointDoF:i,lockedJointDoFCount:s,translationFactor:l,rotationFactor:h}=this,u=this.affectedClosures,c=this.affectedConnectedClosures;let f=0;for(let d=0,M=r.length;d<M;d++){const M=r[d],m=u.get(M),g=c.get(M),p=M.dof,v=M.translationDoFCount+M.rotationDoFCount,F=s.has(M),x=i.get(M);o.invert(Zo,M.matrixWorld);for(let r=0;r<v;r++){const i=p[r];if(F&&x[i])continue;let s=0,u=i<3?n:a;M.getDeltaWorldMatrix(i,u,_o)&&(u*=-1);for(let r=0,n=t.length;r<n;r++){const n=t[r];if(n.isClosure)if(m.has(n)||g.has(n))if(n.getClosureError(Yo,Xo),g.has(n)?(o.multiply(ko,Zo,n.child.matrixWorld),o.multiply(Io,_o,ko),co(n.matrixWorld,Io,Qo,Oo)):(o.multiply(ko,Zo,n.matrixWorld),o.multiply(Io,_o,ko),co(Io,n.child.matrixWorld,Qo,Oo)),at.subtract(Yo,Yo,Qo),at.scale(Yo,Yo,l/u),rr.subtract(Xo,Xo,Oo),rr.scale(Xo,Xo,h/u),n.isGoal){const{translationDoFCount:t,rotationDoFCount:r,dof:o}=n;for(let r=0;r<t;r++){const t=o[r];e[s+r][f]=Yo[t]}3===r&&(e[s+t+0][f]=Xo[0],e[s+t+1][f]=Xo[1],e[s+t+2][f]=Xo[2],e[s+t+3][f]=Xo[3],s+=4),s+=t}else e[s+0][f]=Yo[0],e[s+1][f]=Yo[1],e[s+2][f]=Yo[2],e[s+3][f]=Xo[0],e[s+4][f]=Xo[1],e[s+5][f]=Xo[2],e[s+6][f]=Xo[3],s+=7;else{let t=7;n.isGoal&&(t=n.translationDoFCount,3===n.rotationDoFCount&&(t+=4));for(let r=0;r<t;r++)e[s+r][f]=0;s+=t}if(n.targetSet){const t=n.translationDoFCount+n.rotationDoFCount;if(M===n)for(let r=0;r<t;r++)e[s+f][f]=-1;else for(let r=0;r<t;r++)e[s+r][f]=0;s+=t}}f++}}if(f!==e[0].length)throw new Error}fillErrorVector(t,r){let e=0;for(let o=0,n=t.length;o<n;o++){const n=t[o];n.isClosure&&(Ao(this,n,e,r,zo),e+=zo.rowCount),n.targetSet&&(To(this,n,e,r,zo),e+=zo.rowCount)}}countUnconvergedVariables(t,r,e){const{lockedJointDoFCount:o}=this,n=this.chain;let a=0,i=0,s=0,l=0;for(let e=0,h=n.length;e<h;e++){let h=!1;const u=n[e],c=o.get(u)||0;u.isClosure&&(Ao(this,u,i,null,zo),zo.isConverged||(s+=zo.rowCount,a+=zo.totalError),h=!0,i+=zo.rowCount);const f=u.dof;u.targetSet&&(To(this,u,i,null,zo),zo.isConverged||(s+=zo.rowCount,a+=zo.totalError),h=!0,i+=zo.rowCount),!u.isGoal&&f.length>0&&(l+=f.length-c,t.push(u)),h&&r.push(u)}0===s&&(i=0),e.errorRows=i,e.freeDoF=l,e.totalError=a}}class $o{constructor(t,r){const e=[];let o=0;this.get=function(){let n=e[o];return n||(e[o]=n=Uo.create(t,r)),o++,n},this.releaseAll=function(){o=0}}}class tn{constructor(){const t={},r=[];this.get=function(e,o){let n=t[e];n||(n=t[e]={});let a=n[o];return a||(a=n[o]=new $o(e,o),r.push(a)),a.get()},this.releaseAll=function(){for(let t=0,e=r.length;t<e;t++)r[t].releaseAll()}}}class rn extends Be{constructor(){super(),this.isLink=!0,this.closureJoints=[]}addChild(t){if(!t.isJoint)throw new Error("Link: Added child must be a Joint.");super.addChild(t)}}class en extends bo{constructor(...t){super(...t),this.isGoal=!0,this.setFreeDoF()}setDoF(...t){let r=Number(t.includes(fo.EX))+Number(t.includes(fo.EY))+Number(t.includes(fo.EZ));if(0!==r&&3!==r)throw new Error("Goal: Only full 3 DoF or 0 DoF rotation goals are supported.");super.setDoF(...t)}setGoalDoF(...t){this.setDoF(...t)}setFreeDoF(...t){const r=[fo.X,fo.Y,fo.Z,fo.EX,fo.EY,fo.EZ].filter((r=>!t.includes(r)));this.setDoF(...r)}addChild(){throw new Error("Goal: Cannot add children to Goal.")}}const on=304;function nn(t,r,e,o=!0,n=!0){for(let a=0,i=t.length;a<i;a++)an(t[a],r,e,a*on,o,n)}function an(t,r,e,o,n=!0,a=!0){const i=o/4;if(a){const{position:n,quaternion:a}=t;for(let t=0;t<3;t++)r[i+0+t]=n[t];for(let t=0;t<4;t++)r[i+3+t]=a[t];if(t.isJoint){const{dofTarget:n,dofRestPose:a,minDoFLimit:s,maxDoFLimit:l,targetSet:h,restPoseSet:u}=t;for(let t=0;t<6;t++)r[i+7+0+t]=n[t],r[i+7+6+t]=a[t],r[i+7+12+t]=s[t],r[i+7+18+t]=l[t];e[o+148]=Number(h),e[o+149]=Number(u)}}if(n&&t.isJoint){const{dofValues:e}=t;for(let t=0;t<6;t++)r[i+7+24+t]=e[t]}}function sn(t,r,e,o,n=!0,a=!0){const i=o/4;if(a&&(t.setPosition(r[i+0],r[i+1],r[i+2]),t.setQuaternion(r[i+3+0],r[i+3+1],r[i+3+2],r[i+3+3]),t.isJoint)){const{dofTarget:n,dofRestPose:a,minDoFLimit:s,maxDoFLimit:l}=t;for(let t=0;t<6;t++)n[t]=r[i+7+0+t],a[t]=r[i+7+6+t],s[t]=r[i+7+12+t],l[t]=r[i+7+18+t];t.targetSet=Boolean(e[o+148]),t.restPoseSet=Boolean(e[o+149])}if(n&&t.isJoint){const{dofValues:e}=t;let o=!1;for(let t=0;t<6;t++){const n=r[i+7+24+t];n!==e[t]&&(e[t]=n,o=!0)}o&&t.setMatrixDoFNeedsUpdate()}}const ln="undefined"!=typeof SharedArrayBuffer;let hn=new class{constructor(t=[]){this.matrixPool=new tn,this.useSVD=!1,this.maxIterations=5,this.stallThreshold=1e-4,this.dampingFactor=.001,this.divergeThreshold=.01,this.restPoseFactor=.01,this.translationConvergeThreshold=.001,this.rotationConvergeThreshold=1e-5,this.translationFactor=1,this.rotationFactor=1,this.translationStep=.001,this.rotationStep=.001,this.translationErrorClamp=.1,this.rotationErrorClamp=.1,this.roots=Array.isArray(t)?[...t]:[t],this.solvers=null,this.updateStructure()}updateStructure(){const t=function(t){const r=t.map((t=>{let r=t;return t.traverseParents((t=>{r=t})),r})),e=[],o=new Set;for(let t=0;t<r.length;t++){const n=r[t];o.has(n)||(e.push(n),n.traverse((t=>{if(o.has(t))return!0;let e;o.add(t),t.isLink?e=t.closureJoints:t.isJoint&&t.isClosure&&(e=[t.child]),e&&e.forEach((t=>{let e=t;t.traverseParents((t=>{e=t})),o.has(e)||r.push(e)}))})))}return e}(this.roots),r=[],e=new Set,o=new Set,n=t=>{if(t.isJoint){const n=t;if(e.add(n),n.isClosure){const t=new Set;let a=n.child;for(;a;){if(a.isJoint){if(e.has(a))break;t.add(a),o.add(a)}a=a.parent}e.forEach((r=>{t.add(r),o.add(r)})),r.push(t)}}const a=t.children;for(let t=0,r=a.length;t<r;t++)n(a[t]);e.delete(t)};t.forEach(n);const a=[];for(;r.length;){const t=r.pop();a.push(t);for(let e=0;e<r.length;e++){const o=r[e];let n=!1;o.forEach((r=>{n=n||t.has(r)})),n&&(o.forEach((r=>t.add(r))),r.splice(e,1),e--)}}const i=new Set;t.forEach((t=>t.traverse((t=>{t.isJoint&&t.dof.length>0&&!o.has(t)&&i.add(t)})))),this.solvers=a.map((t=>new Ko(t))),this.nonChainJoints=i}solve(){const{solvers:t,nonChainJoints:r}=this;r.forEach((t=>{t.targetSet&&(t.dofValues.set(t.dofTarget),t.setMatrixDoFNeedsUpdate())}));const e=[];for(let r=0,o=t.length;r<o;r++){const o=t[r];o.matrixPool=this.matrixPool,o.useSVD=this.useSVD,o.maxIterations=this.maxIterations,o.stallThreshold=this.stallThreshold,o.dampingFactor=this.dampingFactor,o.divergeThreshold=this.divergeThreshold,o.restPoseFactor=this.restPoseFactor,o.translationConvergeThreshold=this.translationConvergeThreshold,o.rotationConvergeThreshold=this.rotationConvergeThreshold,o.translationFactor=this.translationFactor,o.rotationFactor=this.rotationFactor,o.translationStep=this.translationStep,o.rotationStep=this.rotationStep,o.translationErrorClamp=this.translationErrorClamp,o.rotationErrorClamp=this.rotationErrorClamp;const n=o.solve();e.push(n)}return e}},un=-1,cn=null,fn=null,dn=null,Mn=null;function mn(){!function(t,r,e,o=!0,n=!0){for(let a=0,i=t.length;a<i;a++)sn(t[a],r,e,on*a,o,n)}(cn,dn,Mn,!1,!0);const t=hn.solve();if(nn(cn,dn,Mn,!0,!1),un=t.find((t=>t===Ho.TIMEOUT))?setTimeout(mn):-1,ln)this.postMessage({type:"updateSolve",data:{status:t}});else{const r=fn.slice();this.postMessage({type:"updateSolve",data:{status:t,buffer:r}},[r])}}t.onmessage=function({data:t}){const{type:r,data:e}=t;switch(r){case"updateStructure":cn=function(t){const r=t.map((t=>{const{type:r,name:e,position:o,quaternion:n,dof:a,dofValues:i,dofTarget:s,dofRestPose:l,minDoFLimit:h,maxDoFLimit:u,targetSet:c,restPoseSet:f,isClosure:d}=t;let M;switch(r){case"Goal":case"Joint":M="Goal"===r?new en:new bo,M.setDoF(...a),M.dofValues.set(i),M.dofTarget.set(s),M.dofRestPose.set(l),M.minDoFLimit.set(h),M.maxDoFLimit.set(u),M.targetSet=c,M.restPoseSet=f,M.isClosure=d;break;case"Link":M=new rn}return M.name=e,M.position.set(o),M.quaternion.set(n),M}));for(let e=0;e<r.length;e++){const o=r[e],n=t[e];o.parent=r[n.parent]||null,o.children.push(...n.children.map((t=>r[t]))),o.setMatrixNeedsUpdate(),o.isLink&&o.closureJoints.push(...n.closureJoints.map((t=>r[t]))),o.isJoint&&(o.child=null!==n.child?r[n.child]:null,o.setMatrixDoFNeedsUpdate())}return r}(e.serialized),hn.roots=cn.filter((t=>null===t.parent)),hn.updateStructure(),fn=e.buffer,Mn=new Uint8Array(fn),dn=new Float32Array(fn);break;case"updateFrameState":Mn.set(new Uint8Array(e.buffer));break;case"updateSolverSettings":Object.assign(hn,e);break;case"startSolve":-1===un&&mn();break;case"endSolve":-1!==un&&(clearTimeout(un),un=-1)}}})();
//# sourceMappingURL=workerSolver.worker.121d601e.js.map
