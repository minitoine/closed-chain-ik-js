{"mappings":"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","sources":["example/loadModels.js","node_modules/urdf-loader/src/URDFLoader.js","node_modules/three/examples/jsm/loaders/STLLoader.js","node_modules/three/examples/jsm/loaders/ColladaLoader.js","node_modules/three/examples/jsm/loaders/TGALoader.js","node_modules/urdf-loader/src/URDFClasses.js","node_modules/xacro-parser/src/XacroLoader.js","node_modules/xacro-parser/src/utils.js","node_modules/xacro-parser/src/XacroParser.js","node_modules/xacro-parser/src/evaluateExpression.js","node_modules/expr-eval/dist/index.mjs"],"sourcesContent":["import URDFLoader from 'urdf-loader';\nimport {\n\tJoint,\n\turdfRobotToIKRoot,\n\tsetIKFromUrdf,\n} from '../src/index.js';\nimport { DEG2RAD } from '../src/core/utils/constants.js';\nimport { LoadingManager, sRGBEncoding } from 'three';\nimport { XacroLoader } from 'xacro-parser';\nimport { quat } from 'gl-matrix';\n\n// convert colors and texture to correct color space. Three.js Collada Loader does not\n// set these correctly.\nfunction convertColorsAndTextures( root ) {\n\n\tfunction _apply( material ) {\n\n\t\tmaterial.color.convertSRGBToLinear();\n\t\tif ( material.map ) material.map.encoding = sRGBEncoding;\n\n\t}\n\n\troot.traverse( c => {\n\n\t\tif ( c.material ) {\n\n\t\t\tconst material = c.material;\n\t\t\tif ( Array.isArray( material ) ) {\n\n\t\t\t\tmaterial.forEach( _apply );\n\n\t\t\t} else {\n\n\t\t\t\t_apply( material );\n\n\t\t\t}\n\n\t\t}\n\n\t} );\n\n}\n\nexport function loadCuriosity() {\n\n\treturn new Promise( ( resolve, reject ) => {\n\n\t\tconst url = 'https://raw.githubusercontent.com/gkjohnson/curiosity_mars_rover-mirror/master/curiosity_mars_rover_description/urdf/curiosity_mars_rover.xacro';\n\t\tconst xacroLoader = new XacroLoader();\n\t\txacroLoader.rospackCommands = {\n\n\t\t\tfind( pkg ) {\n\n\t\t\t\tswitch ( pkg ) {\n\n\t\t\t\t\tcase 'curiosity_mars_rover_description':\n\t\t\t\t\t\treturn 'https://raw.githubusercontent.com/gkjohnson/curiosity_mars_rover-mirror/master/curiosity_mars_rover_description/';\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn pkg;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t};\n\n\t\txacroLoader.load( url, xacro => {\n\n\t\t\tlet ik, urdf, goalMap;\n\n\t\t\tconst manager = new LoadingManager();\n\t\t\tmanager.onLoad = () => {\n\n\t\t\t\tconst toRemove = [];\n\t\t\t\turdf.traverse( c => {\n\n\t\t\t\t\tif ( c.isLight || c.isLineSegments ) {\n\n\t\t\t\t\t\ttoRemove.push( c );\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t\ttoRemove.forEach( l => {\n\n\t\t\t\t\tl.parent.remove( l );\n\n\t\t\t\t} );\n\n\t\t\t\tconvertColorsAndTextures( urdf );\n\n\t\t\t\tresolve( { ik, urdf, goalMap, helperScale: 0.3 } );\n\n\t\t\t};\n\n\t\t\tconst urdfLoader = new URDFLoader( manager );\n\t\t\turdfLoader.packages = {\n\t\t\t\t'curiosity_mars_rover_description': 'https://raw.githubusercontent.com/gkjohnson/curiosity_mars_rover-mirror/master/curiosity_mars_rover_description/'\n\t\t\t};\n\t\t\turdf = urdfLoader.parse( xacro );\n\t\t\turdf.joints.arm_03_joint.limit.upper = Math.PI * 3 / 2;\n\t\t\tik = urdfRobotToIKRoot( urdf );\n\n\t\t\t// make the root fixed\n\t\t\tik.clearDoF();\n\t\t\tquat.fromEuler( ik.quaternion, - 90, 0, 0 );\n\t\t\tik.position[ 1 ] -= 0.5;\n\t\t\tik.setMatrixNeedsUpdate();\n\n\t\t\t// start the joints off at reasonable angles\n\t\t\turdf.setJointValue( 'arm_02_joint', - Math.PI / 2 );\n\t\t\turdf.setJointValue( 'arm_03_joint', Math.PI );\n\t\t\turdf.setJointValue( 'arm_04_joint', Math.PI );\n\t\t\t// urdf.setJointValue( 'joint_5', - Math.PI / 4 );\n\t\t\tsetIKFromUrdf( ik, urdf );\n\n\t\t\tgoalMap = new Map();\n\t\t\tconst tool = ik.find( l => l.name === 'arm_tools' );\n\t\t\tconst link = urdf.links.arm_tools;\n\n\t\t\tconst ee = new Joint();\n\t\t\tee.name = link.name;\n\t\t\tee.makeClosure( tool );\n\n\t\t\ttool.getWorldPosition( ee.position );\n\t\t\ttool.getWorldQuaternion( ee.quaternion );\n\t\t\tee.setMatrixNeedsUpdate();\n\t\t\tgoalMap.set( ee, tool );\n\n\t\t}, reject );\n\n\t} );\n\n}\n\nexport function loadStaubli() {\n\n\treturn new Promise( ( resolve, reject ) => {\n\n\t\tconst url = 'https://raw.githubusercontent.com/ros-industrial/staubli_experimental/ce422fe0a54232d73cf44e2571fc7abc2f5ff9f6/staubli_tx2_90_support/urdf/tx2_90.xacro';\n\t\tconst xacroLoader = new XacroLoader();\n\t\txacroLoader.rospackCommands = {\n\n\t\t\tfind( pkg ) {\n\n\t\t\t\tswitch ( pkg ) {\n\n\t\t\t\t\tcase 'staubli_resources':\n\t\t\t\t\t\treturn 'https://raw.githubusercontent.com/ros-industrial/staubli/indigo-devel/staubli_resources/';\n\t\t\t\t\tcase 'staubli_tx2_90_support':\n\t\t\t\t\t\treturn 'https://raw.githubusercontent.com/ros-industrial/staubli_experimental/ce422fe0a54232d73cf44e2571fc7abc2f5ff9f6/staubli_tx2_90_support/';\n\t\t\t\t\tdefault:\n\t\t\t\t\t\treturn pkg;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t};\n\n\t\txacroLoader.load( url, xacro => {\n\n\t\t\tlet ik, urdf, goalMap;\n\n\t\t\tconst manager = new LoadingManager();\n\t\t\tmanager.onLoad = () => {\n\n\t\t\t\tresolve( { ik, urdf, goalMap, helperScale: 0.3 } );\n\n\t\t\t};\n\n\t\t\tconst urdfLoader = new URDFLoader( manager );\n\t\t\turdfLoader.packages = {\n\t\t\t\t'staubli_tx2_90_support': 'https://raw.githubusercontent.com/ros-industrial/staubli_experimental/ce422fe0a54232d73cf44e2571fc7abc2f5ff9f6/staubli_tx2_90_support/'\n\t\t\t};\n\t\t\turdf = urdfLoader.parse( xacro );\n\t\t\tik = urdfRobotToIKRoot( urdf );\n\n\t\t\t// make the root fixed\n\t\t\tik.clearDoF();\n\t\t\tquat.fromEuler( ik.quaternion, - 90, 0, 0 );\n\t\t\tik.position[ 1 ] -= 0.5;\n\t\t\tik.setMatrixNeedsUpdate();\n\n\t\t\t// start the joints off at reasonable angles\n\t\t\turdf.setJointValue( 'joint_2', Math.PI / 4 );\n\t\t\turdf.setJointValue( 'joint_3', Math.PI / 2 );\n\t\t\turdf.setJointValue( 'joint_5', - Math.PI / 4 );\n\t\t\tsetIKFromUrdf( ik, urdf );\n\n\t\t\tgoalMap = new Map();\n\t\t\tconst tool = ik.find( l => l.name === 'tool0' );\n\t\t\tconst link = urdf.links.tool0;\n\n\t\t\tconst ee = new Joint();\n\t\t\tee.name = link.name;\n\t\t\tee.makeClosure( tool );\n\n\t\t\ttool.getWorldPosition( ee.position );\n\t\t\ttool.getWorldQuaternion( ee.quaternion );\n\t\t\tee.setMatrixNeedsUpdate();\n\t\t\tgoalMap.set( ee, tool );\n\n\t\t}, reject );\n\n\t} );\n\n}\n\nexport function loadATHLETE() {\n\n\treturn new Promise( ( resolve, reject ) => {\n\n\t\tlet ik, urdf, goalMap;\n\t\tconst manager = new LoadingManager();\n\t\tmanager.onLoad = () => {\n\n\t\t\tresolve( { ik, urdf, goalMap } );\n\n\t\t};\n\n\t\tconst url = 'https://raw.githubusercontent.com/gkjohnson/urdf-loaders/master/urdf/T12/urdf/T12_flipped.URDF';\n\n\t\tconst loader = new URDFLoader( manager );\n\t\tloader.load( url, result => {\n\n\t\t\turdf = result;\n\t\t\tik = urdfRobotToIKRoot( urdf );\n\n\t\t\t// update the robot joints\n\t\t\tconst DEG2RAD = Math.PI / 180;\n\t\t\turdf.rotation.set( Math.PI / 2, 0, 0 );\n\t\t\tfor ( let i = 1; i <= 6; i ++ ) {\n\n\t\t\t\turdf.joints[ `HP${ i }` ].setJointValue( 30 * DEG2RAD );\n\t\t\t\turdf.joints[ `KP${ i }` ].setJointValue( 90 * DEG2RAD );\n\t\t\t\turdf.joints[ `AP${ i }` ].setJointValue( - 30 * DEG2RAD );\n\n\t\t\t}\n\n\t\t\t// update the degrees of freedom of the joints\n\t\t\tsetIKFromUrdf( ik, urdf );\n\n\t\t\t// store the rest pose\n\t\t\tgoalMap = new Map();\n\t\t\tik.traverse( c => {\n\n\t\t\t\tif ( c.isJoint ) {\n\n\t\t\t\t\tc.dofRestPose.set( c.dofValues );\n\t\t\t\t\tc.restPoseSet = true;\n\n\t\t\t\t} else if ( /^Foot/.test( c.name ) ) {\n\n\t\t\t\t\tconst link = urdf.links[ c.name ];\n\t\t\t\t\tconst ee = new Joint();\n\t\t\t\t\tee.name = link.name;\n\t\t\t\t\tee.makeClosure( c );\n\n\t\t\t\t\tc.getWorldPosition( ee.position );\n\t\t\t\t\tc.getWorldQuaternion( ee.quaternion );\n\t\t\t\t\tee.setMatrixNeedsUpdate();\n\n\t\t\t\t\tgoalMap.set( ee, c );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t}, null, reject );\n\n\t} );\n\n}\n\nexport function loadRobonaut() {\n\n\treturn new Promise( ( resolve, reject ) => {\n\n\t\tlet urdf, ik, goalMap;\n\t\tconst manager = new LoadingManager();\n\t\tmanager.onLoad = () => {\n\n\t\t\tconvertColorsAndTextures( urdf );\n\n\t\t\tresolve( { ik, urdf, goalMap, helperScale: 0.2 } );\n\n\t\t};\n\n\t\tconst url = 'https://raw.githubusercontent.com/gkjohnson/nasa-urdf-robots/master/r2_description/robots/r2b.urdf';\n\t\tconst loader = new URDFLoader( manager );\n\t\tloader.packages = {\n\t\t\tr2_description: 'https://raw.githubusercontent.com/gkjohnson/nasa-urdf-robots/master/r2_description',\n\t\t};\n\t\tloader.load( url, result => {\n\n\t\t\turdf = result;\n\t\t\turdf.rotation.set( - Math.PI / 2, 0, 0 );\n\n\t\t\tik = urdfRobotToIKRoot( urdf );\n\n\t\t\turdf.joints[ 'r2/left_leg/joint3' ].setJointValue( 60 * DEG2RAD );\n\t\t\turdf.joints[ 'r2/left_leg/joint5' ].setJointValue( 60 * DEG2RAD );\n\t\t\turdf.joints[ 'r2/left_arm/joint1' ].setJointValue( - 80 * DEG2RAD );\n\t\t\turdf.joints[ 'r2/left_arm/joint2' ].setJointValue( - 100 * DEG2RAD );\n\t\t\turdf.joints[ 'r2/left_arm/joint3' ].setJointValue( - 90 * DEG2RAD );\n\t\t\turdf.joints[ 'r2/left_arm/joint4' ].setJointValue( 90 * DEG2RAD );\n\n\t\t\turdf.joints[ 'r2/right_leg/joint3' ].setJointValue( 60 * DEG2RAD );\n\t\t\turdf.joints[ 'r2/right_leg/joint5' ].setJointValue( 60 * DEG2RAD );\n\t\t\turdf.joints[ 'r2/right_arm/joint1' ].setJointValue( - 80 * DEG2RAD );\n\t\t\turdf.joints[ 'r2/right_arm/joint2' ].setJointValue( 100 * DEG2RAD );\n\t\t\turdf.joints[ 'r2/right_arm/joint3' ].setJointValue( - 90 * DEG2RAD );\n\t\t\turdf.joints[ 'r2/right_arm/joint4' ].setJointValue( - 90 * DEG2RAD );\n\n\t\t\tsetIKFromUrdf( ik, urdf );\n\n\t\t\tgoalMap = new Map();\n\t\t\tik.traverse( c => {\n\n\t\t\t\tif ( c.isJoint ) {\n\n\t\t\t\t\tc.dofRestPose.set( c.dofValues );\n\t\t\t\t\tc.restPoseSet = true;\n\n\t\t\t\t} else if (\n\t\t\t\t\tc.name === 'r2/left_leg_foot' ||\n\t\t\t\t\tc.name === 'r2/right_leg_foot'\n\t\t\t\t) {\n\n\t\t\t\t\tconst link = urdf.links[ c.name ];\n\t\t\t\t\tconst ee = new Joint();\n\t\t\t\t\tee.name = link.name;\n\t\t\t\t\tee.makeClosure( c );\n\n\t\t\t\t\tc.getWorldPosition( ee.position );\n\t\t\t\t\tc.getWorldQuaternion( ee.quaternion );\n\t\t\t\t\tee.setMatrixNeedsUpdate();\n\n\t\t\t\t\tgoalMap.set( ee, c );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\n\t\t}, null, reject );\n\n\t} );\n\n}\n\nexport function loadAthnaut() {\n\n\treturn new Promise( ( resolve, reject ) => {\n\n\t\tlet athlete, r2, url, loader;\n\n\t\tconst manager = new LoadingManager();\n\t\turl = 'https://raw.githubusercontent.com/gkjohnson/urdf-loaders/master/urdf/T12/urdf/T12_flipped.URDF';\n\t\tloader = new URDFLoader( manager );\n\t\tloader.load( url, robot => athlete = robot, null, reject );\n\n\t\turl = 'https://raw.githubusercontent.com/gkjohnson/nasa-urdf-robots/master/r2_description/robots/r2c5.urdf';\n\t\tloader = new URDFLoader( manager );\n\t\tloader.packages = {\n\t\t\tr2_description: 'https://raw.githubusercontent.com/gkjohnson/nasa-urdf-robots/master/r2_description',\n\t\t};\n\t\tloader.load( url, robot => r2 = robot, null, reject );\n\n\t\tmanager.onLoad = () => {\n\n\t\t\tconst r22 = r2.clone();\n\n\t\t\t// set up first r2\n\t\t\tathlete.links[ 'Foot1' ].traverse( c => c.visible = ! c.isMesh );\n\n\t\t\tconst r2Base = r2.joints[ 'r2/fixed/stanchion/robot_base' ];\n\t\t\tathlete.links[ 'Foot1' ].add( r2Base );\n\t\t\tr2Base.position.z = 0.15;\n\t\t\tr2Base.rotation.z = Math.PI;\n\n\t\t\tObject.assign( athlete.joints, r2.joints );\n\t\t\tObject.assign( athlete.links, r2.links );\n\n\t\t\t// set up second r2\n\t\t\tObject.keys( r22.links ).forEach( l => {\n\n\t\t\t\tr22.links[ l + '_2' ] = r22.links[ l ];\n\t\t\t\tr22.links[ l ].name = l + '_2';\n\n\t\t\t\tdelete r22.links[ l ];\n\n\t\t\t} );\n\t\t\tObject.keys( r22.joints ).forEach( l => {\n\n\t\t\t\tr22.joints[ l + '_2' ] = r22.joints[ l ];\n\t\t\t\tr22.joints[ l ].name = l + '_2';\n\n\t\t\t\tdelete r22.joints[ l ];\n\n\t\t\t} );\n\n\t\t\tathlete.links[ 'Foot6' ].traverse( c => c.visible = ! c.isMesh );\n\n\t\t\tconst r22Base = r22.joints[ 'r2/fixed/stanchion/robot_base_2' ];\n\t\t\tathlete.links[ 'Foot6' ].add( r22Base );\n\t\t\tr22Base.position.z = 0.15;\n\t\t\tr22Base.rotation.z = Math.PI;\n\n\t\t\tObject.assign( athlete.joints, r22.joints );\n\t\t\tObject.assign( athlete.links, r22.links );\n\n\n\t\t\tconst ik = urdfRobotToIKRoot( athlete );\n\n\t\t\t// update the robot joints\n\t\t\tconst DEG2RAD = Math.PI / 180;\n\t\t\tathlete.rotation.set( Math.PI / 2, 0, 0 );\n\t\t\tfor ( let i = 1; i <= 6; i ++ ) {\n\n\t\t\t\tathlete.joints[ `HP${ i }` ].setJointValue( 30 * DEG2RAD );\n\t\t\t\tathlete.joints[ `KP${ i }` ].setJointValue( 90 * DEG2RAD );\n\t\t\t\tathlete.joints[ `AP${ i }` ].setJointValue( - 30 * DEG2RAD );\n\n\t\t\t}\n\n\t\t\tathlete.joints[ `HP1` ].setJointValue( - 30 * DEG2RAD );\n\t\t\tathlete.joints[ `KP1` ].setJointValue( - 60 * DEG2RAD );\n\t\t\tathlete.joints[ `AP1` ].setJointValue( 0 );\n\n\t\t\tathlete.joints[ `HP6` ].setJointValue( - 30 * DEG2RAD );\n\t\t\tathlete.joints[ `KP6` ].setJointValue( - 60 * DEG2RAD );\n\t\t\tathlete.joints[ `AP6` ].setJointValue( 0 );\n\n\t\t\tathlete.joints[ `HY2` ].setJointValue( 60 * DEG2RAD );\n\t\t\tathlete.joints[ `HY5` ].setJointValue( - 60 * DEG2RAD );\n\n\t\t\tathlete.joints[ 'r2/left_arm/joint1' ].setJointValue( - 80 * DEG2RAD );\n\t\t\tathlete.joints[ 'r2/left_arm/joint2' ].setJointValue( - 100 * DEG2RAD );\n\t\t\tathlete.joints[ 'r2/left_arm/joint3' ].setJointValue( - 90 * DEG2RAD );\n\t\t\tathlete.joints[ 'r2/left_arm/joint4' ].setJointValue( 90 * DEG2RAD );\n\n\t\t\tathlete.joints[ 'r2/right_arm/joint1' ].setJointValue( - 80 * DEG2RAD );\n\t\t\tathlete.joints[ 'r2/right_arm/joint2' ].setJointValue( 100 * DEG2RAD );\n\t\t\tathlete.joints[ 'r2/right_arm/joint3' ].setJointValue( - 90 * DEG2RAD );\n\t\t\tathlete.joints[ 'r2/right_arm/joint4' ].setJointValue( - 90 * DEG2RAD );\n\n\t\t\tathlete.joints[ 'r2/left_arm/joint1_2' ].setJointValue( - 80 * DEG2RAD );\n\t\t\tathlete.joints[ 'r2/left_arm/joint2_2' ].setJointValue( - 100 * DEG2RAD );\n\t\t\tathlete.joints[ 'r2/left_arm/joint3_2' ].setJointValue( - 90 * DEG2RAD );\n\t\t\tathlete.joints[ 'r2/left_arm/joint4_2' ].setJointValue( 90 * DEG2RAD );\n\n\t\t\tathlete.joints[ 'r2/right_arm/joint1_2' ].setJointValue( - 80 * DEG2RAD );\n\t\t\tathlete.joints[ 'r2/right_arm/joint2_2' ].setJointValue( 100 * DEG2RAD );\n\t\t\tathlete.joints[ 'r2/right_arm/joint3_2' ].setJointValue( - 90 * DEG2RAD );\n\t\t\tathlete.joints[ 'r2/right_arm/joint4_2' ].setJointValue( - 90 * DEG2RAD );\n\n\t\t\tsetIKFromUrdf( ik, athlete );\n\n\t\t\tconst goalMap = new Map();\n\t\t\tik.traverse( c => {\n\n\t\t\t\tif ( c.isJoint ) {\n\n\t\t\t\t\tc.dofRestPose.set( c.dofValues );\n\t\t\t\t\tc.restPoseSet = true;\n\n\t\t\t\t} else if ( /^Foot/.test( c.name ) ) {\n\n\t\t\t\t\tconst link = athlete.links[ c.name ];\n\t\t\t\t\tconst ee = new Joint();\n\t\t\t\t\tee.name = link.name;\n\t\t\t\t\tee.makeClosure( c );\n\n\t\t\t\t\tc.getWorldPosition( ee.position );\n\t\t\t\t\tc.getWorldQuaternion( ee.quaternion );\n\t\t\t\t\tee.setMatrixNeedsUpdate();\n\n\t\t\t\t\tgoalMap.set( ee, c );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t\tresolve( { ik, urdf: athlete, goalMap, helperScale: 0.2 } );\n\n\t\t};\n\n\t} );\n\n}\n","import * as THREE from 'three';\r\nimport { STLLoader } from 'three/examples/jsm/loaders/STLLoader.js';\r\nimport { ColladaLoader } from 'three/examples/jsm/loaders/ColladaLoader.js';\r\nimport { URDFRobot, URDFJoint, URDFLink, URDFCollider, URDFVisual, URDFMimicJoint } from './URDFClasses.js';\r\n\r\n/*\r\nReference coordinate frames for THREE.js and ROS.\r\nBoth coordinate systems are right handed so the URDF is instantiated without\r\nframe transforms. The resulting model can be rotated to rectify the proper up,\r\nright, and forward directions\r\n\r\nTHREE.js\r\n   Y\r\n   |\r\n   |\r\n   .-----X\r\n ／\r\nZ\r\n\r\nROS URDf\r\n       Z\r\n       |   X\r\n       | ／\r\n Y-----.\r\n\r\n*/\r\n\r\nconst tempQuaternion = new THREE.Quaternion();\r\nconst tempEuler = new THREE.Euler();\r\n\r\n// take a vector \"x y z\" and process it into\r\n// an array [x, y, z]\r\nfunction processTuple(val) {\r\n\r\n    if (!val) return [0, 0, 0];\r\n    return val.trim().split(/\\s+/g).map(num => parseFloat(num));\r\n\r\n}\r\n\r\n// applies a rotation a threejs object in URDF order\r\nfunction applyRotation(obj, rpy, additive = false) {\r\n\r\n    // if additive is true the rotation is applied in\r\n    // addition to the existing rotation\r\n    if (!additive) obj.rotation.set(0, 0, 0);\r\n\r\n    tempEuler.set(rpy[0], rpy[1], rpy[2], 'ZYX');\r\n    tempQuaternion.setFromEuler(tempEuler);\r\n    tempQuaternion.multiply(obj.quaternion);\r\n    obj.quaternion.copy(tempQuaternion);\r\n\r\n}\r\n\r\n/* URDFLoader Class */\r\n// Loads and reads a URDF file into a THREEjs Object3D format\r\nexport default\r\nclass URDFLoader {\r\n\r\n    constructor(manager) {\r\n\r\n        this.manager = manager || THREE.DefaultLoadingManager;\r\n        this.loadMeshCb = this.defaultMeshLoader.bind(this);\r\n        this.parseVisual = true;\r\n        this.parseCollision = false;\r\n        this.packages = '';\r\n        this.workingPath = '';\r\n        this.fetchOptions = {};\r\n\r\n    }\r\n\r\n    /* Public API */\r\n    loadAsync(urdf) {\r\n\r\n        return new Promise((resolve, reject) => {\r\n\r\n            this.load(urdf, resolve, null, reject);\r\n\r\n        });\r\n\r\n    }\r\n\r\n    // urdf:    The path to the URDF within the package OR absolute\r\n    // onComplete:      Callback that is passed the model once loaded\r\n    load(urdf, onComplete, onProgress, onError) {\r\n\r\n        // Check if a full URI is specified before\r\n        // prepending the package info\r\n        const manager = this.manager;\r\n        const workingPath = THREE.LoaderUtils.extractUrlBase(urdf);\r\n        const urdfPath = this.manager.resolveURL(urdf);\r\n\r\n        manager.itemStart(urdfPath);\r\n\r\n        fetch(urdfPath, this.fetchOptions)\r\n            .then(res => {\r\n\r\n                if (res.ok) {\r\n\r\n                    if (onProgress) {\r\n\r\n                        onProgress(null);\r\n\r\n                    }\r\n                    return res.text();\r\n\r\n                } else {\r\n\r\n                    throw new Error(`URDFLoader: Failed to load url '${ urdfPath }' with error code ${ res.status } : ${ res.statusText }.`);\r\n\r\n                }\r\n\r\n            })\r\n            .then(data => {\r\n\r\n                if (this.workingPath === '') {\r\n\r\n                    this.workingPath = workingPath;\r\n\r\n                }\r\n\r\n                const model = this.parse(data);\r\n                onComplete(model);\r\n                manager.itemEnd(urdfPath);\r\n\r\n            })\r\n            .catch(e => {\r\n\r\n                if (onError) {\r\n\r\n                    onError(e);\r\n\r\n                } else {\r\n\r\n                    console.error('URDFLoader: Error loading file.', e);\r\n\r\n                }\r\n                manager.itemError(urdfPath);\r\n                manager.itemEnd(urdfPath);\r\n\r\n            });\r\n\r\n    }\r\n\r\n    parse(content) {\r\n\r\n        const packages = this.packages;\r\n        const loadMeshCb = this.loadMeshCb;\r\n        const parseVisual = this.parseVisual;\r\n        const parseCollision = this.parseCollision;\r\n        const workingPath = this.workingPath;\r\n        const manager = this.manager;\r\n        const linkMap = {};\r\n        const jointMap = {};\r\n        const materialMap = {};\r\n\r\n        // Resolves the path of mesh files\r\n        function resolvePath(path) {\r\n\r\n            if (!/^package:\\/\\//.test(path)) {\r\n\r\n                return workingPath ? workingPath + path : path;\r\n\r\n            }\r\n\r\n            // Remove \"package://\" keyword and split meshPath at the first slash\r\n            const [targetPkg, relPath] = path.replace(/^package:\\/\\//, '').split(/\\/(.+)/);\r\n\r\n            if (typeof packages === 'string') {\r\n\r\n                // \"pkg\" is one single package\r\n                if (packages.endsWith(targetPkg)) {\r\n\r\n                    // \"pkg\" is the target package\r\n                    return packages + '/' + relPath;\r\n\r\n                } else {\r\n\r\n                    // Assume \"pkg\" is the target package's parent directory\r\n                    return packages + '/' + targetPkg + '/' + relPath;\r\n\r\n                }\r\n\r\n            } else if (packages instanceof Function) {\r\n\r\n                return packages(targetPkg) + '/' + relPath;\r\n\r\n            } else if (typeof packages === 'object') {\r\n\r\n                // \"pkg\" is a map of packages\r\n                if (targetPkg in packages) {\r\n\r\n                    return packages[targetPkg] + '/' + relPath;\r\n\r\n                } else {\r\n\r\n                    console.error(`URDFLoader : ${ targetPkg } not found in provided package list.`);\r\n                    return null;\r\n\r\n                }\r\n\r\n            }\r\n\r\n        }\r\n\r\n        // Process the URDF text format\r\n        function processUrdf(data) {\r\n\r\n            let children;\r\n            if (data instanceof Document) {\r\n\r\n                children = [ ...data.children ];\r\n\r\n            } else if (data instanceof Element) {\r\n\r\n                children = [ data ];\r\n\r\n            } else {\r\n\r\n                const parser = new DOMParser();\r\n                const urdf = parser.parseFromString(data, 'text/xml');\r\n                children = [ ...urdf.children ];\r\n\r\n            }\r\n\r\n            const robotNode = children.filter(c => c.nodeName === 'robot').pop();\r\n            return processRobot(robotNode);\r\n\r\n        }\r\n\r\n        // Process the <robot> node\r\n        function processRobot(robot) {\r\n\r\n            const robotNodes = [ ...robot.children ];\r\n            const links = robotNodes.filter(c => c.nodeName.toLowerCase() === 'link');\r\n            const joints = robotNodes.filter(c => c.nodeName.toLowerCase() === 'joint');\r\n            const materials = robotNodes.filter(c => c.nodeName.toLowerCase() === 'material');\r\n            const obj = new URDFRobot();\r\n\r\n            obj.robotName = robot.getAttribute('name');\r\n            obj.urdfRobotNode = robot;\r\n\r\n            // Create the <material> map\r\n            materials.forEach(m => {\r\n\r\n                const name = m.getAttribute('name');\r\n                materialMap[name] = processMaterial(m);\r\n\r\n            });\r\n\r\n            // Create the <link> map\r\n            const visualMap = {};\r\n            const colliderMap = {};\r\n            links.forEach(l => {\r\n\r\n                const name = l.getAttribute('name');\r\n                const isRoot = robot.querySelector(`child[link=\"${ name }\"]`) === null;\r\n                linkMap[name] = processLink(l, visualMap, colliderMap, isRoot ? obj : null);\r\n\r\n            });\r\n\r\n            // Create the <joint> map\r\n            joints.forEach(j => {\r\n\r\n                const name = j.getAttribute('name');\r\n                jointMap[name] = processJoint(j);\r\n\r\n            });\r\n\r\n            obj.joints = jointMap;\r\n            obj.links = linkMap;\r\n            obj.colliders = colliderMap;\r\n            obj.visual = visualMap;\r\n\r\n            // Link up mimic joints\r\n            const jointList = Object.values(jointMap);\r\n            jointList.forEach(j => {\r\n\r\n                if (j instanceof URDFMimicJoint) {\r\n\r\n                    jointMap[j.mimicJoint].mimicJoints.push(j);\r\n\r\n                }\r\n\r\n            });\r\n\r\n            // Detect infinite loops of mimic joints\r\n            jointList.forEach(j => {\r\n\r\n                const uniqueJoints = new Set();\r\n                const iterFunction = joint => {\r\n\r\n                    if (uniqueJoints.has(joint)) {\r\n\r\n                        throw new Error('URDFLoader: Detected an infinite loop of mimic joints.');\r\n\r\n                    }\r\n\r\n                    uniqueJoints.add(joint);\r\n                    joint.mimicJoints.forEach(j => {\r\n\r\n                        iterFunction(j);\r\n\r\n                    });\r\n\r\n                };\r\n\r\n                iterFunction(j);\r\n            });\r\n\r\n            obj.frames = {\r\n                ...colliderMap,\r\n                ...visualMap,\r\n                ...linkMap,\r\n                ...jointMap,\r\n            };\r\n\r\n            return obj;\r\n\r\n        }\r\n\r\n        // Process joint nodes and parent them\r\n        function processJoint(joint) {\r\n\r\n            const children = [ ...joint.children ];\r\n            const jointType = joint.getAttribute('type');\r\n\r\n            let obj;\r\n\r\n            const mimicTag = children.find(n => n.nodeName.toLowerCase() === 'mimic');\r\n            if (mimicTag) {\r\n\r\n                obj = new URDFMimicJoint();\r\n                obj.mimicJoint = mimicTag.getAttribute('joint');\r\n                obj.multiplier = parseFloat(mimicTag.getAttribute('multiplier') || 1.0);\r\n                obj.offset = parseFloat(mimicTag.getAttribute('offset') || 0.0);\r\n\r\n            } else {\r\n\r\n                obj = new URDFJoint();\r\n\r\n            }\r\n\r\n            obj.urdfNode = joint;\r\n            obj.name = joint.getAttribute('name');\r\n            obj.urdfName = obj.name;\r\n            obj.jointType = jointType;\r\n\r\n            let parent = null;\r\n            let child = null;\r\n            let xyz = [0, 0, 0];\r\n            let rpy = [0, 0, 0];\r\n\r\n            // Extract the attributes\r\n            children.forEach(n => {\r\n\r\n                const type = n.nodeName.toLowerCase();\r\n                if (type === 'origin') {\r\n\r\n                    xyz = processTuple(n.getAttribute('xyz'));\r\n                    rpy = processTuple(n.getAttribute('rpy'));\r\n\r\n                } else if (type === 'child') {\r\n\r\n                    child = linkMap[n.getAttribute('link')];\r\n\r\n                } else if (type === 'parent') {\r\n\r\n                    parent = linkMap[n.getAttribute('link')];\r\n\r\n                } else if (type === 'limit') {\r\n\r\n                    obj.limit.lower = parseFloat(n.getAttribute('lower') || obj.limit.lower);\r\n                    obj.limit.upper = parseFloat(n.getAttribute('upper') || obj.limit.upper);\r\n\r\n                }\r\n            });\r\n\r\n            // Join the links\r\n            parent.add(obj);\r\n            obj.add(child);\r\n            applyRotation(obj, rpy);\r\n            obj.position.set(xyz[0], xyz[1], xyz[2]);\r\n\r\n            // Set up the rotate function\r\n            const axisNode = children.filter(n => n.nodeName.toLowerCase() === 'axis')[0];\r\n\r\n            if (axisNode) {\r\n\r\n                const axisXYZ = axisNode.getAttribute('xyz').split(/\\s+/g).map(num => parseFloat(num));\r\n                obj.axis = new THREE.Vector3(axisXYZ[0], axisXYZ[1], axisXYZ[2]);\r\n                obj.axis.normalize();\r\n\r\n            }\r\n\r\n            return obj;\r\n\r\n        }\r\n\r\n        // Process the <link> nodes\r\n        function processLink(link, visualMap, colliderMap, target = null) {\r\n\r\n            if (target === null) {\r\n\r\n                target = new URDFLink();\r\n\r\n            }\r\n\r\n            const children = [ ...link.children ];\r\n            target.name = link.getAttribute('name');\r\n            target.urdfName = target.name;\r\n            target.urdfNode = link;\r\n\r\n            if (parseVisual) {\r\n\r\n                const visualNodes = children.filter(n => n.nodeName.toLowerCase() === 'visual');\r\n                visualNodes.forEach(vn => {\r\n\r\n                    const v = processLinkElement(vn, materialMap);\r\n                    target.add(v);\r\n\r\n                    if (vn.hasAttribute('name')) {\r\n\r\n                        const name = vn.getAttribute('name');\r\n                        v.name = name;\r\n                        v.urdfName = name;\r\n                        visualMap[name] = v;\r\n\r\n                    }\r\n\r\n                });\r\n\r\n            }\r\n\r\n            if (parseCollision) {\r\n\r\n                const collisionNodes = children.filter(n => n.nodeName.toLowerCase() === 'collision');\r\n                collisionNodes.forEach(cn => {\r\n\r\n                    const c = processLinkElement(cn);\r\n                    target.add(c);\r\n\r\n                    if (cn.hasAttribute('name')) {\r\n\r\n                        const name = cn.getAttribute('name');\r\n                        c.name = name;\r\n                        c.urdfName = name;\r\n                        colliderMap[name] = c;\r\n\r\n                    }\r\n\r\n                });\r\n\r\n            }\r\n\r\n            return target;\r\n\r\n        }\r\n\r\n        function processMaterial(node) {\r\n\r\n            const matNodes = [ ...node.children ];\r\n            const material = new THREE.MeshPhongMaterial();\r\n\r\n            material.name = node.getAttribute('name') || '';\r\n            matNodes.forEach(n => {\r\n\r\n                const type = n.nodeName.toLowerCase();\r\n                if (type === 'color') {\r\n\r\n                    const rgba =\r\n                        n\r\n                            .getAttribute('rgba')\r\n                            .split(/\\s/g)\r\n                            .map(v => parseFloat(v));\r\n\r\n                    material.color.setRGB(rgba[0], rgba[1], rgba[2]);\r\n                    material.opacity = rgba[3];\r\n                    material.transparent = rgba[3] < 1;\r\n                    material.depthWrite = !material.transparent;\r\n\r\n                } else if (type === 'texture') {\r\n\r\n                    // The URDF spec does not require that the <texture/> tag include\r\n                    // a filename attribute so skip loading the texture if not provided.\r\n                    const filename = n.getAttribute('filename');\r\n                    if (filename) {\r\n\r\n                        const loader = new THREE.TextureLoader(manager);\r\n                        const filePath = resolvePath(filename);\r\n                        material.map = loader.load(filePath);\r\n\r\n                    }\r\n\r\n                }\r\n            });\r\n\r\n            return material;\r\n\r\n        }\r\n\r\n        // Process the visual and collision nodes into meshes\r\n        function processLinkElement(vn, materialMap = {}) {\r\n\r\n            const isCollisionNode = vn.nodeName.toLowerCase() === 'collision';\r\n            const children = [ ...vn.children ];\r\n            let material = null;\r\n\r\n            // get the material first\r\n            const materialNode = children.filter(n => n.nodeName.toLowerCase() === 'material')[0];\r\n            if (materialNode) {\r\n\r\n                const name = materialNode.getAttribute('name');\r\n                if (name && name in materialMap) {\r\n\r\n                    material = materialMap[name];\r\n\r\n                } else {\r\n\r\n                    material = processMaterial(materialNode);\r\n\r\n                }\r\n\r\n            } else {\r\n\r\n                material = new THREE.MeshPhongMaterial();\r\n\r\n            }\r\n\r\n            const group = isCollisionNode ? new URDFCollider() : new URDFVisual();\r\n            group.urdfNode = vn;\r\n\r\n            children.forEach(n => {\r\n\r\n                const type = n.nodeName.toLowerCase();\r\n                if (type === 'geometry') {\r\n\r\n                    const geoType = n.children[0].nodeName.toLowerCase();\r\n                    if (geoType === 'mesh') {\r\n\r\n                        const filename = n.children[0].getAttribute('filename');\r\n                        const filePath = resolvePath(filename);\r\n\r\n                        // file path is null if a package directory is not provided.\r\n                        if (filePath !== null) {\r\n\r\n                            const scaleAttr = n.children[0].getAttribute('scale');\r\n                            if (scaleAttr) {\r\n\r\n                                const scale = processTuple(scaleAttr);\r\n                                group.scale.set(scale[0], scale[1], scale[2]);\r\n\r\n                            }\r\n\r\n                            loadMeshCb(filePath, manager, (obj, err) => {\r\n\r\n                                if (err) {\r\n\r\n                                    console.error('URDFLoader: Error loading mesh.', err);\r\n\r\n                                } else if (obj) {\r\n\r\n                                    if (obj instanceof THREE.Mesh) {\r\n\r\n                                        obj.material = material;\r\n\r\n                                    }\r\n\r\n                                    // We don't expect non identity rotations or positions. In the case of\r\n                                    // COLLADA files the model might come in with a custom scale for unit\r\n                                    // conversion.\r\n                                    obj.position.set(0, 0, 0);\r\n                                    obj.quaternion.identity();\r\n                                    group.add(obj);\r\n\r\n                                }\r\n\r\n                            });\r\n\r\n                        }\r\n\r\n                    } else if (geoType === 'box') {\r\n\r\n                        const primitiveModel = new THREE.Mesh();\r\n                        primitiveModel.geometry = new THREE.BoxBufferGeometry(1, 1, 1);\r\n                        primitiveModel.material = material;\r\n\r\n                        const size = processTuple(n.children[0].getAttribute('size'));\r\n                        primitiveModel.scale.set(size[0], size[1], size[2]);\r\n\r\n                        group.add(primitiveModel);\r\n\r\n                    } else if (geoType === 'sphere') {\r\n\r\n                        const primitiveModel = new THREE.Mesh();\r\n                        primitiveModel.geometry = new THREE.SphereBufferGeometry(1, 30, 30);\r\n                        primitiveModel.material = material;\r\n\r\n                        const radius = parseFloat(n.children[0].getAttribute('radius')) || 0;\r\n                        primitiveModel.scale.set(radius, radius, radius);\r\n\r\n                        group.add(primitiveModel);\r\n\r\n                    } else if (geoType === 'cylinder') {\r\n\r\n                        const primitiveModel = new THREE.Mesh();\r\n                        primitiveModel.geometry = new THREE.CylinderBufferGeometry(1, 1, 1, 30);\r\n                        primitiveModel.material = material;\r\n\r\n                        const radius = parseFloat(n.children[0].getAttribute('radius')) || 0;\r\n                        const length = parseFloat(n.children[0].getAttribute('length')) || 0;\r\n                        primitiveModel.scale.set(radius, length, radius);\r\n                        primitiveModel.rotation.set(Math.PI / 2, 0, 0);\r\n\r\n                        group.add(primitiveModel);\r\n\r\n                    }\r\n\r\n                } else if (type === 'origin') {\r\n\r\n                    const xyz = processTuple(n.getAttribute('xyz'));\r\n                    const rpy = processTuple(n.getAttribute('rpy'));\r\n\r\n                    group.position.set(xyz[0], xyz[1], xyz[2]);\r\n                    group.rotation.set(0, 0, 0);\r\n                    applyRotation(group, rpy);\r\n\r\n                }\r\n\r\n            });\r\n\r\n            return group;\r\n\r\n        }\r\n\r\n        return processUrdf(content);\r\n\r\n    }\r\n\r\n    // Default mesh loading function\r\n    defaultMeshLoader(path, manager, done) {\r\n\r\n        if (/\\.stl$/i.test(path)) {\r\n\r\n            const loader = new STLLoader(manager);\r\n            loader.load(path, geom => {\r\n                const mesh = new THREE.Mesh(geom, new THREE.MeshPhongMaterial());\r\n                done(mesh);\r\n            });\r\n\r\n        } else if (/\\.dae$/i.test(path)) {\r\n\r\n            const loader = new ColladaLoader(manager);\r\n            loader.load(path, dae => done(dae.scene));\r\n\r\n        } else {\r\n\r\n            console.warn(`URDFLoader: Could not load model at ${ path }.\\nNo loader available`);\r\n\r\n        }\r\n\r\n    }\r\n\r\n};\r\n","import {\n\tBufferAttribute,\n\tBufferGeometry,\n\tFileLoader,\n\tFloat32BufferAttribute,\n\tLoader,\n\tLoaderUtils,\n\tVector3\n} from 'three';\n\n/**\n * Description: A THREE loader for STL ASCII files, as created by Solidworks and other CAD programs.\n *\n * Supports both binary and ASCII encoded files, with automatic detection of type.\n *\n * The loader returns a non-indexed buffer geometry.\n *\n * Limitations:\n *  Binary decoding supports \"Magics\" color format (http://en.wikipedia.org/wiki/STL_(file_format)#Color_in_binary_STL).\n *  There is perhaps some question as to how valid it is to always assume little-endian-ness.\n *  ASCII decoding assumes file is UTF-8.\n *\n * Usage:\n *  const loader = new STLLoader();\n *  loader.load( './models/stl/slotted_disk.stl', function ( geometry ) {\n *    scene.add( new THREE.Mesh( geometry ) );\n *  });\n *\n * For binary STLs geometry might contain colors for vertices. To use it:\n *  // use the same code to load STL as above\n *  if (geometry.hasColors) {\n *    material = new THREE.MeshPhongMaterial({ opacity: geometry.alpha, vertexColors: true });\n *  } else { .... }\n *  const mesh = new THREE.Mesh( geometry, material );\n *\n * For ASCII STLs containing multiple solids, each solid is assigned to a different group.\n * Groups can be used to assign a different color by defining an array of materials with the same length of\n * geometry.groups and passing it to the Mesh constructor:\n *\n * const mesh = new THREE.Mesh( geometry, material );\n *\n * For example:\n *\n *  const materials = [];\n *  const nGeometryGroups = geometry.groups.length;\n *\n *  const colorMap = ...; // Some logic to index colors.\n *\n *  for (let i = 0; i < nGeometryGroups; i++) {\n *\n *\t\tconst material = new THREE.MeshPhongMaterial({\n *\t\t\tcolor: colorMap[i],\n *\t\t\twireframe: false\n *\t\t});\n *\n *  }\n *\n *  materials.push(material);\n *  const mesh = new THREE.Mesh(geometry, materials);\n */\n\n\nclass STLLoader extends Loader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t}\n\n\tload( url, onLoad, onProgress, onError ) {\n\n\t\tconst scope = this;\n\n\t\tconst loader = new FileLoader( this.manager );\n\t\tloader.setPath( this.path );\n\t\tloader.setResponseType( 'arraybuffer' );\n\t\tloader.setRequestHeader( this.requestHeader );\n\t\tloader.setWithCredentials( this.withCredentials );\n\n\t\tloader.load( url, function ( text ) {\n\n\t\t\ttry {\n\n\t\t\t\tonLoad( scope.parse( text ) );\n\n\t\t\t} catch ( e ) {\n\n\t\t\t\tif ( onError ) {\n\n\t\t\t\t\tonError( e );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.error( e );\n\n\t\t\t\t}\n\n\t\t\t\tscope.manager.itemError( url );\n\n\t\t\t}\n\n\t\t}, onProgress, onError );\n\n\t}\n\n\tparse( data ) {\n\n\t\tfunction isBinary( data ) {\n\n\t\t\tconst reader = new DataView( data );\n\t\t\tconst face_size = ( 32 / 8 * 3 ) + ( ( 32 / 8 * 3 ) * 3 ) + ( 16 / 8 );\n\t\t\tconst n_faces = reader.getUint32( 80, true );\n\t\t\tconst expect = 80 + ( 32 / 8 ) + ( n_faces * face_size );\n\n\t\t\tif ( expect === reader.byteLength ) {\n\n\t\t\t\treturn true;\n\n\t\t\t}\n\n\t\t\t// An ASCII STL data must begin with 'solid ' as the first six bytes.\n\t\t\t// However, ASCII STLs lacking the SPACE after the 'd' are known to be\n\t\t\t// plentiful.  So, check the first 5 bytes for 'solid'.\n\n\t\t\t// Several encodings, such as UTF-8, precede the text with up to 5 bytes:\n\t\t\t// https://en.wikipedia.org/wiki/Byte_order_mark#Byte_order_marks_by_encoding\n\t\t\t// Search for \"solid\" to start anywhere after those prefixes.\n\n\t\t\t// US-ASCII ordinal values for 's', 'o', 'l', 'i', 'd'\n\n\t\t\tconst solid = [ 115, 111, 108, 105, 100 ];\n\n\t\t\tfor ( let off = 0; off < 5; off ++ ) {\n\n\t\t\t\t// If \"solid\" text is matched to the current offset, declare it to be an ASCII STL.\n\n\t\t\t\tif ( matchDataViewAt( solid, reader, off ) ) return false;\n\n\t\t\t}\n\n\t\t\t// Couldn't find \"solid\" text at the beginning; it is binary STL.\n\n\t\t\treturn true;\n\n\t\t}\n\n\t\tfunction matchDataViewAt( query, reader, offset ) {\n\n\t\t\t// Check if each byte in query matches the corresponding byte from the current offset\n\n\t\t\tfor ( let i = 0, il = query.length; i < il; i ++ ) {\n\n\t\t\t\tif ( query[ i ] !== reader.getUint8( offset + i ) ) return false;\n\n\t\t\t}\n\n\t\t\treturn true;\n\n\t\t}\n\n\t\tfunction parseBinary( data ) {\n\n\t\t\tconst reader = new DataView( data );\n\t\t\tconst faces = reader.getUint32( 80, true );\n\n\t\t\tlet r, g, b, hasColors = false, colors;\n\t\t\tlet defaultR, defaultG, defaultB, alpha;\n\n\t\t\t// process STL header\n\t\t\t// check for default color in header (\"COLOR=rgba\" sequence).\n\n\t\t\tfor ( let index = 0; index < 80 - 10; index ++ ) {\n\n\t\t\t\tif ( ( reader.getUint32( index, false ) == 0x434F4C4F /*COLO*/ ) &&\n\t\t\t\t\t( reader.getUint8( index + 4 ) == 0x52 /*'R'*/ ) &&\n\t\t\t\t\t( reader.getUint8( index + 5 ) == 0x3D /*'='*/ ) ) {\n\n\t\t\t\t\thasColors = true;\n\t\t\t\t\tcolors = new Float32Array( faces * 3 * 3 );\n\n\t\t\t\t\tdefaultR = reader.getUint8( index + 6 ) / 255;\n\t\t\t\t\tdefaultG = reader.getUint8( index + 7 ) / 255;\n\t\t\t\t\tdefaultB = reader.getUint8( index + 8 ) / 255;\n\t\t\t\t\talpha = reader.getUint8( index + 9 ) / 255;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tconst dataOffset = 84;\n\t\t\tconst faceLength = 12 * 4 + 2;\n\n\t\t\tconst geometry = new BufferGeometry();\n\n\t\t\tconst vertices = new Float32Array( faces * 3 * 3 );\n\t\t\tconst normals = new Float32Array( faces * 3 * 3 );\n\n\t\t\tfor ( let face = 0; face < faces; face ++ ) {\n\n\t\t\t\tconst start = dataOffset + face * faceLength;\n\t\t\t\tconst normalX = reader.getFloat32( start, true );\n\t\t\t\tconst normalY = reader.getFloat32( start + 4, true );\n\t\t\t\tconst normalZ = reader.getFloat32( start + 8, true );\n\n\t\t\t\tif ( hasColors ) {\n\n\t\t\t\t\tconst packedColor = reader.getUint16( start + 48, true );\n\n\t\t\t\t\tif ( ( packedColor & 0x8000 ) === 0 ) {\n\n\t\t\t\t\t\t// facet has its own unique color\n\n\t\t\t\t\t\tr = ( packedColor & 0x1F ) / 31;\n\t\t\t\t\t\tg = ( ( packedColor >> 5 ) & 0x1F ) / 31;\n\t\t\t\t\t\tb = ( ( packedColor >> 10 ) & 0x1F ) / 31;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tr = defaultR;\n\t\t\t\t\t\tg = defaultG;\n\t\t\t\t\t\tb = defaultB;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tfor ( let i = 1; i <= 3; i ++ ) {\n\n\t\t\t\t\tconst vertexstart = start + i * 12;\n\t\t\t\t\tconst componentIdx = ( face * 3 * 3 ) + ( ( i - 1 ) * 3 );\n\n\t\t\t\t\tvertices[ componentIdx ] = reader.getFloat32( vertexstart, true );\n\t\t\t\t\tvertices[ componentIdx + 1 ] = reader.getFloat32( vertexstart + 4, true );\n\t\t\t\t\tvertices[ componentIdx + 2 ] = reader.getFloat32( vertexstart + 8, true );\n\n\t\t\t\t\tnormals[ componentIdx ] = normalX;\n\t\t\t\t\tnormals[ componentIdx + 1 ] = normalY;\n\t\t\t\t\tnormals[ componentIdx + 2 ] = normalZ;\n\n\t\t\t\t\tif ( hasColors ) {\n\n\t\t\t\t\t\tcolors[ componentIdx ] = r;\n\t\t\t\t\t\tcolors[ componentIdx + 1 ] = g;\n\t\t\t\t\t\tcolors[ componentIdx + 2 ] = b;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tgeometry.setAttribute( 'position', new BufferAttribute( vertices, 3 ) );\n\t\t\tgeometry.setAttribute( 'normal', new BufferAttribute( normals, 3 ) );\n\n\t\t\tif ( hasColors ) {\n\n\t\t\t\tgeometry.setAttribute( 'color', new BufferAttribute( colors, 3 ) );\n\t\t\t\tgeometry.hasColors = true;\n\t\t\t\tgeometry.alpha = alpha;\n\n\t\t\t}\n\n\t\t\treturn geometry;\n\n\t\t}\n\n\t\tfunction parseASCII( data ) {\n\n\t\t\tconst geometry = new BufferGeometry();\n\t\t\tconst patternSolid = /solid([\\s\\S]*?)endsolid/g;\n\t\t\tconst patternFace = /facet([\\s\\S]*?)endfacet/g;\n\t\t\tlet faceCounter = 0;\n\n\t\t\tconst patternFloat = /[\\s]+([+-]?(?:\\d*)(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)/.source;\n\t\t\tconst patternVertex = new RegExp( 'vertex' + patternFloat + patternFloat + patternFloat, 'g' );\n\t\t\tconst patternNormal = new RegExp( 'normal' + patternFloat + patternFloat + patternFloat, 'g' );\n\n\t\t\tconst vertices = [];\n\t\t\tconst normals = [];\n\n\t\t\tconst normal = new Vector3();\n\n\t\t\tlet result;\n\n\t\t\tlet groupCount = 0;\n\t\t\tlet startVertex = 0;\n\t\t\tlet endVertex = 0;\n\n\t\t\twhile ( ( result = patternSolid.exec( data ) ) !== null ) {\n\n\t\t\t\tstartVertex = endVertex;\n\n\t\t\t\tconst solid = result[ 0 ];\n\n\t\t\t\twhile ( ( result = patternFace.exec( solid ) ) !== null ) {\n\n\t\t\t\t\tlet vertexCountPerFace = 0;\n\t\t\t\t\tlet normalCountPerFace = 0;\n\n\t\t\t\t\tconst text = result[ 0 ];\n\n\t\t\t\t\twhile ( ( result = patternNormal.exec( text ) ) !== null ) {\n\n\t\t\t\t\t\tnormal.x = parseFloat( result[ 1 ] );\n\t\t\t\t\t\tnormal.y = parseFloat( result[ 2 ] );\n\t\t\t\t\t\tnormal.z = parseFloat( result[ 3 ] );\n\t\t\t\t\t\tnormalCountPerFace ++;\n\n\t\t\t\t\t}\n\n\t\t\t\t\twhile ( ( result = patternVertex.exec( text ) ) !== null ) {\n\n\t\t\t\t\t\tvertices.push( parseFloat( result[ 1 ] ), parseFloat( result[ 2 ] ), parseFloat( result[ 3 ] ) );\n\t\t\t\t\t\tnormals.push( normal.x, normal.y, normal.z );\n\t\t\t\t\t\tvertexCountPerFace ++;\n\t\t\t\t\t\tendVertex ++;\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// every face have to own ONE valid normal\n\n\t\t\t\t\tif ( normalCountPerFace !== 1 ) {\n\n\t\t\t\t\t\tconsole.error( 'THREE.STLLoader: Something isn\\'t right with the normal of face number ' + faceCounter );\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// each face have to own THREE valid vertices\n\n\t\t\t\t\tif ( vertexCountPerFace !== 3 ) {\n\n\t\t\t\t\t\tconsole.error( 'THREE.STLLoader: Something isn\\'t right with the vertices of face number ' + faceCounter );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfaceCounter ++;\n\n\t\t\t\t}\n\n\t\t\t\tconst start = startVertex;\n\t\t\t\tconst count = endVertex - startVertex;\n\n\t\t\t\tgeometry.addGroup( start, count, groupCount );\n\t\t\t\tgroupCount ++;\n\n\t\t\t}\n\n\t\t\tgeometry.setAttribute( 'position', new Float32BufferAttribute( vertices, 3 ) );\n\t\t\tgeometry.setAttribute( 'normal', new Float32BufferAttribute( normals, 3 ) );\n\n\t\t\treturn geometry;\n\n\t\t}\n\n\t\tfunction ensureString( buffer ) {\n\n\t\t\tif ( typeof buffer !== 'string' ) {\n\n\t\t\t\treturn LoaderUtils.decodeText( new Uint8Array( buffer ) );\n\n\t\t\t}\n\n\t\t\treturn buffer;\n\n\t\t}\n\n\t\tfunction ensureBinary( buffer ) {\n\n\t\t\tif ( typeof buffer === 'string' ) {\n\n\t\t\t\tconst array_buffer = new Uint8Array( buffer.length );\n\t\t\t\tfor ( let i = 0; i < buffer.length; i ++ ) {\n\n\t\t\t\t\tarray_buffer[ i ] = buffer.charCodeAt( i ) & 0xff; // implicitly assumes little-endian\n\n\t\t\t\t}\n\n\t\t\t\treturn array_buffer.buffer || array_buffer;\n\n\t\t\t} else {\n\n\t\t\t\treturn buffer;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// start\n\n\t\tconst binData = ensureBinary( data );\n\n\t\treturn isBinary( binData ) ? parseBinary( binData ) : parseASCII( ensureString( data ) );\n\n\t}\n\n}\n\nexport { STLLoader };\n","import {\n\tAmbientLight,\n\tAnimationClip,\n\tBone,\n\tBufferGeometry,\n\tClampToEdgeWrapping,\n\tColor,\n\tDirectionalLight,\n\tDoubleSide,\n\tEuler,\n\tFileLoader,\n\tFloat32BufferAttribute,\n\tFrontSide,\n\tGroup,\n\tLine,\n\tLineBasicMaterial,\n\tLineSegments,\n\tLoader,\n\tLoaderUtils,\n\tMathUtils,\n\tMatrix4,\n\tMesh,\n\tMeshBasicMaterial,\n\tMeshLambertMaterial,\n\tMeshPhongMaterial,\n\tOrthographicCamera,\n\tPerspectiveCamera,\n\tPointLight,\n\tQuaternion,\n\tQuaternionKeyframeTrack,\n\tRepeatWrapping,\n\tScene,\n\tSkeleton,\n\tSkinnedMesh,\n\tSpotLight,\n\tTextureLoader,\n\tVector2,\n\tVector3,\n\tVectorKeyframeTrack,\n\tsRGBEncoding\n} from 'three';\nimport { TGALoader } from '../loaders/TGALoader.js';\n\nclass ColladaLoader extends Loader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t}\n\n\tload( url, onLoad, onProgress, onError ) {\n\n\t\tconst scope = this;\n\n\t\tconst path = ( scope.path === '' ) ? LoaderUtils.extractUrlBase( url ) : scope.path;\n\n\t\tconst loader = new FileLoader( scope.manager );\n\t\tloader.setPath( scope.path );\n\t\tloader.setRequestHeader( scope.requestHeader );\n\t\tloader.setWithCredentials( scope.withCredentials );\n\t\tloader.load( url, function ( text ) {\n\n\t\t\ttry {\n\n\t\t\t\tonLoad( scope.parse( text, path ) );\n\n\t\t\t} catch ( e ) {\n\n\t\t\t\tif ( onError ) {\n\n\t\t\t\t\tonError( e );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.error( e );\n\n\t\t\t\t}\n\n\t\t\t\tscope.manager.itemError( url );\n\n\t\t\t}\n\n\t\t}, onProgress, onError );\n\n\t}\n\n\tparse( text, path ) {\n\n\t\tfunction getElementsByTagName( xml, name ) {\n\n\t\t\t// Non recursive xml.getElementsByTagName() ...\n\n\t\t\tconst array = [];\n\t\t\tconst childNodes = xml.childNodes;\n\n\t\t\tfor ( let i = 0, l = childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = childNodes[ i ];\n\n\t\t\t\tif ( child.nodeName === name ) {\n\n\t\t\t\t\tarray.push( child );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn array;\n\n\t\t}\n\n\t\tfunction parseStrings( text ) {\n\n\t\t\tif ( text.length === 0 ) return [];\n\n\t\t\tconst parts = text.trim().split( /\\s+/ );\n\t\t\tconst array = new Array( parts.length );\n\n\t\t\tfor ( let i = 0, l = parts.length; i < l; i ++ ) {\n\n\t\t\t\tarray[ i ] = parts[ i ];\n\n\t\t\t}\n\n\t\t\treturn array;\n\n\t\t}\n\n\t\tfunction parseFloats( text ) {\n\n\t\t\tif ( text.length === 0 ) return [];\n\n\t\t\tconst parts = text.trim().split( /\\s+/ );\n\t\t\tconst array = new Array( parts.length );\n\n\t\t\tfor ( let i = 0, l = parts.length; i < l; i ++ ) {\n\n\t\t\t\tarray[ i ] = parseFloat( parts[ i ] );\n\n\t\t\t}\n\n\t\t\treturn array;\n\n\t\t}\n\n\t\tfunction parseInts( text ) {\n\n\t\t\tif ( text.length === 0 ) return [];\n\n\t\t\tconst parts = text.trim().split( /\\s+/ );\n\t\t\tconst array = new Array( parts.length );\n\n\t\t\tfor ( let i = 0, l = parts.length; i < l; i ++ ) {\n\n\t\t\t\tarray[ i ] = parseInt( parts[ i ] );\n\n\t\t\t}\n\n\t\t\treturn array;\n\n\t\t}\n\n\t\tfunction parseId( text ) {\n\n\t\t\treturn text.substring( 1 );\n\n\t\t}\n\n\t\tfunction generateId() {\n\n\t\t\treturn 'three_default_' + ( count ++ );\n\n\t\t}\n\n\t\tfunction isEmpty( object ) {\n\n\t\t\treturn Object.keys( object ).length === 0;\n\n\t\t}\n\n\t\t// asset\n\n\t\tfunction parseAsset( xml ) {\n\n\t\t\treturn {\n\t\t\t\tunit: parseAssetUnit( getElementsByTagName( xml, 'unit' )[ 0 ] ),\n\t\t\t\tupAxis: parseAssetUpAxis( getElementsByTagName( xml, 'up_axis' )[ 0 ] )\n\t\t\t};\n\n\t\t}\n\n\t\tfunction parseAssetUnit( xml ) {\n\n\t\t\tif ( ( xml !== undefined ) && ( xml.hasAttribute( 'meter' ) === true ) ) {\n\n\t\t\t\treturn parseFloat( xml.getAttribute( 'meter' ) );\n\n\t\t\t} else {\n\n\t\t\t\treturn 1; // default 1 meter\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction parseAssetUpAxis( xml ) {\n\n\t\t\treturn xml !== undefined ? xml.textContent : 'Y_UP';\n\n\t\t}\n\n\t\t// library\n\n\t\tfunction parseLibrary( xml, libraryName, nodeName, parser ) {\n\n\t\t\tconst library = getElementsByTagName( xml, libraryName )[ 0 ];\n\n\t\t\tif ( library !== undefined ) {\n\n\t\t\t\tconst elements = getElementsByTagName( library, nodeName );\n\n\t\t\t\tfor ( let i = 0; i < elements.length; i ++ ) {\n\n\t\t\t\t\tparser( elements[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction buildLibrary( data, builder ) {\n\n\t\t\tfor ( const name in data ) {\n\n\t\t\t\tconst object = data[ name ];\n\t\t\t\tobject.build = builder( data[ name ] );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// get\n\n\t\tfunction getBuild( data, builder ) {\n\n\t\t\tif ( data.build !== undefined ) return data.build;\n\n\t\t\tdata.build = builder( data );\n\n\t\t\treturn data.build;\n\n\t\t}\n\n\t\t// animation\n\n\t\tfunction parseAnimation( xml ) {\n\n\t\t\tconst data = {\n\t\t\t\tsources: {},\n\t\t\t\tsamplers: {},\n\t\t\t\tchannels: {}\n\t\t\t};\n\n\t\t\tlet hasChildren = false;\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tlet id;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'source':\n\t\t\t\t\t\tid = child.getAttribute( 'id' );\n\t\t\t\t\t\tdata.sources[ id ] = parseSource( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'sampler':\n\t\t\t\t\t\tid = child.getAttribute( 'id' );\n\t\t\t\t\t\tdata.samplers[ id ] = parseAnimationSampler( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'channel':\n\t\t\t\t\t\tid = child.getAttribute( 'target' );\n\t\t\t\t\t\tdata.channels[ id ] = parseAnimationChannel( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'animation':\n\t\t\t\t\t\t// hierarchy of related animations\n\t\t\t\t\t\tparseAnimation( child );\n\t\t\t\t\t\thasChildren = true;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tconsole.log( child );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( hasChildren === false ) {\n\n\t\t\t\t// since 'id' attributes can be optional, it's necessary to generate a UUID for unqiue assignment\n\n\t\t\t\tlibrary.animations[ xml.getAttribute( 'id' ) || MathUtils.generateUUID() ] = data;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction parseAnimationSampler( xml ) {\n\n\t\t\tconst data = {\n\t\t\t\tinputs: {},\n\t\t\t};\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'input':\n\t\t\t\t\t\tconst id = parseId( child.getAttribute( 'source' ) );\n\t\t\t\t\t\tconst semantic = child.getAttribute( 'semantic' );\n\t\t\t\t\t\tdata.inputs[ semantic ] = id;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseAnimationChannel( xml ) {\n\n\t\t\tconst data = {};\n\n\t\t\tconst target = xml.getAttribute( 'target' );\n\n\t\t\t// parsing SID Addressing Syntax\n\n\t\t\tlet parts = target.split( '/' );\n\n\t\t\tconst id = parts.shift();\n\t\t\tlet sid = parts.shift();\n\n\t\t\t// check selection syntax\n\n\t\t\tconst arraySyntax = ( sid.indexOf( '(' ) !== - 1 );\n\t\t\tconst memberSyntax = ( sid.indexOf( '.' ) !== - 1 );\n\n\t\t\tif ( memberSyntax ) {\n\n\t\t\t\t//  member selection access\n\n\t\t\t\tparts = sid.split( '.' );\n\t\t\t\tsid = parts.shift();\n\t\t\t\tdata.member = parts.shift();\n\n\t\t\t} else if ( arraySyntax ) {\n\n\t\t\t\t// array-access syntax. can be used to express fields in one-dimensional vectors or two-dimensional matrices.\n\n\t\t\t\tconst indices = sid.split( '(' );\n\t\t\t\tsid = indices.shift();\n\n\t\t\t\tfor ( let i = 0; i < indices.length; i ++ ) {\n\n\t\t\t\t\tindices[ i ] = parseInt( indices[ i ].replace( /\\)/, '' ) );\n\n\t\t\t\t}\n\n\t\t\t\tdata.indices = indices;\n\n\t\t\t}\n\n\t\t\tdata.id = id;\n\t\t\tdata.sid = sid;\n\n\t\t\tdata.arraySyntax = arraySyntax;\n\t\t\tdata.memberSyntax = memberSyntax;\n\n\t\t\tdata.sampler = parseId( xml.getAttribute( 'source' ) );\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction buildAnimation( data ) {\n\n\t\t\tconst tracks = [];\n\n\t\t\tconst channels = data.channels;\n\t\t\tconst samplers = data.samplers;\n\t\t\tconst sources = data.sources;\n\n\t\t\tfor ( const target in channels ) {\n\n\t\t\t\tif ( channels.hasOwnProperty( target ) ) {\n\n\t\t\t\t\tconst channel = channels[ target ];\n\t\t\t\t\tconst sampler = samplers[ channel.sampler ];\n\n\t\t\t\t\tconst inputId = sampler.inputs.INPUT;\n\t\t\t\t\tconst outputId = sampler.inputs.OUTPUT;\n\n\t\t\t\t\tconst inputSource = sources[ inputId ];\n\t\t\t\t\tconst outputSource = sources[ outputId ];\n\n\t\t\t\t\tconst animation = buildAnimationChannel( channel, inputSource, outputSource );\n\n\t\t\t\t\tcreateKeyframeTracks( animation, tracks );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn tracks;\n\n\t\t}\n\n\t\tfunction getAnimation( id ) {\n\n\t\t\treturn getBuild( library.animations[ id ], buildAnimation );\n\n\t\t}\n\n\t\tfunction buildAnimationChannel( channel, inputSource, outputSource ) {\n\n\t\t\tconst node = library.nodes[ channel.id ];\n\t\t\tconst object3D = getNode( node.id );\n\n\t\t\tconst transform = node.transforms[ channel.sid ];\n\t\t\tconst defaultMatrix = node.matrix.clone().transpose();\n\n\t\t\tlet time, stride;\n\t\t\tlet i, il, j, jl;\n\n\t\t\tconst data = {};\n\n\t\t\t// the collada spec allows the animation of data in various ways.\n\t\t\t// depending on the transform type (matrix, translate, rotate, scale), we execute different logic\n\n\t\t\tswitch ( transform ) {\n\n\t\t\t\tcase 'matrix':\n\n\t\t\t\t\tfor ( i = 0, il = inputSource.array.length; i < il; i ++ ) {\n\n\t\t\t\t\t\ttime = inputSource.array[ i ];\n\t\t\t\t\t\tstride = i * outputSource.stride;\n\n\t\t\t\t\t\tif ( data[ time ] === undefined ) data[ time ] = {};\n\n\t\t\t\t\t\tif ( channel.arraySyntax === true ) {\n\n\t\t\t\t\t\t\tconst value = outputSource.array[ stride ];\n\t\t\t\t\t\t\tconst index = channel.indices[ 0 ] + 4 * channel.indices[ 1 ];\n\n\t\t\t\t\t\t\tdata[ time ][ index ] = value;\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tfor ( j = 0, jl = outputSource.stride; j < jl; j ++ ) {\n\n\t\t\t\t\t\t\t\tdata[ time ][ j ] = outputSource.array[ stride + j ];\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'translate':\n\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Animation transform type \"%s\" not yet implemented.', transform );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'rotate':\n\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Animation transform type \"%s\" not yet implemented.', transform );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'scale':\n\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Animation transform type \"%s\" not yet implemented.', transform );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tconst keyframes = prepareAnimationData( data, defaultMatrix );\n\n\t\t\tconst animation = {\n\t\t\t\tname: object3D.uuid,\n\t\t\t\tkeyframes: keyframes\n\t\t\t};\n\n\t\t\treturn animation;\n\n\t\t}\n\n\t\tfunction prepareAnimationData( data, defaultMatrix ) {\n\n\t\t\tconst keyframes = [];\n\n\t\t\t// transfer data into a sortable array\n\n\t\t\tfor ( const time in data ) {\n\n\t\t\t\tkeyframes.push( { time: parseFloat( time ), value: data[ time ] } );\n\n\t\t\t}\n\n\t\t\t// ensure keyframes are sorted by time\n\n\t\t\tkeyframes.sort( ascending );\n\n\t\t\t// now we clean up all animation data, so we can use them for keyframe tracks\n\n\t\t\tfor ( let i = 0; i < 16; i ++ ) {\n\n\t\t\t\ttransformAnimationData( keyframes, i, defaultMatrix.elements[ i ] );\n\n\t\t\t}\n\n\t\t\treturn keyframes;\n\n\t\t\t// array sort function\n\n\t\t\tfunction ascending( a, b ) {\n\n\t\t\t\treturn a.time - b.time;\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst position = new Vector3();\n\t\tconst scale = new Vector3();\n\t\tconst quaternion = new Quaternion();\n\n\t\tfunction createKeyframeTracks( animation, tracks ) {\n\n\t\t\tconst keyframes = animation.keyframes;\n\t\t\tconst name = animation.name;\n\n\t\t\tconst times = [];\n\t\t\tconst positionData = [];\n\t\t\tconst quaternionData = [];\n\t\t\tconst scaleData = [];\n\n\t\t\tfor ( let i = 0, l = keyframes.length; i < l; i ++ ) {\n\n\t\t\t\tconst keyframe = keyframes[ i ];\n\n\t\t\t\tconst time = keyframe.time;\n\t\t\t\tconst value = keyframe.value;\n\n\t\t\t\tmatrix.fromArray( value ).transpose();\n\t\t\t\tmatrix.decompose( position, quaternion, scale );\n\n\t\t\t\ttimes.push( time );\n\t\t\t\tpositionData.push( position.x, position.y, position.z );\n\t\t\t\tquaternionData.push( quaternion.x, quaternion.y, quaternion.z, quaternion.w );\n\t\t\t\tscaleData.push( scale.x, scale.y, scale.z );\n\n\t\t\t}\n\n\t\t\tif ( positionData.length > 0 ) tracks.push( new VectorKeyframeTrack( name + '.position', times, positionData ) );\n\t\t\tif ( quaternionData.length > 0 ) tracks.push( new QuaternionKeyframeTrack( name + '.quaternion', times, quaternionData ) );\n\t\t\tif ( scaleData.length > 0 ) tracks.push( new VectorKeyframeTrack( name + '.scale', times, scaleData ) );\n\n\t\t\treturn tracks;\n\n\t\t}\n\n\t\tfunction transformAnimationData( keyframes, property, defaultValue ) {\n\n\t\t\tlet keyframe;\n\n\t\t\tlet empty = true;\n\t\t\tlet i, l;\n\n\t\t\t// check, if values of a property are missing in our keyframes\n\n\t\t\tfor ( i = 0, l = keyframes.length; i < l; i ++ ) {\n\n\t\t\t\tkeyframe = keyframes[ i ];\n\n\t\t\t\tif ( keyframe.value[ property ] === undefined ) {\n\n\t\t\t\t\tkeyframe.value[ property ] = null; // mark as missing\n\n\t\t\t\t} else {\n\n\t\t\t\t\tempty = false;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( empty === true ) {\n\n\t\t\t\t// no values at all, so we set a default value\n\n\t\t\t\tfor ( i = 0, l = keyframes.length; i < l; i ++ ) {\n\n\t\t\t\t\tkeyframe = keyframes[ i ];\n\n\t\t\t\t\tkeyframe.value[ property ] = defaultValue;\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\t// filling gaps\n\n\t\t\t\tcreateMissingKeyframes( keyframes, property );\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction createMissingKeyframes( keyframes, property ) {\n\n\t\t\tlet prev, next;\n\n\t\t\tfor ( let i = 0, l = keyframes.length; i < l; i ++ ) {\n\n\t\t\t\tconst keyframe = keyframes[ i ];\n\n\t\t\t\tif ( keyframe.value[ property ] === null ) {\n\n\t\t\t\t\tprev = getPrev( keyframes, i, property );\n\t\t\t\t\tnext = getNext( keyframes, i, property );\n\n\t\t\t\t\tif ( prev === null ) {\n\n\t\t\t\t\t\tkeyframe.value[ property ] = next.value[ property ];\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( next === null ) {\n\n\t\t\t\t\t\tkeyframe.value[ property ] = prev.value[ property ];\n\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tinterpolate( keyframe, prev, next, property );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction getPrev( keyframes, i, property ) {\n\n\t\t\twhile ( i >= 0 ) {\n\n\t\t\t\tconst keyframe = keyframes[ i ];\n\n\t\t\t\tif ( keyframe.value[ property ] !== null ) return keyframe;\n\n\t\t\t\ti --;\n\n\t\t\t}\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tfunction getNext( keyframes, i, property ) {\n\n\t\t\twhile ( i < keyframes.length ) {\n\n\t\t\t\tconst keyframe = keyframes[ i ];\n\n\t\t\t\tif ( keyframe.value[ property ] !== null ) return keyframe;\n\n\t\t\t\ti ++;\n\n\t\t\t}\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tfunction interpolate( key, prev, next, property ) {\n\n\t\t\tif ( ( next.time - prev.time ) === 0 ) {\n\n\t\t\t\tkey.value[ property ] = prev.value[ property ];\n\t\t\t\treturn;\n\n\t\t\t}\n\n\t\t\tkey.value[ property ] = ( ( key.time - prev.time ) * ( next.value[ property ] - prev.value[ property ] ) / ( next.time - prev.time ) ) + prev.value[ property ];\n\n\t\t}\n\n\t\t// animation clips\n\n\t\tfunction parseAnimationClip( xml ) {\n\n\t\t\tconst data = {\n\t\t\t\tname: xml.getAttribute( 'id' ) || 'default',\n\t\t\t\tstart: parseFloat( xml.getAttribute( 'start' ) || 0 ),\n\t\t\t\tend: parseFloat( xml.getAttribute( 'end' ) || 0 ),\n\t\t\t\tanimations: []\n\t\t\t};\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'instance_animation':\n\t\t\t\t\t\tdata.animations.push( parseId( child.getAttribute( 'url' ) ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.clips[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction buildAnimationClip( data ) {\n\n\t\t\tconst tracks = [];\n\n\t\t\tconst name = data.name;\n\t\t\tconst duration = ( data.end - data.start ) || - 1;\n\t\t\tconst animations = data.animations;\n\n\t\t\tfor ( let i = 0, il = animations.length; i < il; i ++ ) {\n\n\t\t\t\tconst animationTracks = getAnimation( animations[ i ] );\n\n\t\t\t\tfor ( let j = 0, jl = animationTracks.length; j < jl; j ++ ) {\n\n\t\t\t\t\ttracks.push( animationTracks[ j ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn new AnimationClip( name, duration, tracks );\n\n\t\t}\n\n\t\tfunction getAnimationClip( id ) {\n\n\t\t\treturn getBuild( library.clips[ id ], buildAnimationClip );\n\n\t\t}\n\n\t\t// controller\n\n\t\tfunction parseController( xml ) {\n\n\t\t\tconst data = {};\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'skin':\n\t\t\t\t\t\t// there is exactly one skin per controller\n\t\t\t\t\t\tdata.id = parseId( child.getAttribute( 'source' ) );\n\t\t\t\t\t\tdata.skin = parseSkin( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'morph':\n\t\t\t\t\t\tdata.id = parseId( child.getAttribute( 'source' ) );\n\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Morph target animation not supported yet.' );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.controllers[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction parseSkin( xml ) {\n\n\t\t\tconst data = {\n\t\t\t\tsources: {}\n\t\t\t};\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'bind_shape_matrix':\n\t\t\t\t\t\tdata.bindShapeMatrix = parseFloats( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'source':\n\t\t\t\t\t\tconst id = child.getAttribute( 'id' );\n\t\t\t\t\t\tdata.sources[ id ] = parseSource( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'joints':\n\t\t\t\t\t\tdata.joints = parseJoints( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'vertex_weights':\n\t\t\t\t\t\tdata.vertexWeights = parseVertexWeights( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseJoints( xml ) {\n\n\t\t\tconst data = {\n\t\t\t\tinputs: {}\n\t\t\t};\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'input':\n\t\t\t\t\t\tconst semantic = child.getAttribute( 'semantic' );\n\t\t\t\t\t\tconst id = parseId( child.getAttribute( 'source' ) );\n\t\t\t\t\t\tdata.inputs[ semantic ] = id;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseVertexWeights( xml ) {\n\n\t\t\tconst data = {\n\t\t\t\tinputs: {}\n\t\t\t};\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'input':\n\t\t\t\t\t\tconst semantic = child.getAttribute( 'semantic' );\n\t\t\t\t\t\tconst id = parseId( child.getAttribute( 'source' ) );\n\t\t\t\t\t\tconst offset = parseInt( child.getAttribute( 'offset' ) );\n\t\t\t\t\t\tdata.inputs[ semantic ] = { id: id, offset: offset };\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'vcount':\n\t\t\t\t\t\tdata.vcount = parseInts( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'v':\n\t\t\t\t\t\tdata.v = parseInts( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction buildController( data ) {\n\n\t\t\tconst build = {\n\t\t\t\tid: data.id\n\t\t\t};\n\n\t\t\tconst geometry = library.geometries[ build.id ];\n\n\t\t\tif ( data.skin !== undefined ) {\n\n\t\t\t\tbuild.skin = buildSkin( data.skin );\n\n\t\t\t\t// we enhance the 'sources' property of the corresponding geometry with our skin data\n\n\t\t\t\tgeometry.sources.skinIndices = build.skin.indices;\n\t\t\t\tgeometry.sources.skinWeights = build.skin.weights;\n\n\t\t\t}\n\n\t\t\treturn build;\n\n\t\t}\n\n\t\tfunction buildSkin( data ) {\n\n\t\t\tconst BONE_LIMIT = 4;\n\n\t\t\tconst build = {\n\t\t\t\tjoints: [], // this must be an array to preserve the joint order\n\t\t\t\tindices: {\n\t\t\t\t\tarray: [],\n\t\t\t\t\tstride: BONE_LIMIT\n\t\t\t\t},\n\t\t\t\tweights: {\n\t\t\t\t\tarray: [],\n\t\t\t\t\tstride: BONE_LIMIT\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tconst sources = data.sources;\n\t\t\tconst vertexWeights = data.vertexWeights;\n\n\t\t\tconst vcount = vertexWeights.vcount;\n\t\t\tconst v = vertexWeights.v;\n\t\t\tconst jointOffset = vertexWeights.inputs.JOINT.offset;\n\t\t\tconst weightOffset = vertexWeights.inputs.WEIGHT.offset;\n\n\t\t\tconst jointSource = data.sources[ data.joints.inputs.JOINT ];\n\t\t\tconst inverseSource = data.sources[ data.joints.inputs.INV_BIND_MATRIX ];\n\n\t\t\tconst weights = sources[ vertexWeights.inputs.WEIGHT.id ].array;\n\t\t\tlet stride = 0;\n\n\t\t\tlet i, j, l;\n\n\t\t\t// procces skin data for each vertex\n\n\t\t\tfor ( i = 0, l = vcount.length; i < l; i ++ ) {\n\n\t\t\t\tconst jointCount = vcount[ i ]; // this is the amount of joints that affect a single vertex\n\t\t\t\tconst vertexSkinData = [];\n\n\t\t\t\tfor ( j = 0; j < jointCount; j ++ ) {\n\n\t\t\t\t\tconst skinIndex = v[ stride + jointOffset ];\n\t\t\t\t\tconst weightId = v[ stride + weightOffset ];\n\t\t\t\t\tconst skinWeight = weights[ weightId ];\n\n\t\t\t\t\tvertexSkinData.push( { index: skinIndex, weight: skinWeight } );\n\n\t\t\t\t\tstride += 2;\n\n\t\t\t\t}\n\n\t\t\t\t// we sort the joints in descending order based on the weights.\n\t\t\t\t// this ensures, we only procced the most important joints of the vertex\n\n\t\t\t\tvertexSkinData.sort( descending );\n\n\t\t\t\t// now we provide for each vertex a set of four index and weight values.\n\t\t\t\t// the order of the skin data matches the order of vertices\n\n\t\t\t\tfor ( j = 0; j < BONE_LIMIT; j ++ ) {\n\n\t\t\t\t\tconst d = vertexSkinData[ j ];\n\n\t\t\t\t\tif ( d !== undefined ) {\n\n\t\t\t\t\t\tbuild.indices.array.push( d.index );\n\t\t\t\t\t\tbuild.weights.array.push( d.weight );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tbuild.indices.array.push( 0 );\n\t\t\t\t\t\tbuild.weights.array.push( 0 );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// setup bind matrix\n\n\t\t\tif ( data.bindShapeMatrix ) {\n\n\t\t\t\tbuild.bindMatrix = new Matrix4().fromArray( data.bindShapeMatrix ).transpose();\n\n\t\t\t} else {\n\n\t\t\t\tbuild.bindMatrix = new Matrix4().identity();\n\n\t\t\t}\n\n\t\t\t// process bones and inverse bind matrix data\n\n\t\t\tfor ( i = 0, l = jointSource.array.length; i < l; i ++ ) {\n\n\t\t\t\tconst name = jointSource.array[ i ];\n\t\t\t\tconst boneInverse = new Matrix4().fromArray( inverseSource.array, i * inverseSource.stride ).transpose();\n\n\t\t\t\tbuild.joints.push( { name: name, boneInverse: boneInverse } );\n\n\t\t\t}\n\n\t\t\treturn build;\n\n\t\t\t// array sort function\n\n\t\t\tfunction descending( a, b ) {\n\n\t\t\t\treturn b.weight - a.weight;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction getController( id ) {\n\n\t\t\treturn getBuild( library.controllers[ id ], buildController );\n\n\t\t}\n\n\t\t// image\n\n\t\tfunction parseImage( xml ) {\n\n\t\t\tconst data = {\n\t\t\t\tinit_from: getElementsByTagName( xml, 'init_from' )[ 0 ].textContent\n\t\t\t};\n\n\t\t\tlibrary.images[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction buildImage( data ) {\n\n\t\t\tif ( data.build !== undefined ) return data.build;\n\n\t\t\treturn data.init_from;\n\n\t\t}\n\n\t\tfunction getImage( id ) {\n\n\t\t\tconst data = library.images[ id ];\n\n\t\t\tif ( data !== undefined ) {\n\n\t\t\t\treturn getBuild( data, buildImage );\n\n\t\t\t}\n\n\t\t\tconsole.warn( 'THREE.ColladaLoader: Couldn\\'t find image with ID:', id );\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// effect\n\n\t\tfunction parseEffect( xml ) {\n\n\t\t\tconst data = {};\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'profile_COMMON':\n\t\t\t\t\t\tdata.profile = parseEffectProfileCOMMON( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.effects[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction parseEffectProfileCOMMON( xml ) {\n\n\t\t\tconst data = {\n\t\t\t\tsurfaces: {},\n\t\t\t\tsamplers: {}\n\t\t\t};\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'newparam':\n\t\t\t\t\t\tparseEffectNewparam( child, data );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'technique':\n\t\t\t\t\t\tdata.technique = parseEffectTechnique( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'extra':\n\t\t\t\t\t\tdata.extra = parseEffectExtra( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseEffectNewparam( xml, data ) {\n\n\t\t\tconst sid = xml.getAttribute( 'sid' );\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'surface':\n\t\t\t\t\t\tdata.surfaces[ sid ] = parseEffectSurface( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'sampler2D':\n\t\t\t\t\t\tdata.samplers[ sid ] = parseEffectSampler( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction parseEffectSurface( xml ) {\n\n\t\t\tconst data = {};\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'init_from':\n\t\t\t\t\t\tdata.init_from = child.textContent;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseEffectSampler( xml ) {\n\n\t\t\tconst data = {};\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'source':\n\t\t\t\t\t\tdata.source = child.textContent;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseEffectTechnique( xml ) {\n\n\t\t\tconst data = {};\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'constant':\n\t\t\t\t\tcase 'lambert':\n\t\t\t\t\tcase 'blinn':\n\t\t\t\t\tcase 'phong':\n\t\t\t\t\t\tdata.type = child.nodeName;\n\t\t\t\t\t\tdata.parameters = parseEffectParameters( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'extra':\n\t\t\t\t\t\tdata.extra = parseEffectExtra( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseEffectParameters( xml ) {\n\n\t\t\tconst data = {};\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'emission':\n\t\t\t\t\tcase 'diffuse':\n\t\t\t\t\tcase 'specular':\n\t\t\t\t\tcase 'bump':\n\t\t\t\t\tcase 'ambient':\n\t\t\t\t\tcase 'shininess':\n\t\t\t\t\tcase 'transparency':\n\t\t\t\t\t\tdata[ child.nodeName ] = parseEffectParameter( child );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'transparent':\n\t\t\t\t\t\tdata[ child.nodeName ] = {\n\t\t\t\t\t\t\topaque: child.hasAttribute( 'opaque' ) ? child.getAttribute( 'opaque' ) : 'A_ONE',\n\t\t\t\t\t\t\tdata: parseEffectParameter( child )\n\t\t\t\t\t\t};\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseEffectParameter( xml ) {\n\n\t\t\tconst data = {};\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'color':\n\t\t\t\t\t\tdata[ child.nodeName ] = parseFloats( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'float':\n\t\t\t\t\t\tdata[ child.nodeName ] = parseFloat( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'texture':\n\t\t\t\t\t\tdata[ child.nodeName ] = { id: child.getAttribute( 'texture' ), extra: parseEffectParameterTexture( child ) };\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseEffectParameterTexture( xml ) {\n\n\t\t\tconst data = {\n\t\t\t\ttechnique: {}\n\t\t\t};\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'extra':\n\t\t\t\t\t\tparseEffectParameterTextureExtra( child, data );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseEffectParameterTextureExtra( xml, data ) {\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'technique':\n\t\t\t\t\t\tparseEffectParameterTextureExtraTechnique( child, data );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction parseEffectParameterTextureExtraTechnique( xml, data ) {\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'repeatU':\n\t\t\t\t\tcase 'repeatV':\n\t\t\t\t\tcase 'offsetU':\n\t\t\t\t\tcase 'offsetV':\n\t\t\t\t\t\tdata.technique[ child.nodeName ] = parseFloat( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'wrapU':\n\t\t\t\t\tcase 'wrapV':\n\n\t\t\t\t\t\t// some files have values for wrapU/wrapV which become NaN via parseInt\n\n\t\t\t\t\t\tif ( child.textContent.toUpperCase() === 'TRUE' ) {\n\n\t\t\t\t\t\t\tdata.technique[ child.nodeName ] = 1;\n\n\t\t\t\t\t\t} else if ( child.textContent.toUpperCase() === 'FALSE' ) {\n\n\t\t\t\t\t\t\tdata.technique[ child.nodeName ] = 0;\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tdata.technique[ child.nodeName ] = parseInt( child.textContent );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'bump':\n\t\t\t\t\t\tdata[ child.nodeName ] = parseEffectExtraTechniqueBump( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction parseEffectExtra( xml ) {\n\n\t\t\tconst data = {};\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'technique':\n\t\t\t\t\t\tdata.technique = parseEffectExtraTechnique( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseEffectExtraTechnique( xml ) {\n\n\t\t\tconst data = {};\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'double_sided':\n\t\t\t\t\t\tdata[ child.nodeName ] = parseInt( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'bump':\n\t\t\t\t\t\tdata[ child.nodeName ] = parseEffectExtraTechniqueBump( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseEffectExtraTechniqueBump( xml ) {\n\n\t\t\tconst data = {};\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'texture':\n\t\t\t\t\t\tdata[ child.nodeName ] = { id: child.getAttribute( 'texture' ), texcoord: child.getAttribute( 'texcoord' ), extra: parseEffectParameterTexture( child ) };\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction buildEffect( data ) {\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction getEffect( id ) {\n\n\t\t\treturn getBuild( library.effects[ id ], buildEffect );\n\n\t\t}\n\n\t\t// material\n\n\t\tfunction parseMaterial( xml ) {\n\n\t\t\tconst data = {\n\t\t\t\tname: xml.getAttribute( 'name' )\n\t\t\t};\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'instance_effect':\n\t\t\t\t\t\tdata.url = parseId( child.getAttribute( 'url' ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.materials[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction getTextureLoader( image ) {\n\n\t\t\tlet loader;\n\n\t\t\tlet extension = image.slice( ( image.lastIndexOf( '.' ) - 1 >>> 0 ) + 2 ); // http://www.jstips.co/en/javascript/get-file-extension/\n\t\t\textension = extension.toLowerCase();\n\n\t\t\tswitch ( extension ) {\n\n\t\t\t\tcase 'tga':\n\t\t\t\t\tloader = tgaLoader;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tloader = textureLoader;\n\n\t\t\t}\n\n\t\t\treturn loader;\n\n\t\t}\n\n\t\tfunction buildMaterial( data ) {\n\n\t\t\tconst effect = getEffect( data.url );\n\t\t\tconst technique = effect.profile.technique;\n\n\t\t\tlet material;\n\n\t\t\tswitch ( technique.type ) {\n\n\t\t\t\tcase 'phong':\n\t\t\t\tcase 'blinn':\n\t\t\t\t\tmaterial = new MeshPhongMaterial();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'lambert':\n\t\t\t\t\tmaterial = new MeshLambertMaterial();\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tmaterial = new MeshBasicMaterial();\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tmaterial.name = data.name || '';\n\n\t\t\tfunction getTexture( textureObject, encoding = null ) {\n\n\t\t\t\tconst sampler = effect.profile.samplers[ textureObject.id ];\n\t\t\t\tlet image = null;\n\n\t\t\t\t// get image\n\n\t\t\t\tif ( sampler !== undefined ) {\n\n\t\t\t\t\tconst surface = effect.profile.surfaces[ sampler.source ];\n\t\t\t\t\timage = getImage( surface.init_from );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530).' );\n\t\t\t\t\timage = getImage( textureObject.id );\n\n\t\t\t\t}\n\n\t\t\t\t// create texture if image is avaiable\n\n\t\t\t\tif ( image !== null ) {\n\n\t\t\t\t\tconst loader = getTextureLoader( image );\n\n\t\t\t\t\tif ( loader !== undefined ) {\n\n\t\t\t\t\t\tconst texture = loader.load( image );\n\n\t\t\t\t\t\tconst extra = textureObject.extra;\n\n\t\t\t\t\t\tif ( extra !== undefined && extra.technique !== undefined && isEmpty( extra.technique ) === false ) {\n\n\t\t\t\t\t\t\tconst technique = extra.technique;\n\n\t\t\t\t\t\t\ttexture.wrapS = technique.wrapU ? RepeatWrapping : ClampToEdgeWrapping;\n\t\t\t\t\t\t\ttexture.wrapT = technique.wrapV ? RepeatWrapping : ClampToEdgeWrapping;\n\n\t\t\t\t\t\t\ttexture.offset.set( technique.offsetU || 0, technique.offsetV || 0 );\n\t\t\t\t\t\t\ttexture.repeat.set( technique.repeatU || 1, technique.repeatV || 1 );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\ttexture.wrapS = RepeatWrapping;\n\t\t\t\t\t\t\ttexture.wrapT = RepeatWrapping;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( encoding !== null ) {\n\n\t\t\t\t\t\t\ttexture.encoding = encoding;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn texture;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Loader for texture %s not found.', image );\n\n\t\t\t\t\t\treturn null;\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Couldn\\'t create texture with ID:', textureObject.id );\n\n\t\t\t\t\treturn null;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tconst parameters = technique.parameters;\n\n\t\t\tfor ( const key in parameters ) {\n\n\t\t\t\tconst parameter = parameters[ key ];\n\n\t\t\t\tswitch ( key ) {\n\n\t\t\t\t\tcase 'diffuse':\n\t\t\t\t\t\tif ( parameter.color ) material.color.fromArray( parameter.color );\n\t\t\t\t\t\tif ( parameter.texture ) material.map = getTexture( parameter.texture, sRGBEncoding );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'specular':\n\t\t\t\t\t\tif ( parameter.color && material.specular ) material.specular.fromArray( parameter.color );\n\t\t\t\t\t\tif ( parameter.texture ) material.specularMap = getTexture( parameter.texture );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'bump':\n\t\t\t\t\t\tif ( parameter.texture ) material.normalMap = getTexture( parameter.texture );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'ambient':\n\t\t\t\t\t\tif ( parameter.texture ) material.lightMap = getTexture( parameter.texture, sRGBEncoding );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'shininess':\n\t\t\t\t\t\tif ( parameter.float && material.shininess ) material.shininess = parameter.float;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'emission':\n\t\t\t\t\t\tif ( parameter.color && material.emissive ) material.emissive.fromArray( parameter.color );\n\t\t\t\t\t\tif ( parameter.texture ) material.emissiveMap = getTexture( parameter.texture, sRGBEncoding );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tmaterial.color.convertSRGBToLinear();\n\t\t\tif ( material.specular ) material.specular.convertSRGBToLinear();\n\t\t\tif ( material.emissive ) material.emissive.convertSRGBToLinear();\n\n\t\t\t//\n\n\t\t\tlet transparent = parameters[ 'transparent' ];\n\t\t\tlet transparency = parameters[ 'transparency' ];\n\n\t\t\t// <transparency> does not exist but <transparent>\n\n\t\t\tif ( transparency === undefined && transparent ) {\n\n\t\t\t\ttransparency = {\n\t\t\t\t\tfloat: 1\n\t\t\t\t};\n\n\t\t\t}\n\n\t\t\t// <transparent> does not exist but <transparency>\n\n\t\t\tif ( transparent === undefined && transparency ) {\n\n\t\t\t\ttransparent = {\n\t\t\t\t\topaque: 'A_ONE',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tcolor: [ 1, 1, 1, 1 ]\n\t\t\t\t\t} };\n\n\t\t\t}\n\n\t\t\tif ( transparent && transparency ) {\n\n\t\t\t\t// handle case if a texture exists but no color\n\n\t\t\t\tif ( transparent.data.texture ) {\n\n\t\t\t\t\t// we do not set an alpha map (see #13792)\n\n\t\t\t\t\tmaterial.transparent = true;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconst color = transparent.data.color;\n\n\t\t\t\t\tswitch ( transparent.opaque ) {\n\n\t\t\t\t\t\tcase 'A_ONE':\n\t\t\t\t\t\t\tmaterial.opacity = color[ 3 ] * transparency.float;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'RGB_ZERO':\n\t\t\t\t\t\t\tmaterial.opacity = 1 - ( color[ 0 ] * transparency.float );\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'A_ZERO':\n\t\t\t\t\t\t\tmaterial.opacity = 1 - ( color[ 3 ] * transparency.float );\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'RGB_ONE':\n\t\t\t\t\t\t\tmaterial.opacity = color[ 0 ] * transparency.float;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Invalid opaque type \"%s\" of transparent tag.', transparent.opaque );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( material.opacity < 1 ) material.transparent = true;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t//\n\n\n\t\t\tif ( technique.extra !== undefined && technique.extra.technique !== undefined ) {\n\n\t\t\t\tconst techniques = technique.extra.technique;\n\n\t\t\t\tfor ( const k in techniques ) {\n\n\t\t\t\t\tconst v = techniques[ k ];\n\n\t\t\t\t\tswitch ( k ) {\n\n\t\t\t\t\t\tcase 'double_sided':\n\t\t\t\t\t\t\tmaterial.side = ( v === 1 ? DoubleSide : FrontSide );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'bump':\n\t\t\t\t\t\t\tmaterial.normalMap = getTexture( v.texture );\n\t\t\t\t\t\t\tmaterial.normalScale = new Vector2( 1, 1 );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn material;\n\n\t\t}\n\n\t\tfunction getMaterial( id ) {\n\n\t\t\treturn getBuild( library.materials[ id ], buildMaterial );\n\n\t\t}\n\n\t\t// camera\n\n\t\tfunction parseCamera( xml ) {\n\n\t\t\tconst data = {\n\t\t\t\tname: xml.getAttribute( 'name' )\n\t\t\t};\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'optics':\n\t\t\t\t\t\tdata.optics = parseCameraOptics( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.cameras[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction parseCameraOptics( xml ) {\n\n\t\t\tfor ( let i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'technique_common':\n\t\t\t\t\t\treturn parseCameraTechnique( child );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn {};\n\n\t\t}\n\n\t\tfunction parseCameraTechnique( xml ) {\n\n\t\t\tconst data = {};\n\n\t\t\tfor ( let i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'perspective':\n\t\t\t\t\tcase 'orthographic':\n\n\t\t\t\t\t\tdata.technique = child.nodeName;\n\t\t\t\t\t\tdata.parameters = parseCameraParameters( child );\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseCameraParameters( xml ) {\n\n\t\t\tconst data = {};\n\n\t\t\tfor ( let i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'xfov':\n\t\t\t\t\tcase 'yfov':\n\t\t\t\t\tcase 'xmag':\n\t\t\t\t\tcase 'ymag':\n\t\t\t\t\tcase 'znear':\n\t\t\t\t\tcase 'zfar':\n\t\t\t\t\tcase 'aspect_ratio':\n\t\t\t\t\t\tdata[ child.nodeName ] = parseFloat( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction buildCamera( data ) {\n\n\t\t\tlet camera;\n\n\t\t\tswitch ( data.optics.technique ) {\n\n\t\t\t\tcase 'perspective':\n\t\t\t\t\tcamera = new PerspectiveCamera(\n\t\t\t\t\t\tdata.optics.parameters.yfov,\n\t\t\t\t\t\tdata.optics.parameters.aspect_ratio,\n\t\t\t\t\t\tdata.optics.parameters.znear,\n\t\t\t\t\t\tdata.optics.parameters.zfar\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'orthographic':\n\t\t\t\t\tlet ymag = data.optics.parameters.ymag;\n\t\t\t\t\tlet xmag = data.optics.parameters.xmag;\n\t\t\t\t\tconst aspectRatio = data.optics.parameters.aspect_ratio;\n\n\t\t\t\t\txmag = ( xmag === undefined ) ? ( ymag * aspectRatio ) : xmag;\n\t\t\t\t\tymag = ( ymag === undefined ) ? ( xmag / aspectRatio ) : ymag;\n\n\t\t\t\t\txmag *= 0.5;\n\t\t\t\t\tymag *= 0.5;\n\n\t\t\t\t\tcamera = new OrthographicCamera(\n\t\t\t\t\t\t- xmag, xmag, ymag, - ymag, // left, right, top, bottom\n\t\t\t\t\t\tdata.optics.parameters.znear,\n\t\t\t\t\t\tdata.optics.parameters.zfar\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tcamera = new PerspectiveCamera();\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tcamera.name = data.name || '';\n\n\t\t\treturn camera;\n\n\t\t}\n\n\t\tfunction getCamera( id ) {\n\n\t\t\tconst data = library.cameras[ id ];\n\n\t\t\tif ( data !== undefined ) {\n\n\t\t\t\treturn getBuild( data, buildCamera );\n\n\t\t\t}\n\n\t\t\tconsole.warn( 'THREE.ColladaLoader: Couldn\\'t find camera with ID:', id );\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// light\n\n\t\tfunction parseLight( xml ) {\n\n\t\t\tlet data = {};\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'technique_common':\n\t\t\t\t\t\tdata = parseLightTechnique( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.lights[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction parseLightTechnique( xml ) {\n\n\t\t\tconst data = {};\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'directional':\n\t\t\t\t\tcase 'point':\n\t\t\t\t\tcase 'spot':\n\t\t\t\t\tcase 'ambient':\n\n\t\t\t\t\t\tdata.technique = child.nodeName;\n\t\t\t\t\t\tdata.parameters = parseLightParameters( child );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseLightParameters( xml ) {\n\n\t\t\tconst data = {};\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'color':\n\t\t\t\t\t\tconst array = parseFloats( child.textContent );\n\t\t\t\t\t\tdata.color = new Color().fromArray( array ).convertSRGBToLinear();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'falloff_angle':\n\t\t\t\t\t\tdata.falloffAngle = parseFloat( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'quadratic_attenuation':\n\t\t\t\t\t\tconst f = parseFloat( child.textContent );\n\t\t\t\t\t\tdata.distance = f ? Math.sqrt( 1 / f ) : 0;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction buildLight( data ) {\n\n\t\t\tlet light;\n\n\t\t\tswitch ( data.technique ) {\n\n\t\t\t\tcase 'directional':\n\t\t\t\t\tlight = new DirectionalLight();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'point':\n\t\t\t\t\tlight = new PointLight();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'spot':\n\t\t\t\t\tlight = new SpotLight();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'ambient':\n\t\t\t\t\tlight = new AmbientLight();\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tif ( data.parameters.color ) light.color.copy( data.parameters.color );\n\t\t\tif ( data.parameters.distance ) light.distance = data.parameters.distance;\n\n\t\t\treturn light;\n\n\t\t}\n\n\t\tfunction getLight( id ) {\n\n\t\t\tconst data = library.lights[ id ];\n\n\t\t\tif ( data !== undefined ) {\n\n\t\t\t\treturn getBuild( data, buildLight );\n\n\t\t\t}\n\n\t\t\tconsole.warn( 'THREE.ColladaLoader: Couldn\\'t find light with ID:', id );\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// geometry\n\n\t\tfunction parseGeometry( xml ) {\n\n\t\t\tconst data = {\n\t\t\t\tname: xml.getAttribute( 'name' ),\n\t\t\t\tsources: {},\n\t\t\t\tvertices: {},\n\t\t\t\tprimitives: []\n\t\t\t};\n\n\t\t\tconst mesh = getElementsByTagName( xml, 'mesh' )[ 0 ];\n\n\t\t\t// the following tags inside geometry are not supported yet (see https://github.com/mrdoob/three.js/pull/12606): convex_mesh, spline, brep\n\t\t\tif ( mesh === undefined ) return;\n\n\t\t\tfor ( let i = 0; i < mesh.childNodes.length; i ++ ) {\n\n\t\t\t\tconst child = mesh.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tconst id = child.getAttribute( 'id' );\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'source':\n\t\t\t\t\t\tdata.sources[ id ] = parseSource( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'vertices':\n\t\t\t\t\t\t// data.sources[ id ] = data.sources[ parseId( getElementsByTagName( child, 'input' )[ 0 ].getAttribute( 'source' ) ) ];\n\t\t\t\t\t\tdata.vertices = parseGeometryVertices( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'polygons':\n\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Unsupported primitive type: ', child.nodeName );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'lines':\n\t\t\t\t\tcase 'linestrips':\n\t\t\t\t\tcase 'polylist':\n\t\t\t\t\tcase 'triangles':\n\t\t\t\t\t\tdata.primitives.push( parseGeometryPrimitive( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tconsole.log( child );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.geometries[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction parseSource( xml ) {\n\n\t\t\tconst data = {\n\t\t\t\tarray: [],\n\t\t\t\tstride: 3\n\t\t\t};\n\n\t\t\tfor ( let i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'float_array':\n\t\t\t\t\t\tdata.array = parseFloats( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'Name_array':\n\t\t\t\t\t\tdata.array = parseStrings( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'technique_common':\n\t\t\t\t\t\tconst accessor = getElementsByTagName( child, 'accessor' )[ 0 ];\n\n\t\t\t\t\t\tif ( accessor !== undefined ) {\n\n\t\t\t\t\t\t\tdata.stride = parseInt( accessor.getAttribute( 'stride' ) );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseGeometryVertices( xml ) {\n\n\t\t\tconst data = {};\n\n\t\t\tfor ( let i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tdata[ child.getAttribute( 'semantic' ) ] = parseId( child.getAttribute( 'source' ) );\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseGeometryPrimitive( xml ) {\n\n\t\t\tconst primitive = {\n\t\t\t\ttype: xml.nodeName,\n\t\t\t\tmaterial: xml.getAttribute( 'material' ),\n\t\t\t\tcount: parseInt( xml.getAttribute( 'count' ) ),\n\t\t\t\tinputs: {},\n\t\t\t\tstride: 0,\n\t\t\t\thasUV: false\n\t\t\t};\n\n\t\t\tfor ( let i = 0, l = xml.childNodes.length; i < l; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'input':\n\t\t\t\t\t\tconst id = parseId( child.getAttribute( 'source' ) );\n\t\t\t\t\t\tconst semantic = child.getAttribute( 'semantic' );\n\t\t\t\t\t\tconst offset = parseInt( child.getAttribute( 'offset' ) );\n\t\t\t\t\t\tconst set = parseInt( child.getAttribute( 'set' ) );\n\t\t\t\t\t\tconst inputname = ( set > 0 ? semantic + set : semantic );\n\t\t\t\t\t\tprimitive.inputs[ inputname ] = { id: id, offset: offset };\n\t\t\t\t\t\tprimitive.stride = Math.max( primitive.stride, offset + 1 );\n\t\t\t\t\t\tif ( semantic === 'TEXCOORD' ) primitive.hasUV = true;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'vcount':\n\t\t\t\t\t\tprimitive.vcount = parseInts( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'p':\n\t\t\t\t\t\tprimitive.p = parseInts( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn primitive;\n\n\t\t}\n\n\t\tfunction groupPrimitives( primitives ) {\n\n\t\t\tconst build = {};\n\n\t\t\tfor ( let i = 0; i < primitives.length; i ++ ) {\n\n\t\t\t\tconst primitive = primitives[ i ];\n\n\t\t\t\tif ( build[ primitive.type ] === undefined ) build[ primitive.type ] = [];\n\n\t\t\t\tbuild[ primitive.type ].push( primitive );\n\n\t\t\t}\n\n\t\t\treturn build;\n\n\t\t}\n\n\t\tfunction checkUVCoordinates( primitives ) {\n\n\t\t\tlet count = 0;\n\n\t\t\tfor ( let i = 0, l = primitives.length; i < l; i ++ ) {\n\n\t\t\t\tconst primitive = primitives[ i ];\n\n\t\t\t\tif ( primitive.hasUV === true ) {\n\n\t\t\t\t\tcount ++;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( count > 0 && count < primitives.length ) {\n\n\t\t\t\tprimitives.uvsNeedsFix = true;\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction buildGeometry( data ) {\n\n\t\t\tconst build = {};\n\n\t\t\tconst sources = data.sources;\n\t\t\tconst vertices = data.vertices;\n\t\t\tconst primitives = data.primitives;\n\n\t\t\tif ( primitives.length === 0 ) return {};\n\n\t\t\t// our goal is to create one buffer geometry for a single type of primitives\n\t\t\t// first, we group all primitives by their type\n\n\t\t\tconst groupedPrimitives = groupPrimitives( primitives );\n\n\t\t\tfor ( const type in groupedPrimitives ) {\n\n\t\t\t\tconst primitiveType = groupedPrimitives[ type ];\n\n\t\t\t\t// second, ensure consistent uv coordinates for each type of primitives (polylist,triangles or lines)\n\n\t\t\t\tcheckUVCoordinates( primitiveType );\n\n\t\t\t\t// third, create a buffer geometry for each type of primitives\n\n\t\t\t\tbuild[ type ] = buildGeometryType( primitiveType, sources, vertices );\n\n\t\t\t}\n\n\t\t\treturn build;\n\n\t\t}\n\n\t\tfunction buildGeometryType( primitives, sources, vertices ) {\n\n\t\t\tconst build = {};\n\n\t\t\tconst position = { array: [], stride: 0 };\n\t\t\tconst normal = { array: [], stride: 0 };\n\t\t\tconst uv = { array: [], stride: 0 };\n\t\t\tconst uv2 = { array: [], stride: 0 };\n\t\t\tconst color = { array: [], stride: 0 };\n\n\t\t\tconst skinIndex = { array: [], stride: 4 };\n\t\t\tconst skinWeight = { array: [], stride: 4 };\n\n\t\t\tconst geometry = new BufferGeometry();\n\n\t\t\tconst materialKeys = [];\n\n\t\t\tlet start = 0;\n\n\t\t\tfor ( let p = 0; p < primitives.length; p ++ ) {\n\n\t\t\t\tconst primitive = primitives[ p ];\n\t\t\t\tconst inputs = primitive.inputs;\n\n\t\t\t\t// groups\n\n\t\t\t\tlet count = 0;\n\n\t\t\t\tswitch ( primitive.type ) {\n\n\t\t\t\t\tcase 'lines':\n\t\t\t\t\tcase 'linestrips':\n\t\t\t\t\t\tcount = primitive.count * 2;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'triangles':\n\t\t\t\t\t\tcount = primitive.count * 3;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'polylist':\n\n\t\t\t\t\t\tfor ( let g = 0; g < primitive.count; g ++ ) {\n\n\t\t\t\t\t\t\tconst vc = primitive.vcount[ g ];\n\n\t\t\t\t\t\t\tswitch ( vc ) {\n\n\t\t\t\t\t\t\t\tcase 3:\n\t\t\t\t\t\t\t\t\tcount += 3; // single triangle\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tcase 4:\n\t\t\t\t\t\t\t\t\tcount += 6; // quad, subdivided into two triangles\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\tcount += ( vc - 2 ) * 3; // polylist with more than four vertices\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Unknow primitive type:', primitive.type );\n\n\t\t\t\t}\n\n\t\t\t\tgeometry.addGroup( start, count, p );\n\t\t\t\tstart += count;\n\n\t\t\t\t// material\n\n\t\t\t\tif ( primitive.material ) {\n\n\t\t\t\t\tmaterialKeys.push( primitive.material );\n\n\t\t\t\t}\n\n\t\t\t\t// geometry data\n\n\t\t\t\tfor ( const name in inputs ) {\n\n\t\t\t\t\tconst input = inputs[ name ];\n\n\t\t\t\t\tswitch ( name )\t{\n\n\t\t\t\t\t\tcase 'VERTEX':\n\t\t\t\t\t\t\tfor ( const key in vertices ) {\n\n\t\t\t\t\t\t\t\tconst id = vertices[ key ];\n\n\t\t\t\t\t\t\t\tswitch ( key ) {\n\n\t\t\t\t\t\t\t\t\tcase 'POSITION':\n\t\t\t\t\t\t\t\t\t\tconst prevLength = position.array.length;\n\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ id ], input.offset, position.array );\n\t\t\t\t\t\t\t\t\t\tposition.stride = sources[ id ].stride;\n\n\t\t\t\t\t\t\t\t\t\tif ( sources.skinWeights && sources.skinIndices ) {\n\n\t\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources.skinIndices, input.offset, skinIndex.array );\n\t\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources.skinWeights, input.offset, skinWeight.array );\n\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t// see #3803\n\n\t\t\t\t\t\t\t\t\t\tif ( primitive.hasUV === false && primitives.uvsNeedsFix === true ) {\n\n\t\t\t\t\t\t\t\t\t\t\tconst count = ( position.array.length - prevLength ) / position.stride;\n\n\t\t\t\t\t\t\t\t\t\t\tfor ( let i = 0; i < count; i ++ ) {\n\n\t\t\t\t\t\t\t\t\t\t\t\t// fill missing uv coordinates\n\n\t\t\t\t\t\t\t\t\t\t\t\tuv.array.push( 0, 0 );\n\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tcase 'NORMAL':\n\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ id ], input.offset, normal.array );\n\t\t\t\t\t\t\t\t\t\tnormal.stride = sources[ id ].stride;\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tcase 'COLOR':\n\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ id ], input.offset, color.array );\n\t\t\t\t\t\t\t\t\t\tcolor.stride = sources[ id ].stride;\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tcase 'TEXCOORD':\n\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ id ], input.offset, uv.array );\n\t\t\t\t\t\t\t\t\t\tuv.stride = sources[ id ].stride;\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tcase 'TEXCOORD1':\n\t\t\t\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ id ], input.offset, uv2.array );\n\t\t\t\t\t\t\t\t\t\tuv.stride = sources[ id ].stride;\n\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Semantic \"%s\" not handled in geometry build process.', key );\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'NORMAL':\n\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ input.id ], input.offset, normal.array );\n\t\t\t\t\t\t\tnormal.stride = sources[ input.id ].stride;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'COLOR':\n\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ input.id ], input.offset, color.array, true );\n\t\t\t\t\t\t\tcolor.stride = sources[ input.id ].stride;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'TEXCOORD':\n\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ input.id ], input.offset, uv.array );\n\t\t\t\t\t\t\tuv.stride = sources[ input.id ].stride;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'TEXCOORD1':\n\t\t\t\t\t\t\tbuildGeometryData( primitive, sources[ input.id ], input.offset, uv2.array );\n\t\t\t\t\t\t\tuv2.stride = sources[ input.id ].stride;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// build geometry\n\n\t\t\tif ( position.array.length > 0 ) geometry.setAttribute( 'position', new Float32BufferAttribute( position.array, position.stride ) );\n\t\t\tif ( normal.array.length > 0 ) geometry.setAttribute( 'normal', new Float32BufferAttribute( normal.array, normal.stride ) );\n\t\t\tif ( color.array.length > 0 ) geometry.setAttribute( 'color', new Float32BufferAttribute( color.array, color.stride ) );\n\t\t\tif ( uv.array.length > 0 ) geometry.setAttribute( 'uv', new Float32BufferAttribute( uv.array, uv.stride ) );\n\t\t\tif ( uv2.array.length > 0 ) geometry.setAttribute( 'uv2', new Float32BufferAttribute( uv2.array, uv2.stride ) );\n\n\t\t\tif ( skinIndex.array.length > 0 ) geometry.setAttribute( 'skinIndex', new Float32BufferAttribute( skinIndex.array, skinIndex.stride ) );\n\t\t\tif ( skinWeight.array.length > 0 ) geometry.setAttribute( 'skinWeight', new Float32BufferAttribute( skinWeight.array, skinWeight.stride ) );\n\n\t\t\tbuild.data = geometry;\n\t\t\tbuild.type = primitives[ 0 ].type;\n\t\t\tbuild.materialKeys = materialKeys;\n\n\t\t\treturn build;\n\n\t\t}\n\n\t\tfunction buildGeometryData( primitive, source, offset, array, isColor = false ) {\n\n\t\t\tconst indices = primitive.p;\n\t\t\tconst stride = primitive.stride;\n\t\t\tconst vcount = primitive.vcount;\n\n\t\t\tfunction pushVector( i ) {\n\n\t\t\t\tlet index = indices[ i + offset ] * sourceStride;\n\t\t\t\tconst length = index + sourceStride;\n\n\t\t\t\tfor ( ; index < length; index ++ ) {\n\n\t\t\t\t\tarray.push( sourceArray[ index ] );\n\n\t\t\t\t}\n\n\t\t\t\tif ( isColor ) {\n\n\t\t\t\t\t// convert the vertex colors from srgb to linear if present\n\t\t\t\t\tconst startIndex = array.length - sourceStride - 1;\n\t\t\t\t\ttempColor.setRGB(\n\t\t\t\t\t\tarray[ startIndex + 0 ],\n\t\t\t\t\t\tarray[ startIndex + 1 ],\n\t\t\t\t\t\tarray[ startIndex + 2 ]\n\t\t\t\t\t).convertSRGBToLinear();\n\n\t\t\t\t\tarray[ startIndex + 0 ] = tempColor.r;\n\t\t\t\t\tarray[ startIndex + 1 ] = tempColor.g;\n\t\t\t\t\tarray[ startIndex + 2 ] = tempColor.b;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tconst sourceArray = source.array;\n\t\t\tconst sourceStride = source.stride;\n\n\t\t\tif ( primitive.vcount !== undefined ) {\n\n\t\t\t\tlet index = 0;\n\n\t\t\t\tfor ( let i = 0, l = vcount.length; i < l; i ++ ) {\n\n\t\t\t\t\tconst count = vcount[ i ];\n\n\t\t\t\t\tif ( count === 4 ) {\n\n\t\t\t\t\t\tconst a = index + stride * 0;\n\t\t\t\t\t\tconst b = index + stride * 1;\n\t\t\t\t\t\tconst c = index + stride * 2;\n\t\t\t\t\t\tconst d = index + stride * 3;\n\n\t\t\t\t\t\tpushVector( a ); pushVector( b ); pushVector( d );\n\t\t\t\t\t\tpushVector( b ); pushVector( c ); pushVector( d );\n\n\t\t\t\t\t} else if ( count === 3 ) {\n\n\t\t\t\t\t\tconst a = index + stride * 0;\n\t\t\t\t\t\tconst b = index + stride * 1;\n\t\t\t\t\t\tconst c = index + stride * 2;\n\n\t\t\t\t\t\tpushVector( a ); pushVector( b ); pushVector( c );\n\n\t\t\t\t\t} else if ( count > 4 ) {\n\n\t\t\t\t\t\tfor ( let k = 1, kl = ( count - 2 ); k <= kl; k ++ ) {\n\n\t\t\t\t\t\t\tconst a = index + stride * 0;\n\t\t\t\t\t\t\tconst b = index + stride * k;\n\t\t\t\t\t\t\tconst c = index + stride * ( k + 1 );\n\n\t\t\t\t\t\t\tpushVector( a ); pushVector( b ); pushVector( c );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tindex += stride * count;\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tfor ( let i = 0, l = indices.length; i < l; i += stride ) {\n\n\t\t\t\t\tpushVector( i );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction getGeometry( id ) {\n\n\t\t\treturn getBuild( library.geometries[ id ], buildGeometry );\n\n\t\t}\n\n\t\t// kinematics\n\n\t\tfunction parseKinematicsModel( xml ) {\n\n\t\t\tconst data = {\n\t\t\t\tname: xml.getAttribute( 'name' ) || '',\n\t\t\t\tjoints: {},\n\t\t\t\tlinks: []\n\t\t\t};\n\n\t\t\tfor ( let i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'technique_common':\n\t\t\t\t\t\tparseKinematicsTechniqueCommon( child, data );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.kinematicsModels[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction buildKinematicsModel( data ) {\n\n\t\t\tif ( data.build !== undefined ) return data.build;\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction getKinematicsModel( id ) {\n\n\t\t\treturn getBuild( library.kinematicsModels[ id ], buildKinematicsModel );\n\n\t\t}\n\n\t\tfunction parseKinematicsTechniqueCommon( xml, data ) {\n\n\t\t\tfor ( let i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'joint':\n\t\t\t\t\t\tdata.joints[ child.getAttribute( 'sid' ) ] = parseKinematicsJoint( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'link':\n\t\t\t\t\t\tdata.links.push( parseKinematicsLink( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction parseKinematicsJoint( xml ) {\n\n\t\t\tlet data;\n\n\t\t\tfor ( let i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'prismatic':\n\t\t\t\t\tcase 'revolute':\n\t\t\t\t\t\tdata = parseKinematicsJointParameter( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseKinematicsJointParameter( xml ) {\n\n\t\t\tconst data = {\n\t\t\t\tsid: xml.getAttribute( 'sid' ),\n\t\t\t\tname: xml.getAttribute( 'name' ) || '',\n\t\t\t\taxis: new Vector3(),\n\t\t\t\tlimits: {\n\t\t\t\t\tmin: 0,\n\t\t\t\t\tmax: 0\n\t\t\t\t},\n\t\t\t\ttype: xml.nodeName,\n\t\t\t\tstatic: false,\n\t\t\t\tzeroPosition: 0,\n\t\t\t\tmiddlePosition: 0\n\t\t\t};\n\n\t\t\tfor ( let i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'axis':\n\t\t\t\t\t\tconst array = parseFloats( child.textContent );\n\t\t\t\t\t\tdata.axis.fromArray( array );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 'limits':\n\t\t\t\t\t\tconst max = child.getElementsByTagName( 'max' )[ 0 ];\n\t\t\t\t\t\tconst min = child.getElementsByTagName( 'min' )[ 0 ];\n\n\t\t\t\t\t\tdata.limits.max = parseFloat( max.textContent );\n\t\t\t\t\t\tdata.limits.min = parseFloat( min.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// if min is equal to or greater than max, consider the joint static\n\n\t\t\tif ( data.limits.min >= data.limits.max ) {\n\n\t\t\t\tdata.static = true;\n\n\t\t\t}\n\n\t\t\t// calculate middle position\n\n\t\t\tdata.middlePosition = ( data.limits.min + data.limits.max ) / 2.0;\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseKinematicsLink( xml ) {\n\n\t\t\tconst data = {\n\t\t\t\tsid: xml.getAttribute( 'sid' ),\n\t\t\t\tname: xml.getAttribute( 'name' ) || '',\n\t\t\t\tattachments: [],\n\t\t\t\ttransforms: []\n\t\t\t};\n\n\t\t\tfor ( let i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'attachment_full':\n\t\t\t\t\t\tdata.attachments.push( parseKinematicsAttachment( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'matrix':\n\t\t\t\t\tcase 'translate':\n\t\t\t\t\tcase 'rotate':\n\t\t\t\t\t\tdata.transforms.push( parseKinematicsTransform( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseKinematicsAttachment( xml ) {\n\n\t\t\tconst data = {\n\t\t\t\tjoint: xml.getAttribute( 'joint' ).split( '/' ).pop(),\n\t\t\t\ttransforms: [],\n\t\t\t\tlinks: []\n\t\t\t};\n\n\t\t\tfor ( let i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'link':\n\t\t\t\t\t\tdata.links.push( parseKinematicsLink( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'matrix':\n\t\t\t\t\tcase 'translate':\n\t\t\t\t\tcase 'rotate':\n\t\t\t\t\t\tdata.transforms.push( parseKinematicsTransform( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseKinematicsTransform( xml ) {\n\n\t\t\tconst data = {\n\t\t\t\ttype: xml.nodeName\n\t\t\t};\n\n\t\t\tconst array = parseFloats( xml.textContent );\n\n\t\t\tswitch ( data.type ) {\n\n\t\t\t\tcase 'matrix':\n\t\t\t\t\tdata.obj = new Matrix4();\n\t\t\t\t\tdata.obj.fromArray( array ).transpose();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'translate':\n\t\t\t\t\tdata.obj = new Vector3();\n\t\t\t\t\tdata.obj.fromArray( array );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'rotate':\n\t\t\t\t\tdata.obj = new Vector3();\n\t\t\t\t\tdata.obj.fromArray( array );\n\t\t\t\t\tdata.angle = MathUtils.degToRad( array[ 3 ] );\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\t// physics\n\n\t\tfunction parsePhysicsModel( xml ) {\n\n\t\t\tconst data = {\n\t\t\t\tname: xml.getAttribute( 'name' ) || '',\n\t\t\t\trigidBodies: {}\n\t\t\t};\n\n\t\t\tfor ( let i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'rigid_body':\n\t\t\t\t\t\tdata.rigidBodies[ child.getAttribute( 'name' ) ] = {};\n\t\t\t\t\t\tparsePhysicsRigidBody( child, data.rigidBodies[ child.getAttribute( 'name' ) ] );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.physicsModels[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction parsePhysicsRigidBody( xml, data ) {\n\n\t\t\tfor ( let i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'technique_common':\n\t\t\t\t\t\tparsePhysicsTechniqueCommon( child, data );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tfunction parsePhysicsTechniqueCommon( xml, data ) {\n\n\t\t\tfor ( let i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'inertia':\n\t\t\t\t\t\tdata.inertia = parseFloats( child.textContent );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'mass':\n\t\t\t\t\t\tdata.mass = parseFloats( child.textContent )[ 0 ];\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t// scene\n\n\t\tfunction parseKinematicsScene( xml ) {\n\n\t\t\tconst data = {\n\t\t\t\tbindJointAxis: []\n\t\t\t};\n\n\t\t\tfor ( let i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'bind_joint_axis':\n\t\t\t\t\t\tdata.bindJointAxis.push( parseKinematicsBindJointAxis( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tlibrary.kinematicsScenes[ parseId( xml.getAttribute( 'url' ) ) ] = data;\n\n\t\t}\n\n\t\tfunction parseKinematicsBindJointAxis( xml ) {\n\n\t\t\tconst data = {\n\t\t\t\ttarget: xml.getAttribute( 'target' ).split( '/' ).pop()\n\t\t\t};\n\n\t\t\tfor ( let i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'axis':\n\t\t\t\t\t\tconst param = child.getElementsByTagName( 'param' )[ 0 ];\n\t\t\t\t\t\tdata.axis = param.textContent;\n\t\t\t\t\t\tconst tmpJointIndex = data.axis.split( 'inst_' ).pop().split( 'axis' )[ 0 ];\n\t\t\t\t\t\tdata.jointIndex = tmpJointIndex.substring( 0, tmpJointIndex.length - 1 );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction buildKinematicsScene( data ) {\n\n\t\t\tif ( data.build !== undefined ) return data.build;\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction getKinematicsScene( id ) {\n\n\t\t\treturn getBuild( library.kinematicsScenes[ id ], buildKinematicsScene );\n\n\t\t}\n\n\t\tfunction setupKinematics() {\n\n\t\t\tconst kinematicsModelId = Object.keys( library.kinematicsModels )[ 0 ];\n\t\t\tconst kinematicsSceneId = Object.keys( library.kinematicsScenes )[ 0 ];\n\t\t\tconst visualSceneId = Object.keys( library.visualScenes )[ 0 ];\n\n\t\t\tif ( kinematicsModelId === undefined || kinematicsSceneId === undefined ) return;\n\n\t\t\tconst kinematicsModel = getKinematicsModel( kinematicsModelId );\n\t\t\tconst kinematicsScene = getKinematicsScene( kinematicsSceneId );\n\t\t\tconst visualScene = getVisualScene( visualSceneId );\n\n\t\t\tconst bindJointAxis = kinematicsScene.bindJointAxis;\n\t\t\tconst jointMap = {};\n\n\t\t\tfor ( let i = 0, l = bindJointAxis.length; i < l; i ++ ) {\n\n\t\t\t\tconst axis = bindJointAxis[ i ];\n\n\t\t\t\t// the result of the following query is an element of type 'translate', 'rotate','scale' or 'matrix'\n\n\t\t\t\tconst targetElement = collada.querySelector( '[sid=\"' + axis.target + '\"]' );\n\n\t\t\t\tif ( targetElement ) {\n\n\t\t\t\t\t// get the parent of the transform element\n\n\t\t\t\t\tconst parentVisualElement = targetElement.parentElement;\n\n\t\t\t\t\t// connect the joint of the kinematics model with the element in the visual scene\n\n\t\t\t\t\tconnect( axis.jointIndex, parentVisualElement );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tfunction connect( jointIndex, visualElement ) {\n\n\t\t\t\tconst visualElementName = visualElement.getAttribute( 'name' );\n\t\t\t\tconst joint = kinematicsModel.joints[ jointIndex ];\n\n\t\t\t\tvisualScene.traverse( function ( object ) {\n\n\t\t\t\t\tif ( object.name === visualElementName ) {\n\n\t\t\t\t\t\tjointMap[ jointIndex ] = {\n\t\t\t\t\t\t\tobject: object,\n\t\t\t\t\t\t\ttransforms: buildTransformList( visualElement ),\n\t\t\t\t\t\t\tjoint: joint,\n\t\t\t\t\t\t\tposition: joint.zeroPosition\n\t\t\t\t\t\t};\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tconst m0 = new Matrix4();\n\n\t\t\tkinematics = {\n\n\t\t\t\tjoints: kinematicsModel && kinematicsModel.joints,\n\n\t\t\t\tgetJointValue: function ( jointIndex ) {\n\n\t\t\t\t\tconst jointData = jointMap[ jointIndex ];\n\n\t\t\t\t\tif ( jointData ) {\n\n\t\t\t\t\t\treturn jointData.position;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Joint ' + jointIndex + ' doesn\\'t exist.' );\n\n\t\t\t\t\t}\n\n\t\t\t\t},\n\n\t\t\t\tsetJointValue: function ( jointIndex, value ) {\n\n\t\t\t\t\tconst jointData = jointMap[ jointIndex ];\n\n\t\t\t\t\tif ( jointData ) {\n\n\t\t\t\t\t\tconst joint = jointData.joint;\n\n\t\t\t\t\t\tif ( value > joint.limits.max || value < joint.limits.min ) {\n\n\t\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Joint ' + jointIndex + ' value ' + value + ' outside of limits (min: ' + joint.limits.min + ', max: ' + joint.limits.max + ').' );\n\n\t\t\t\t\t\t} else if ( joint.static ) {\n\n\t\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Joint ' + jointIndex + ' is static.' );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tconst object = jointData.object;\n\t\t\t\t\t\t\tconst axis = joint.axis;\n\t\t\t\t\t\t\tconst transforms = jointData.transforms;\n\n\t\t\t\t\t\t\tmatrix.identity();\n\n\t\t\t\t\t\t\t// each update, we have to apply all transforms in the correct order\n\n\t\t\t\t\t\t\tfor ( let i = 0; i < transforms.length; i ++ ) {\n\n\t\t\t\t\t\t\t\tconst transform = transforms[ i ];\n\n\t\t\t\t\t\t\t\t// if there is a connection of the transform node with a joint, apply the joint value\n\n\t\t\t\t\t\t\t\tif ( transform.sid && transform.sid.indexOf( jointIndex ) !== - 1 ) {\n\n\t\t\t\t\t\t\t\t\tswitch ( joint.type ) {\n\n\t\t\t\t\t\t\t\t\t\tcase 'revolute':\n\t\t\t\t\t\t\t\t\t\t\tmatrix.multiply( m0.makeRotationAxis( axis, MathUtils.degToRad( value ) ) );\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tcase 'prismatic':\n\t\t\t\t\t\t\t\t\t\t\tmatrix.multiply( m0.makeTranslation( axis.x * value, axis.y * value, axis.z * value ) );\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Unknown joint type: ' + joint.type );\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t\t\tswitch ( transform.type ) {\n\n\t\t\t\t\t\t\t\t\t\tcase 'matrix':\n\t\t\t\t\t\t\t\t\t\t\tmatrix.multiply( transform.obj );\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tcase 'translate':\n\t\t\t\t\t\t\t\t\t\t\tmatrix.multiply( m0.makeTranslation( transform.obj.x, transform.obj.y, transform.obj.z ) );\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tcase 'scale':\n\t\t\t\t\t\t\t\t\t\t\tmatrix.scale( transform.obj );\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tcase 'rotate':\n\t\t\t\t\t\t\t\t\t\t\tmatrix.multiply( m0.makeRotationAxis( transform.obj, transform.angle ) );\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tobject.matrix.copy( matrix );\n\t\t\t\t\t\t\tobject.matrix.decompose( object.position, object.quaternion, object.scale );\n\n\t\t\t\t\t\t\tjointMap[ jointIndex ].position = value;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tconsole.log( 'THREE.ColladaLoader: ' + jointIndex + ' does not exist.' );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t}\n\n\t\tfunction buildTransformList( node ) {\n\n\t\t\tconst transforms = [];\n\n\t\t\tconst xml = collada.querySelector( '[id=\"' + node.id + '\"]' );\n\n\t\t\tfor ( let i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tlet array, vector;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'matrix':\n\t\t\t\t\t\tarray = parseFloats( child.textContent );\n\t\t\t\t\t\tconst matrix = new Matrix4().fromArray( array ).transpose();\n\t\t\t\t\t\ttransforms.push( {\n\t\t\t\t\t\t\tsid: child.getAttribute( 'sid' ),\n\t\t\t\t\t\t\ttype: child.nodeName,\n\t\t\t\t\t\t\tobj: matrix\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'translate':\n\t\t\t\t\tcase 'scale':\n\t\t\t\t\t\tarray = parseFloats( child.textContent );\n\t\t\t\t\t\tvector = new Vector3().fromArray( array );\n\t\t\t\t\t\ttransforms.push( {\n\t\t\t\t\t\t\tsid: child.getAttribute( 'sid' ),\n\t\t\t\t\t\t\ttype: child.nodeName,\n\t\t\t\t\t\t\tobj: vector\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'rotate':\n\t\t\t\t\t\tarray = parseFloats( child.textContent );\n\t\t\t\t\t\tvector = new Vector3().fromArray( array );\n\t\t\t\t\t\tconst angle = MathUtils.degToRad( array[ 3 ] );\n\t\t\t\t\t\ttransforms.push( {\n\t\t\t\t\t\t\tsid: child.getAttribute( 'sid' ),\n\t\t\t\t\t\t\ttype: child.nodeName,\n\t\t\t\t\t\t\tobj: vector,\n\t\t\t\t\t\t\tangle: angle\n\t\t\t\t\t\t} );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn transforms;\n\n\t\t}\n\n\t\t// nodes\n\n\t\tfunction prepareNodes( xml ) {\n\n\t\t\tconst elements = xml.getElementsByTagName( 'node' );\n\n\t\t\t// ensure all node elements have id attributes\n\n\t\t\tfor ( let i = 0; i < elements.length; i ++ ) {\n\n\t\t\t\tconst element = elements[ i ];\n\n\t\t\t\tif ( element.hasAttribute( 'id' ) === false ) {\n\n\t\t\t\t\telement.setAttribute( 'id', generateId() );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst matrix = new Matrix4();\n\t\tconst vector = new Vector3();\n\n\t\tfunction parseNode( xml ) {\n\n\t\t\tconst data = {\n\t\t\t\tname: xml.getAttribute( 'name' ) || '',\n\t\t\t\ttype: xml.getAttribute( 'type' ),\n\t\t\t\tid: xml.getAttribute( 'id' ),\n\t\t\t\tsid: xml.getAttribute( 'sid' ),\n\t\t\t\tmatrix: new Matrix4(),\n\t\t\t\tnodes: [],\n\t\t\t\tinstanceCameras: [],\n\t\t\t\tinstanceControllers: [],\n\t\t\t\tinstanceLights: [],\n\t\t\t\tinstanceGeometries: [],\n\t\t\t\tinstanceNodes: [],\n\t\t\t\ttransforms: {}\n\t\t\t};\n\n\t\t\tfor ( let i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tif ( child.nodeType !== 1 ) continue;\n\n\t\t\t\tlet array;\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'node':\n\t\t\t\t\t\tdata.nodes.push( child.getAttribute( 'id' ) );\n\t\t\t\t\t\tparseNode( child );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'instance_camera':\n\t\t\t\t\t\tdata.instanceCameras.push( parseId( child.getAttribute( 'url' ) ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'instance_controller':\n\t\t\t\t\t\tdata.instanceControllers.push( parseNodeInstance( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'instance_light':\n\t\t\t\t\t\tdata.instanceLights.push( parseId( child.getAttribute( 'url' ) ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'instance_geometry':\n\t\t\t\t\t\tdata.instanceGeometries.push( parseNodeInstance( child ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'instance_node':\n\t\t\t\t\t\tdata.instanceNodes.push( parseId( child.getAttribute( 'url' ) ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'matrix':\n\t\t\t\t\t\tarray = parseFloats( child.textContent );\n\t\t\t\t\t\tdata.matrix.multiply( matrix.fromArray( array ).transpose() );\n\t\t\t\t\t\tdata.transforms[ child.getAttribute( 'sid' ) ] = child.nodeName;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'translate':\n\t\t\t\t\t\tarray = parseFloats( child.textContent );\n\t\t\t\t\t\tvector.fromArray( array );\n\t\t\t\t\t\tdata.matrix.multiply( matrix.makeTranslation( vector.x, vector.y, vector.z ) );\n\t\t\t\t\t\tdata.transforms[ child.getAttribute( 'sid' ) ] = child.nodeName;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'rotate':\n\t\t\t\t\t\tarray = parseFloats( child.textContent );\n\t\t\t\t\t\tconst angle = MathUtils.degToRad( array[ 3 ] );\n\t\t\t\t\t\tdata.matrix.multiply( matrix.makeRotationAxis( vector.fromArray( array ), angle ) );\n\t\t\t\t\t\tdata.transforms[ child.getAttribute( 'sid' ) ] = child.nodeName;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'scale':\n\t\t\t\t\t\tarray = parseFloats( child.textContent );\n\t\t\t\t\t\tdata.matrix.scale( vector.fromArray( array ) );\n\t\t\t\t\t\tdata.transforms[ child.getAttribute( 'sid' ) ] = child.nodeName;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'extra':\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tconsole.log( child );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( hasNode( data.id ) ) {\n\n\t\t\t\tconsole.warn( 'THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.', data.id );\n\n\t\t\t} else {\n\n\t\t\t\tlibrary.nodes[ data.id ] = data;\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction parseNodeInstance( xml ) {\n\n\t\t\tconst data = {\n\t\t\t\tid: parseId( xml.getAttribute( 'url' ) ),\n\t\t\t\tmaterials: {},\n\t\t\t\tskeletons: []\n\t\t\t};\n\n\t\t\tfor ( let i = 0; i < xml.childNodes.length; i ++ ) {\n\n\t\t\t\tconst child = xml.childNodes[ i ];\n\n\t\t\t\tswitch ( child.nodeName ) {\n\n\t\t\t\t\tcase 'bind_material':\n\t\t\t\t\t\tconst instances = child.getElementsByTagName( 'instance_material' );\n\n\t\t\t\t\t\tfor ( let j = 0; j < instances.length; j ++ ) {\n\n\t\t\t\t\t\t\tconst instance = instances[ j ];\n\t\t\t\t\t\t\tconst symbol = instance.getAttribute( 'symbol' );\n\t\t\t\t\t\t\tconst target = instance.getAttribute( 'target' );\n\n\t\t\t\t\t\t\tdata.materials[ symbol ] = parseId( target );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'skeleton':\n\t\t\t\t\t\tdata.skeletons.push( parseId( child.textContent ) );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn data;\n\n\t\t}\n\n\t\tfunction buildSkeleton( skeletons, joints ) {\n\n\t\t\tconst boneData = [];\n\t\t\tconst sortedBoneData = [];\n\n\t\t\tlet i, j, data;\n\n\t\t\t// a skeleton can have multiple root bones. collada expresses this\n\t\t\t// situtation with multiple \"skeleton\" tags per controller instance\n\n\t\t\tfor ( i = 0; i < skeletons.length; i ++ ) {\n\n\t\t\t\tconst skeleton = skeletons[ i ];\n\n\t\t\t\tlet root;\n\n\t\t\t\tif ( hasNode( skeleton ) ) {\n\n\t\t\t\t\troot = getNode( skeleton );\n\t\t\t\t\tbuildBoneHierarchy( root, joints, boneData );\n\n\t\t\t\t} else if ( hasVisualScene( skeleton ) ) {\n\n\t\t\t\t\t// handle case where the skeleton refers to the visual scene (#13335)\n\n\t\t\t\t\tconst visualScene = library.visualScenes[ skeleton ];\n\t\t\t\t\tconst children = visualScene.children;\n\n\t\t\t\t\tfor ( let j = 0; j < children.length; j ++ ) {\n\n\t\t\t\t\t\tconst child = children[ j ];\n\n\t\t\t\t\t\tif ( child.type === 'JOINT' ) {\n\n\t\t\t\t\t\t\tconst root = getNode( child.id );\n\t\t\t\t\t\t\tbuildBoneHierarchy( root, joints, boneData );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.error( 'THREE.ColladaLoader: Unable to find root bone of skeleton with ID:', skeleton );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// sort bone data (the order is defined in the corresponding controller)\n\n\t\t\tfor ( i = 0; i < joints.length; i ++ ) {\n\n\t\t\t\tfor ( j = 0; j < boneData.length; j ++ ) {\n\n\t\t\t\t\tdata = boneData[ j ];\n\n\t\t\t\t\tif ( data.bone.name === joints[ i ].name ) {\n\n\t\t\t\t\t\tsortedBoneData[ i ] = data;\n\t\t\t\t\t\tdata.processed = true;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// add unprocessed bone data at the end of the list\n\n\t\t\tfor ( i = 0; i < boneData.length; i ++ ) {\n\n\t\t\t\tdata = boneData[ i ];\n\n\t\t\t\tif ( data.processed === false ) {\n\n\t\t\t\t\tsortedBoneData.push( data );\n\t\t\t\t\tdata.processed = true;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// setup arrays for skeleton creation\n\n\t\t\tconst bones = [];\n\t\t\tconst boneInverses = [];\n\n\t\t\tfor ( i = 0; i < sortedBoneData.length; i ++ ) {\n\n\t\t\t\tdata = sortedBoneData[ i ];\n\n\t\t\t\tbones.push( data.bone );\n\t\t\t\tboneInverses.push( data.boneInverse );\n\n\t\t\t}\n\n\t\t\treturn new Skeleton( bones, boneInverses );\n\n\t\t}\n\n\t\tfunction buildBoneHierarchy( root, joints, boneData ) {\n\n\t\t\t// setup bone data from visual scene\n\n\t\t\troot.traverse( function ( object ) {\n\n\t\t\t\tif ( object.isBone === true ) {\n\n\t\t\t\t\tlet boneInverse;\n\n\t\t\t\t\t// retrieve the boneInverse from the controller data\n\n\t\t\t\t\tfor ( let i = 0; i < joints.length; i ++ ) {\n\n\t\t\t\t\t\tconst joint = joints[ i ];\n\n\t\t\t\t\t\tif ( joint.name === object.name ) {\n\n\t\t\t\t\t\t\tboneInverse = joint.boneInverse;\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( boneInverse === undefined ) {\n\n\t\t\t\t\t\t// Unfortunately, there can be joints in the visual scene that are not part of the\n\t\t\t\t\t\t// corresponding controller. In this case, we have to create a dummy boneInverse matrix\n\t\t\t\t\t\t// for the respective bone. This bone won't affect any vertices, because there are no skin indices\n\t\t\t\t\t\t// and weights defined for it. But we still have to add the bone to the sorted bone list in order to\n\t\t\t\t\t\t// ensure a correct animation of the model.\n\n\t\t\t\t\t\tboneInverse = new Matrix4();\n\n\t\t\t\t\t}\n\n\t\t\t\t\tboneData.push( { bone: object, boneInverse: boneInverse, processed: false } );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t}\n\n\t\tfunction buildNode( data ) {\n\n\t\t\tconst objects = [];\n\n\t\t\tconst matrix = data.matrix;\n\t\t\tconst nodes = data.nodes;\n\t\t\tconst type = data.type;\n\t\t\tconst instanceCameras = data.instanceCameras;\n\t\t\tconst instanceControllers = data.instanceControllers;\n\t\t\tconst instanceLights = data.instanceLights;\n\t\t\tconst instanceGeometries = data.instanceGeometries;\n\t\t\tconst instanceNodes = data.instanceNodes;\n\n\t\t\t// nodes\n\n\t\t\tfor ( let i = 0, l = nodes.length; i < l; i ++ ) {\n\n\t\t\t\tobjects.push( getNode( nodes[ i ] ) );\n\n\t\t\t}\n\n\t\t\t// instance cameras\n\n\t\t\tfor ( let i = 0, l = instanceCameras.length; i < l; i ++ ) {\n\n\t\t\t\tconst instanceCamera = getCamera( instanceCameras[ i ] );\n\n\t\t\t\tif ( instanceCamera !== null ) {\n\n\t\t\t\t\tobjects.push( instanceCamera.clone() );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// instance controllers\n\n\t\t\tfor ( let i = 0, l = instanceControllers.length; i < l; i ++ ) {\n\n\t\t\t\tconst instance = instanceControllers[ i ];\n\t\t\t\tconst controller = getController( instance.id );\n\t\t\t\tconst geometries = getGeometry( controller.id );\n\t\t\t\tconst newObjects = buildObjects( geometries, instance.materials );\n\n\t\t\t\tconst skeletons = instance.skeletons;\n\t\t\t\tconst joints = controller.skin.joints;\n\n\t\t\t\tconst skeleton = buildSkeleton( skeletons, joints );\n\n\t\t\t\tfor ( let j = 0, jl = newObjects.length; j < jl; j ++ ) {\n\n\t\t\t\t\tconst object = newObjects[ j ];\n\n\t\t\t\t\tif ( object.isSkinnedMesh ) {\n\n\t\t\t\t\t\tobject.bind( skeleton, controller.skin.bindMatrix );\n\t\t\t\t\t\tobject.normalizeSkinWeights();\n\n\t\t\t\t\t}\n\n\t\t\t\t\tobjects.push( object );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// instance lights\n\n\t\t\tfor ( let i = 0, l = instanceLights.length; i < l; i ++ ) {\n\n\t\t\t\tconst instanceLight = getLight( instanceLights[ i ] );\n\n\t\t\t\tif ( instanceLight !== null ) {\n\n\t\t\t\t\tobjects.push( instanceLight.clone() );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// instance geometries\n\n\t\t\tfor ( let i = 0, l = instanceGeometries.length; i < l; i ++ ) {\n\n\t\t\t\tconst instance = instanceGeometries[ i ];\n\n\t\t\t\t// a single geometry instance in collada can lead to multiple object3Ds.\n\t\t\t\t// this is the case when primitives are combined like triangles and lines\n\n\t\t\t\tconst geometries = getGeometry( instance.id );\n\t\t\t\tconst newObjects = buildObjects( geometries, instance.materials );\n\n\t\t\t\tfor ( let j = 0, jl = newObjects.length; j < jl; j ++ ) {\n\n\t\t\t\t\tobjects.push( newObjects[ j ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// instance nodes\n\n\t\t\tfor ( let i = 0, l = instanceNodes.length; i < l; i ++ ) {\n\n\t\t\t\tobjects.push( getNode( instanceNodes[ i ] ).clone() );\n\n\t\t\t}\n\n\t\t\tlet object;\n\n\t\t\tif ( nodes.length === 0 && objects.length === 1 ) {\n\n\t\t\t\tobject = objects[ 0 ];\n\n\t\t\t} else {\n\n\t\t\t\tobject = ( type === 'JOINT' ) ? new Bone() : new Group();\n\n\t\t\t\tfor ( let i = 0; i < objects.length; i ++ ) {\n\n\t\t\t\t\tobject.add( objects[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tobject.name = ( type === 'JOINT' ) ? data.sid : data.name;\n\t\t\tobject.matrix.copy( matrix );\n\t\t\tobject.matrix.decompose( object.position, object.quaternion, object.scale );\n\n\t\t\treturn object;\n\n\t\t}\n\n\t\tconst fallbackMaterial = new MeshBasicMaterial( { color: 0xff00ff } );\n\n\t\tfunction resolveMaterialBinding( keys, instanceMaterials ) {\n\n\t\t\tconst materials = [];\n\n\t\t\tfor ( let i = 0, l = keys.length; i < l; i ++ ) {\n\n\t\t\t\tconst id = instanceMaterials[ keys[ i ] ];\n\n\t\t\t\tif ( id === undefined ) {\n\n\t\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Material with key %s not found. Apply fallback material.', keys[ i ] );\n\t\t\t\t\tmaterials.push( fallbackMaterial );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tmaterials.push( getMaterial( id ) );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn materials;\n\n\t\t}\n\n\t\tfunction buildObjects( geometries, instanceMaterials ) {\n\n\t\t\tconst objects = [];\n\n\t\t\tfor ( const type in geometries ) {\n\n\t\t\t\tconst geometry = geometries[ type ];\n\n\t\t\t\tconst materials = resolveMaterialBinding( geometry.materialKeys, instanceMaterials );\n\n\t\t\t\t// handle case if no materials are defined\n\n\t\t\t\tif ( materials.length === 0 ) {\n\n\t\t\t\t\tif ( type === 'lines' || type === 'linestrips' ) {\n\n\t\t\t\t\t\tmaterials.push( new LineBasicMaterial() );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\tmaterials.push( new MeshPhongMaterial() );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// regard skinning\n\n\t\t\t\tconst skinning = ( geometry.data.attributes.skinIndex !== undefined );\n\n\t\t\t\t// choose between a single or multi materials (material array)\n\n\t\t\t\tconst material = ( materials.length === 1 ) ? materials[ 0 ] : materials;\n\n\t\t\t\t// now create a specific 3D object\n\n\t\t\t\tlet object;\n\n\t\t\t\tswitch ( type ) {\n\n\t\t\t\t\tcase 'lines':\n\t\t\t\t\t\tobject = new LineSegments( geometry.data, material );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'linestrips':\n\t\t\t\t\t\tobject = new Line( geometry.data, material );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 'triangles':\n\t\t\t\t\tcase 'polylist':\n\t\t\t\t\t\tif ( skinning ) {\n\n\t\t\t\t\t\t\tobject = new SkinnedMesh( geometry.data, material );\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\tobject = new Mesh( geometry.data, material );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t\tobjects.push( object );\n\n\t\t\t}\n\n\t\t\treturn objects;\n\n\t\t}\n\n\t\tfunction hasNode( id ) {\n\n\t\t\treturn library.nodes[ id ] !== undefined;\n\n\t\t}\n\n\t\tfunction getNode( id ) {\n\n\t\t\treturn getBuild( library.nodes[ id ], buildNode );\n\n\t\t}\n\n\t\t// visual scenes\n\n\t\tfunction parseVisualScene( xml ) {\n\n\t\t\tconst data = {\n\t\t\t\tname: xml.getAttribute( 'name' ),\n\t\t\t\tchildren: []\n\t\t\t};\n\n\t\t\tprepareNodes( xml );\n\n\t\t\tconst elements = getElementsByTagName( xml, 'node' );\n\n\t\t\tfor ( let i = 0; i < elements.length; i ++ ) {\n\n\t\t\t\tdata.children.push( parseNode( elements[ i ] ) );\n\n\t\t\t}\n\n\t\t\tlibrary.visualScenes[ xml.getAttribute( 'id' ) ] = data;\n\n\t\t}\n\n\t\tfunction buildVisualScene( data ) {\n\n\t\t\tconst group = new Group();\n\t\t\tgroup.name = data.name;\n\n\t\t\tconst children = data.children;\n\n\t\t\tfor ( let i = 0; i < children.length; i ++ ) {\n\n\t\t\t\tconst child = children[ i ];\n\n\t\t\t\tgroup.add( getNode( child.id ) );\n\n\t\t\t}\n\n\t\t\treturn group;\n\n\t\t}\n\n\t\tfunction hasVisualScene( id ) {\n\n\t\t\treturn library.visualScenes[ id ] !== undefined;\n\n\t\t}\n\n\t\tfunction getVisualScene( id ) {\n\n\t\t\treturn getBuild( library.visualScenes[ id ], buildVisualScene );\n\n\t\t}\n\n\t\t// scenes\n\n\t\tfunction parseScene( xml ) {\n\n\t\t\tconst instance = getElementsByTagName( xml, 'instance_visual_scene' )[ 0 ];\n\t\t\treturn getVisualScene( parseId( instance.getAttribute( 'url' ) ) );\n\n\t\t}\n\n\t\tfunction setupAnimations() {\n\n\t\t\tconst clips = library.clips;\n\n\t\t\tif ( isEmpty( clips ) === true ) {\n\n\t\t\t\tif ( isEmpty( library.animations ) === false ) {\n\n\t\t\t\t\t// if there are animations but no clips, we create a default clip for playback\n\n\t\t\t\t\tconst tracks = [];\n\n\t\t\t\t\tfor ( const id in library.animations ) {\n\n\t\t\t\t\t\tconst animationTracks = getAnimation( id );\n\n\t\t\t\t\t\tfor ( let i = 0, l = animationTracks.length; i < l; i ++ ) {\n\n\t\t\t\t\t\t\ttracks.push( animationTracks[ i ] );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tanimations.push( new AnimationClip( 'default', - 1, tracks ) );\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tfor ( const id in clips ) {\n\n\t\t\t\t\tanimations.push( getAnimationClip( id ) );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t// convert the parser error element into text with each child elements text\n\t\t// separated by new lines.\n\n\t\tfunction parserErrorToText( parserError ) {\n\n\t\t\tlet result = '';\n\t\t\tconst stack = [ parserError ];\n\n\t\t\twhile ( stack.length ) {\n\n\t\t\t\tconst node = stack.shift();\n\n\t\t\t\tif ( node.nodeType === Node.TEXT_NODE ) {\n\n\t\t\t\t\tresult += node.textContent;\n\n\t\t\t\t} else {\n\n\t\t\t\t\tresult += '\\n';\n\t\t\t\t\tstack.push.apply( stack, node.childNodes );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn result.trim();\n\n\t\t}\n\n\t\tif ( text.length === 0 ) {\n\n\t\t\treturn { scene: new Scene() };\n\n\t\t}\n\n\t\tconst xml = new DOMParser().parseFromString( text, 'application/xml' );\n\n\t\tconst collada = getElementsByTagName( xml, 'COLLADA' )[ 0 ];\n\n\t\tconst parserError = xml.getElementsByTagName( 'parsererror' )[ 0 ];\n\t\tif ( parserError !== undefined ) {\n\n\t\t\t// Chrome will return parser error with a div in it\n\n\t\t\tconst errorElement = getElementsByTagName( parserError, 'div' )[ 0 ];\n\t\t\tlet errorText;\n\n\t\t\tif ( errorElement ) {\n\n\t\t\t\terrorText = errorElement.textContent;\n\n\t\t\t} else {\n\n\t\t\t\terrorText = parserErrorToText( parserError );\n\n\t\t\t}\n\n\t\t\tconsole.error( 'THREE.ColladaLoader: Failed to parse collada file.\\n', errorText );\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// metadata\n\n\t\tconst version = collada.getAttribute( 'version' );\n\t\tconsole.log( 'THREE.ColladaLoader: File version', version );\n\n\t\tconst asset = parseAsset( getElementsByTagName( collada, 'asset' )[ 0 ] );\n\t\tconst textureLoader = new TextureLoader( this.manager );\n\t\ttextureLoader.setPath( this.resourcePath || path ).setCrossOrigin( this.crossOrigin );\n\n\t\tlet tgaLoader;\n\n\t\tif ( TGALoader ) {\n\n\t\t\ttgaLoader = new TGALoader( this.manager );\n\t\t\ttgaLoader.setPath( this.resourcePath || path );\n\n\t\t}\n\n\t\t//\n\n\t\tconst tempColor = new Color();\n\t\tconst animations = [];\n\t\tlet kinematics = {};\n\t\tlet count = 0;\n\n\t\t//\n\n\t\tconst library = {\n\t\t\tanimations: {},\n\t\t\tclips: {},\n\t\t\tcontrollers: {},\n\t\t\timages: {},\n\t\t\teffects: {},\n\t\t\tmaterials: {},\n\t\t\tcameras: {},\n\t\t\tlights: {},\n\t\t\tgeometries: {},\n\t\t\tnodes: {},\n\t\t\tvisualScenes: {},\n\t\t\tkinematicsModels: {},\n\t\t\tphysicsModels: {},\n\t\t\tkinematicsScenes: {}\n\t\t};\n\n\t\tparseLibrary( collada, 'library_animations', 'animation', parseAnimation );\n\t\tparseLibrary( collada, 'library_animation_clips', 'animation_clip', parseAnimationClip );\n\t\tparseLibrary( collada, 'library_controllers', 'controller', parseController );\n\t\tparseLibrary( collada, 'library_images', 'image', parseImage );\n\t\tparseLibrary( collada, 'library_effects', 'effect', parseEffect );\n\t\tparseLibrary( collada, 'library_materials', 'material', parseMaterial );\n\t\tparseLibrary( collada, 'library_cameras', 'camera', parseCamera );\n\t\tparseLibrary( collada, 'library_lights', 'light', parseLight );\n\t\tparseLibrary( collada, 'library_geometries', 'geometry', parseGeometry );\n\t\tparseLibrary( collada, 'library_nodes', 'node', parseNode );\n\t\tparseLibrary( collada, 'library_visual_scenes', 'visual_scene', parseVisualScene );\n\t\tparseLibrary( collada, 'library_kinematics_models', 'kinematics_model', parseKinematicsModel );\n\t\tparseLibrary( collada, 'library_physics_models', 'physics_model', parsePhysicsModel );\n\t\tparseLibrary( collada, 'scene', 'instance_kinematics_scene', parseKinematicsScene );\n\n\t\tbuildLibrary( library.animations, buildAnimation );\n\t\tbuildLibrary( library.clips, buildAnimationClip );\n\t\tbuildLibrary( library.controllers, buildController );\n\t\tbuildLibrary( library.images, buildImage );\n\t\tbuildLibrary( library.effects, buildEffect );\n\t\tbuildLibrary( library.materials, buildMaterial );\n\t\tbuildLibrary( library.cameras, buildCamera );\n\t\tbuildLibrary( library.lights, buildLight );\n\t\tbuildLibrary( library.geometries, buildGeometry );\n\t\tbuildLibrary( library.visualScenes, buildVisualScene );\n\n\t\tsetupAnimations();\n\t\tsetupKinematics();\n\n\t\tconst scene = parseScene( getElementsByTagName( collada, 'scene' )[ 0 ] );\n\t\tscene.animations = animations;\n\n\t\tif ( asset.upAxis === 'Z_UP' ) {\n\n\t\t\tscene.quaternion.setFromEuler( new Euler( - Math.PI / 2, 0, 0 ) );\n\n\t\t}\n\n\t\tscene.scale.multiplyScalar( asset.unit );\n\n\t\treturn {\n\t\t\tget animations() {\n\n\t\t\t\tconsole.warn( 'THREE.ColladaLoader: Please access animations over scene.animations now.' );\n\t\t\t\treturn animations;\n\n\t\t\t},\n\t\t\tkinematics: kinematics,\n\t\t\tlibrary: library,\n\t\t\tscene: scene\n\t\t};\n\n\t}\n\n}\n\nexport { ColladaLoader };\n","import {\n\tDataTextureLoader,\n\tLinearMipmapLinearFilter\n} from 'three';\n\nclass TGALoader extends DataTextureLoader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t}\n\n\tparse( buffer ) {\n\n\t\t// reference from vthibault, https://github.com/vthibault/roBrowser/blob/master/src/Loaders/Targa.js\n\n\t\tfunction tgaCheckHeader( header ) {\n\n\t\t\tswitch ( header.image_type ) {\n\n\t\t\t\t// check indexed type\n\n\t\t\t\tcase TGA_TYPE_INDEXED:\n\t\t\t\tcase TGA_TYPE_RLE_INDEXED:\n\t\t\t\t\tif ( header.colormap_length > 256 || header.colormap_size !== 24 || header.colormap_type !== 1 ) {\n\n\t\t\t\t\t\tconsole.error( 'THREE.TGALoader: Invalid type colormap data for indexed type.' );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\t\t// check colormap type\n\n\t\t\t\tcase TGA_TYPE_RGB:\n\t\t\t\tcase TGA_TYPE_GREY:\n\t\t\t\tcase TGA_TYPE_RLE_RGB:\n\t\t\t\tcase TGA_TYPE_RLE_GREY:\n\t\t\t\t\tif ( header.colormap_type ) {\n\n\t\t\t\t\t\tconsole.error( 'THREE.TGALoader: Invalid type colormap data for colormap type.' );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t\t\t// What the need of a file without data ?\n\n\t\t\t\tcase TGA_TYPE_NO_DATA:\n\t\t\t\t\tconsole.error( 'THREE.TGALoader: No data.' );\n\n\t\t\t\t\t// Invalid type ?\n\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.error( 'THREE.TGALoader: Invalid type \"%s\".', header.image_type );\n\n\t\t\t}\n\n\t\t\t// check image width and height\n\n\t\t\tif ( header.width <= 0 || header.height <= 0 ) {\n\n\t\t\t\tconsole.error( 'THREE.TGALoader: Invalid image size.' );\n\n\t\t\t}\n\n\t\t\t// check image pixel size\n\n\t\t\tif ( header.pixel_size !== 8 && header.pixel_size !== 16 &&\n\t\t\t\theader.pixel_size !== 24 && header.pixel_size !== 32 ) {\n\n\t\t\t\tconsole.error( 'THREE.TGALoader: Invalid pixel size \"%s\".', header.pixel_size );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// parse tga image buffer\n\n\t\tfunction tgaParse( use_rle, use_pal, header, offset, data ) {\n\n\t\t\tlet pixel_data,\n\t\t\t\tpalettes;\n\n\t\t\tconst pixel_size = header.pixel_size >> 3;\n\t\t\tconst pixel_total = header.width * header.height * pixel_size;\n\n\t\t\t // read palettes\n\n\t\t\t if ( use_pal ) {\n\n\t\t\t\t palettes = data.subarray( offset, offset += header.colormap_length * ( header.colormap_size >> 3 ) );\n\n\t\t\t }\n\n\t\t\t // read RLE\n\n\t\t\t if ( use_rle ) {\n\n\t\t\t\t pixel_data = new Uint8Array( pixel_total );\n\n\t\t\t\tlet c, count, i;\n\t\t\t\tlet shift = 0;\n\t\t\t\tconst pixels = new Uint8Array( pixel_size );\n\n\t\t\t\twhile ( shift < pixel_total ) {\n\n\t\t\t\t\tc = data[ offset ++ ];\n\t\t\t\t\tcount = ( c & 0x7f ) + 1;\n\n\t\t\t\t\t// RLE pixels\n\n\t\t\t\t\tif ( c & 0x80 ) {\n\n\t\t\t\t\t\t// bind pixel tmp array\n\n\t\t\t\t\t\tfor ( i = 0; i < pixel_size; ++ i ) {\n\n\t\t\t\t\t\t\tpixels[ i ] = data[ offset ++ ];\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// copy pixel array\n\n\t\t\t\t\t\tfor ( i = 0; i < count; ++ i ) {\n\n\t\t\t\t\t\t\tpixel_data.set( pixels, shift + i * pixel_size );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tshift += pixel_size * count;\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\t// raw pixels\n\n\t\t\t\t\t\tcount *= pixel_size;\n\n\t\t\t\t\t\tfor ( i = 0; i < count; ++ i ) {\n\n\t\t\t\t\t\t\tpixel_data[ shift + i ] = data[ offset ++ ];\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tshift += count;\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t } else {\n\n\t\t\t\t// raw pixels\n\n\t\t\t\tpixel_data = data.subarray(\n\t\t\t\t\t offset, offset += ( use_pal ? header.width * header.height : pixel_total )\n\t\t\t\t);\n\n\t\t\t }\n\n\t\t\t return {\n\t\t\t\tpixel_data: pixel_data,\n\t\t\t\tpalettes: palettes\n\t\t\t };\n\n\t\t}\n\n\t\tfunction tgaGetImageData8bits( imageData, y_start, y_step, y_end, x_start, x_step, x_end, image, palettes ) {\n\n\t\t\tconst colormap = palettes;\n\t\t\tlet color, i = 0, x, y;\n\t\t\tconst width = header.width;\n\n\t\t\tfor ( y = y_start; y !== y_end; y += y_step ) {\n\n\t\t\t\tfor ( x = x_start; x !== x_end; x += x_step, i ++ ) {\n\n\t\t\t\t\tcolor = image[ i ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 3 ] = 255;\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 2 ] = colormap[ ( color * 3 ) + 0 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 1 ] = colormap[ ( color * 3 ) + 1 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 0 ] = colormap[ ( color * 3 ) + 2 ];\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn imageData;\n\n\t\t}\n\n\t\tfunction tgaGetImageData16bits( imageData, y_start, y_step, y_end, x_start, x_step, x_end, image ) {\n\n\t\t\tlet color, i = 0, x, y;\n\t\t\tconst width = header.width;\n\n\t\t\tfor ( y = y_start; y !== y_end; y += y_step ) {\n\n\t\t\t\tfor ( x = x_start; x !== x_end; x += x_step, i += 2 ) {\n\n\t\t\t\t\tcolor = image[ i + 0 ] + ( image[ i + 1 ] << 8 );\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 0 ] = ( color & 0x7C00 ) >> 7;\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 1 ] = ( color & 0x03E0 ) >> 2;\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 2 ] = ( color & 0x001F ) << 3;\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 3 ] = ( color & 0x8000 ) ? 0 : 255;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn imageData;\n\n\t\t}\n\n\t\tfunction tgaGetImageData24bits( imageData, y_start, y_step, y_end, x_start, x_step, x_end, image ) {\n\n\t\t\tlet i = 0, x, y;\n\t\t\tconst width = header.width;\n\n\t\t\tfor ( y = y_start; y !== y_end; y += y_step ) {\n\n\t\t\t\tfor ( x = x_start; x !== x_end; x += x_step, i += 3 ) {\n\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 3 ] = 255;\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 2 ] = image[ i + 0 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 1 ] = image[ i + 1 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 0 ] = image[ i + 2 ];\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn imageData;\n\n\t\t}\n\n\t\tfunction tgaGetImageData32bits( imageData, y_start, y_step, y_end, x_start, x_step, x_end, image ) {\n\n\t\t\tlet i = 0, x, y;\n\t\t\tconst width = header.width;\n\n\t\t\tfor ( y = y_start; y !== y_end; y += y_step ) {\n\n\t\t\t\tfor ( x = x_start; x !== x_end; x += x_step, i += 4 ) {\n\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 2 ] = image[ i + 0 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 1 ] = image[ i + 1 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 0 ] = image[ i + 2 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 3 ] = image[ i + 3 ];\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn imageData;\n\n\t\t}\n\n\t\tfunction tgaGetImageDataGrey8bits( imageData, y_start, y_step, y_end, x_start, x_step, x_end, image ) {\n\n\t\t\tlet color, i = 0, x, y;\n\t\t\tconst width = header.width;\n\n\t\t\tfor ( y = y_start; y !== y_end; y += y_step ) {\n\n\t\t\t\tfor ( x = x_start; x !== x_end; x += x_step, i ++ ) {\n\n\t\t\t\t\tcolor = image[ i ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 0 ] = color;\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 1 ] = color;\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 2 ] = color;\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 3 ] = 255;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn imageData;\n\n\t\t}\n\n\t\tfunction tgaGetImageDataGrey16bits( imageData, y_start, y_step, y_end, x_start, x_step, x_end, image ) {\n\n\t\t\tlet i = 0, x, y;\n\t\t\tconst width = header.width;\n\n\t\t\tfor ( y = y_start; y !== y_end; y += y_step ) {\n\n\t\t\t\tfor ( x = x_start; x !== x_end; x += x_step, i += 2 ) {\n\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 0 ] = image[ i + 0 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 1 ] = image[ i + 0 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 2 ] = image[ i + 0 ];\n\t\t\t\t\timageData[ ( x + width * y ) * 4 + 3 ] = image[ i + 1 ];\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn imageData;\n\n\t\t}\n\n\t\tfunction getTgaRGBA( data, width, height, image, palette ) {\n\n\t\t\tlet x_start,\n\t\t\t\ty_start,\n\t\t\t\tx_step,\n\t\t\t\ty_step,\n\t\t\t\tx_end,\n\t\t\t\ty_end;\n\n\t\t\tswitch ( ( header.flags & TGA_ORIGIN_MASK ) >> TGA_ORIGIN_SHIFT ) {\n\n\t\t\t\tdefault:\n\t\t\t\tcase TGA_ORIGIN_UL:\n\t\t\t\t\tx_start = 0;\n\t\t\t\t\tx_step = 1;\n\t\t\t\t\tx_end = width;\n\t\t\t\t\ty_start = 0;\n\t\t\t\t\ty_step = 1;\n\t\t\t\t\ty_end = height;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase TGA_ORIGIN_BL:\n\t\t\t\t\tx_start = 0;\n\t\t\t\t\tx_step = 1;\n\t\t\t\t\tx_end = width;\n\t\t\t\t\ty_start = height - 1;\n\t\t\t\t\ty_step = - 1;\n\t\t\t\t\ty_end = - 1;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase TGA_ORIGIN_UR:\n\t\t\t\t\tx_start = width - 1;\n\t\t\t\t\tx_step = - 1;\n\t\t\t\t\tx_end = - 1;\n\t\t\t\t\ty_start = 0;\n\t\t\t\t\ty_step = 1;\n\t\t\t\t\ty_end = height;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase TGA_ORIGIN_BR:\n\t\t\t\t\tx_start = width - 1;\n\t\t\t\t\tx_step = - 1;\n\t\t\t\t\tx_end = - 1;\n\t\t\t\t\ty_start = height - 1;\n\t\t\t\t\ty_step = - 1;\n\t\t\t\t\ty_end = - 1;\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tif ( use_grey ) {\n\n\t\t\t\tswitch ( header.pixel_size ) {\n\n\t\t\t\t\tcase 8:\n\t\t\t\t\t\ttgaGetImageDataGrey8bits( data, y_start, y_step, y_end, x_start, x_step, x_end, image );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 16:\n\t\t\t\t\t\ttgaGetImageDataGrey16bits( data, y_start, y_step, y_end, x_start, x_step, x_end, image );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tconsole.error( 'THREE.TGALoader: Format not supported.' );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\tswitch ( header.pixel_size ) {\n\n\t\t\t\t\tcase 8:\n\t\t\t\t\t\ttgaGetImageData8bits( data, y_start, y_step, y_end, x_start, x_step, x_end, image, palette );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 16:\n\t\t\t\t\t\ttgaGetImageData16bits( data, y_start, y_step, y_end, x_start, x_step, x_end, image );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 24:\n\t\t\t\t\t\ttgaGetImageData24bits( data, y_start, y_step, y_end, x_start, x_step, x_end, image );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase 32:\n\t\t\t\t\t\ttgaGetImageData32bits( data, y_start, y_step, y_end, x_start, x_step, x_end, image );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tconsole.error( 'THREE.TGALoader: Format not supported.' );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// Load image data according to specific method\n\t\t\t// let func = 'tgaGetImageData' + (use_grey ? 'Grey' : '') + (header.pixel_size) + 'bits';\n\t\t\t// func(data, y_start, y_step, y_end, x_start, x_step, x_end, width, image, palette );\n\t\t\treturn data;\n\n\t\t}\n\n\t\t// TGA constants\n\n\t\tconst TGA_TYPE_NO_DATA = 0,\n\t\t\tTGA_TYPE_INDEXED = 1,\n\t\t\tTGA_TYPE_RGB = 2,\n\t\t\tTGA_TYPE_GREY = 3,\n\t\t\tTGA_TYPE_RLE_INDEXED = 9,\n\t\t\tTGA_TYPE_RLE_RGB = 10,\n\t\t\tTGA_TYPE_RLE_GREY = 11,\n\n\t\t\tTGA_ORIGIN_MASK = 0x30,\n\t\t\tTGA_ORIGIN_SHIFT = 0x04,\n\t\t\tTGA_ORIGIN_BL = 0x00,\n\t\t\tTGA_ORIGIN_BR = 0x01,\n\t\t\tTGA_ORIGIN_UL = 0x02,\n\t\t\tTGA_ORIGIN_UR = 0x03;\n\n\t\tif ( buffer.length < 19 ) console.error( 'THREE.TGALoader: Not enough data to contain header.' );\n\n\t\tlet offset = 0;\n\n\t\tconst content = new Uint8Array( buffer ),\n\t\t\theader = {\n\t\t\t\tid_length: content[ offset ++ ],\n\t\t\t\tcolormap_type: content[ offset ++ ],\n\t\t\t\timage_type: content[ offset ++ ],\n\t\t\t\tcolormap_index: content[ offset ++ ] | content[ offset ++ ] << 8,\n\t\t\t\tcolormap_length: content[ offset ++ ] | content[ offset ++ ] << 8,\n\t\t\t\tcolormap_size: content[ offset ++ ],\n\t\t\t\torigin: [\n\t\t\t\t\tcontent[ offset ++ ] | content[ offset ++ ] << 8,\n\t\t\t\t\tcontent[ offset ++ ] | content[ offset ++ ] << 8\n\t\t\t\t],\n\t\t\t\twidth: content[ offset ++ ] | content[ offset ++ ] << 8,\n\t\t\t\theight: content[ offset ++ ] | content[ offset ++ ] << 8,\n\t\t\t\tpixel_size: content[ offset ++ ],\n\t\t\t\tflags: content[ offset ++ ]\n\t\t\t};\n\n\t\t// check tga if it is valid format\n\n\t\ttgaCheckHeader( header );\n\n\t\tif ( header.id_length + offset > buffer.length ) {\n\n\t\t\tconsole.error( 'THREE.TGALoader: No data.' );\n\n\t\t}\n\n\t\t// skip the needn't data\n\n\t\toffset += header.id_length;\n\n\t\t// get targa information about RLE compression and palette\n\n\t\tlet use_rle = false,\n\t\t\tuse_pal = false,\n\t\t\tuse_grey = false;\n\n\t\tswitch ( header.image_type ) {\n\n\t\t\tcase TGA_TYPE_RLE_INDEXED:\n\t\t\t\tuse_rle = true;\n\t\t\t\tuse_pal = true;\n\t\t\t\tbreak;\n\n\t\t\tcase TGA_TYPE_INDEXED:\n\t\t\t\tuse_pal = true;\n\t\t\t\tbreak;\n\n\t\t\tcase TGA_TYPE_RLE_RGB:\n\t\t\t\tuse_rle = true;\n\t\t\t\tbreak;\n\n\t\t\tcase TGA_TYPE_RGB:\n\t\t\t\tbreak;\n\n\t\t\tcase TGA_TYPE_RLE_GREY:\n\t\t\t\tuse_rle = true;\n\t\t\t\tuse_grey = true;\n\t\t\t\tbreak;\n\n\t\t\tcase TGA_TYPE_GREY:\n\t\t\t\tuse_grey = true;\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\t//\n\n\t\tconst imageData = new Uint8Array( header.width * header.height * 4 );\n\t\tconst result = tgaParse( use_rle, use_pal, header, offset, content );\n\t\tgetTgaRGBA( imageData, header.width, header.height, result.pixel_data, result.palettes );\n\n\t\treturn {\n\n\t\t\tdata: imageData,\n\t\t\twidth: header.width,\n\t\t\theight: header.height,\n\t\t\tflipY: true,\n\t\t\tgenerateMipmaps: true,\n\t\t\tminFilter: LinearMipmapLinearFilter,\n\n\t\t};\n\n\t}\n\n}\n\nexport { TGALoader };\n","import { Object3D } from 'three';\r\n\r\nclass URDFBase extends Object3D {\r\n\r\n    constructor(...args) {\r\n\r\n        super(...args);\r\n        this.urdfNode = null;\r\n        this.urdfName = '';\r\n\r\n    }\r\n\r\n    copy(source, recursive) {\r\n\r\n        super.copy(source, recursive);\r\n\r\n        this.urdfNode = source.urdfNode;\r\n        this.urdfName = source.urdfName;\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n}\r\n\r\nclass URDFCollider extends URDFBase {\r\n\r\n    constructor(...args) {\r\n\r\n        super(...args);\r\n        this.isURDFCollider = true;\r\n        this.type = 'URDFCollider';\r\n\r\n    }\r\n\r\n}\r\n\r\nclass URDFVisual extends URDFBase {\r\n\r\n    constructor(...args) {\r\n\r\n        super(...args);\r\n        this.isURDFVisual = true;\r\n        this.type = 'URDFVisual';\r\n\r\n    }\r\n\r\n}\r\n\r\nclass URDFLink extends URDFBase {\r\n\r\n    constructor(...args) {\r\n\r\n        super(...args);\r\n        this.isURDFLink = true;\r\n        this.type = 'URDFLink';\r\n\r\n    }\r\n\r\n}\r\n\r\nclass URDFJoint extends URDFBase {\r\n\r\n    get jointType() {\r\n\r\n        return this._jointType;\r\n\r\n    }\r\n\r\n    set jointType(v) {\r\n\r\n        if (this.jointType === v) return;\r\n        this._jointType = v;\r\n        this.matrixWorldNeedsUpdate = true;\r\n        switch (v) {\r\n\r\n            case 'fixed':\r\n                this.jointValue = [];\r\n                break;\r\n\r\n            case 'continuous':\r\n            case 'revolute':\r\n            case 'prismatic':\r\n                this.jointValue = new Array(1).fill(0);\r\n                break;\r\n\r\n            case 'planar':\r\n                this.jointValue = new Array(2).fill(0);\r\n                break;\r\n\r\n            case 'floating':\r\n                this.jointValue = new Array(6).fill(0);\r\n                break;\r\n\r\n        }\r\n\r\n    }\r\n\r\n    get angle() {\r\n\r\n        return this.jointValue[0];\r\n\r\n    }\r\n\r\n    constructor(...args) {\r\n\r\n        super(...args);\r\n\r\n        this.isURDFJoint = true;\r\n        this.type = 'URDFJoint';\r\n\r\n        this.jointValue = null;\r\n        this.jointType = 'fixed';\r\n        this.axis = null;\r\n        this.limit = { lower: 0, upper: 0 };\r\n        this.ignoreLimits = false;\r\n\r\n        this.origPosition = null;\r\n        this.origQuaternion = null;\r\n\r\n        this.mimicJoints = [];\r\n\r\n    }\r\n\r\n    /* Overrides */\r\n    copy(source, recursive) {\r\n\r\n        super.copy(source, recursive);\r\n\r\n        this.jointType = source.jointType;\r\n        this.axis = source.axis ? source.axis.clone() : null;\r\n        this.limit.lower = source.limit.lower;\r\n        this.limit.upper = source.limit.upper;\r\n        this.ignoreLimits = false;\r\n\r\n        this.jointValue = [...source.jointValue];\r\n\r\n        this.origPosition = source.origPosition ? source.origPosition.clone() : null;\r\n        this.origQuaternion = source.origQuaternion ? source.origQuaternion.clone() : null;\r\n\r\n        this.mimicJoints = [...source.mimicJoints];\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n    /* Public Functions */\r\n    setJointValue(...values) {\r\n\r\n        values = values.map(v => parseFloat(v));\r\n\r\n        if (!this.origPosition || !this.origQuaternion) {\r\n\r\n            this.origPosition = this.position.clone();\r\n            this.origQuaternion = this.quaternion.clone();\r\n\r\n        }\r\n\r\n        let didUpdate = false;\r\n\r\n        this.mimicJoints.forEach(joint => {\r\n\r\n            didUpdate = joint.updateFromMimickedJoint(...values) || didUpdate;\r\n\r\n        });\r\n\r\n        switch (this.jointType) {\r\n\r\n            case 'fixed': {\r\n\r\n                return didUpdate;\r\n\r\n            }\r\n            case 'continuous':\r\n            case 'revolute': {\r\n\r\n                let angle = values[0];\r\n                if (angle == null) return didUpdate;\r\n                if (angle === this.jointValue[0]) return didUpdate;\r\n\r\n                if (!this.ignoreLimits && this.jointType === 'revolute') {\r\n\r\n                    angle = Math.min(this.limit.upper, angle);\r\n                    angle = Math.max(this.limit.lower, angle);\r\n\r\n                }\r\n\r\n                this.quaternion\r\n                    .setFromAxisAngle(this.axis, angle)\r\n                    .premultiply(this.origQuaternion);\r\n\r\n                if (this.jointValue[0] !== angle) {\r\n\r\n                    this.jointValue[0] = angle;\r\n                    this.matrixWorldNeedsUpdate = true;\r\n                    return true;\r\n\r\n                } else {\r\n\r\n                    return didUpdate;\r\n\r\n                }\r\n\r\n            }\r\n\r\n            case 'prismatic': {\r\n\r\n                let pos = values[0];\r\n                if (pos == null) return didUpdate;\r\n                if (pos === this.jointValue[0]) return didUpdate;\r\n\r\n                if (!this.ignoreLimits) {\r\n\r\n                    pos = Math.min(this.limit.upper, pos);\r\n                    pos = Math.max(this.limit.lower, pos);\r\n\r\n                }\r\n\r\n                this.position.copy(this.origPosition);\r\n                this.position.addScaledVector(this.axis, pos);\r\n\r\n                if (this.jointValue[0] !== pos) {\r\n\r\n                    this.jointValue[0] = pos;\r\n                    this.matrixWorldNeedsUpdate = true;\r\n                    return true;\r\n\r\n                } else {\r\n\r\n                    return didUpdate;\r\n\r\n                }\r\n\r\n            }\r\n\r\n            case 'floating':\r\n            case 'planar':\r\n                // TODO: Support these joint types\r\n                console.warn(`'${ this.jointType }' joint not yet supported`);\r\n\r\n        }\r\n\r\n        return didUpdate;\r\n\r\n    }\r\n\r\n}\r\n\r\nclass URDFMimicJoint extends URDFJoint {\r\n\r\n    constructor(...args) {\r\n\r\n        super(...args);\r\n        this.type = 'URDFMimicJoint';\r\n        this.mimicJoint = null;\r\n        this.offset = 0;\r\n        this.multiplier = 1;\r\n\r\n    }\r\n\r\n    updateFromMimickedJoint(...values) {\r\n\r\n        const modifiedValues = values.map(x => x * this.multiplier + this.offset);\r\n        return super.setJointValue(...modifiedValues);\r\n\r\n    }\r\n\r\n    /* Overrides */\r\n    setJointValue(...values) {\r\n\r\n        console.warn(`URDFMimicJoint: Setting the joint value of mimic joint \"${ this.urdfName }\" will cause it to be out of sync.`);\r\n        return super.setJointValue(...values);\r\n    }\r\n\r\n    /* Overrides */\r\n    copy(source, recursive) {\r\n\r\n        super.copy(source, recursive);\r\n\r\n        this.mimicJoint = source.mimicJoint;\r\n        this.offset = source.offset;\r\n        this.multiplier = source.multiplier;\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n}\r\n\r\nclass URDFRobot extends URDFLink {\r\n\r\n    constructor(...args) {\r\n\r\n        super(...args);\r\n        this.isURDFRobot = true;\r\n        this.urdfNode = null;\r\n\r\n        this.urdfRobotNode = null;\r\n        this.robotName = null;\r\n\r\n        this.links = null;\r\n        this.joints = null;\r\n        this.colliders = null;\r\n        this.visual = null;\r\n        this.frames = null;\r\n\r\n    }\r\n\r\n    copy(source, recursive) {\r\n\r\n        super.copy(source, recursive);\r\n\r\n        this.urdfRobotNode = source.urdfRobotNode;\r\n        this.robotName = source.robotName;\r\n\r\n        this.links = {};\r\n        this.joints = {};\r\n        this.colliders = {};\r\n        this.visual = {};\r\n\r\n        this.traverse(c => {\r\n\r\n            if (c.isURDFJoint && c.urdfName in source.joints) {\r\n\r\n                this.joints[c.urdfName] = c;\r\n\r\n            }\r\n\r\n            if (c.isURDFLink && c.urdfName in source.links) {\r\n\r\n                this.links[c.urdfName] = c;\r\n\r\n            }\r\n\r\n            if (c.isURDFCollider && c.urdfName in source.colliders) {\r\n\r\n                this.colliders[c.urdfName] = c;\r\n\r\n            }\r\n\r\n            if (c.isURDFVisual && c.urdfName in source.visual) {\r\n\r\n                this.visual[c.urdfName] = c;\r\n\r\n            }\r\n\r\n        });\r\n\r\n        this.frames = {\r\n            ...this.colliders,\r\n            ...this.visual,\r\n            ...this.links,\r\n            ...this.joints,\r\n        };\r\n\r\n        return this;\r\n\r\n    }\r\n\r\n    getFrame(name) {\r\n\r\n        return this.frames[name];\r\n\r\n    }\r\n\r\n    setJointValue(jointName, ...angle) {\r\n\r\n        const joint = this.joints[jointName];\r\n        if (joint) {\r\n\r\n            return joint.setJointValue(...angle);\r\n\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    setJointValues(values) {\r\n\r\n        let didChange = false;\r\n        for (const name in values) {\r\n\r\n            const value = values[name];\r\n            if (Array.isArray(value)) {\r\n\r\n                didChange = this.setJointValue(name, ...value) || didChange;\r\n\r\n            } else {\r\n\r\n                didChange = this.setJointValue(name, value) || didChange;\r\n\r\n            }\r\n\r\n        }\r\n\r\n        return didChange;\r\n\r\n    }\r\n\r\n}\r\n\r\nexport { URDFRobot, URDFLink, URDFJoint, URDFMimicJoint, URDFVisual, URDFCollider };\r\n","import { getUrlBase } from './utils.js';\r\nimport { XacroParser } from './XacroParser.js';\r\n\r\nexport class XacroLoader extends XacroParser {\r\n\r\n    constructor() {\r\n\r\n        super();\r\n        this.fetchOptions = {};\r\n\r\n    }\r\n\r\n    load(url, onComplete, onError) {\r\n\r\n        const workingPath = getUrlBase(url);\r\n        if (this.workingPath === '') {\r\n\r\n            this.workingPath = workingPath;\r\n\r\n        }\r\n\r\n        this\r\n            .getFileContents(url)\r\n            .then(text => {\r\n\r\n                this.parse(text, onComplete, onError);\r\n\r\n            })\r\n            .catch(e => {\r\n\r\n                if (onError) {\r\n\r\n                    onError(e);\r\n\r\n                }\r\n\r\n            });\r\n\r\n    }\r\n\r\n    parse(data, onComplete, onError) {\r\n\r\n        super\r\n            .parse(data)\r\n            .then(onComplete)\r\n            .catch(e => {\r\n\r\n                if (onError) {\r\n\r\n                    onError(e);\r\n\r\n                }\r\n\r\n            });\r\n\r\n    }\r\n\r\n    getFileContents(path) {\r\n\r\n        return fetch(path, this.fetchOptions)\r\n            .then(res => {\r\n\r\n                if (res.ok) {\r\n\r\n                    return res.text();\r\n\r\n                } else {\r\n\r\n                    throw new Error(`XacroLoader: Failed to load url '${ path }' with error code ${ res.status } : ${ res.statusText }.`);\r\n\r\n                }\r\n\r\n            });\r\n\r\n    }\r\n\r\n}\r\n","\r\nexport function getUrlBase(url) {\r\n    const tokens = url.split(/[\\\\/]/g);\r\n    tokens.pop();\r\n    if (tokens.length === 0) {\r\n        return './';\r\n    } else {\r\n        return tokens.join('/') + '/';\r\n    }\r\n}\r\n\r\n// XML Helpers\r\n// QuerySelectorAll that respects tag prefixes like 'xacro:'\r\nexport function getElementsWithName(node, name, res = []) {\r\n    if (node.tagName === name) {\r\n        res.push(node);\r\n    }\r\n    for (let i = 0, l = node.children.length; i < l; i++) {\r\n        const child = node.children[i];\r\n        getElementsWithName(child, name, res);\r\n    }\r\n    return res;\r\n}\r\n\r\n// Deep clone an xml node without the macro or property tags.\r\nexport function deepClone(node, stripPropsMacros) {\r\n    const cloned = node.cloneNode();\r\n    const childNodes = node.childNodes;\r\n    for (let i = 0, l = childNodes.length; i < l; i++) {\r\n        const child = childNodes[i];\r\n        const tagName = child.tagName;\r\n        if (!stripPropsMacros || (tagName !== 'xacro:property' && tagName !== 'xacro:macro')) {\r\n            cloned.appendChild(deepClone(child, stripPropsMacros));\r\n        }\r\n    }\r\n    return cloned;\r\n}\r\n\r\n// Takes an array of xml elements and removes the last elements that\r\n// are comments or newlines.\r\nexport function removeEndCommentsFromArray(arr) {\r\n    while (arr.length > 0) {\r\n        const el = arr[arr.length - 1];\r\n        if (el.nodeType !== el.ELEMENT_NODE) {\r\n            arr.pop();\r\n        } else {\r\n            break;\r\n        }\r\n    }\r\n}\r\n\r\n// Expression helpers\r\nexport function isOperator(str) {\r\n    const regexp = /^[()/*+\\-%|&=[\\]]+$/;\r\n    return regexp.test(str);\r\n}\r\n\r\nexport function isString(str) {\r\n    const regexp = /^(('[^']*?')|(\"[^\"]*?\")|(`[^`]*?`))$/;\r\n    return regexp.test(str);\r\n}\r\n\r\n// TODO: make this more robust\r\nexport function isNumber(str) {\r\n    return !isNaN(parseFloat(str)) && !/[^0-9.eE-]/.test(str);\r\n}\r\n\r\n// TODO: this needs to tokenize numbers together\r\nexport function tokenize(str) {\r\n    const regexp = /(('[^']*?')|(\"[^\"]*?\")|(`[^`]*?`)|([()/*+\\-%|&=[\\]]+))/g;\r\n    return str\r\n        .replace(regexp, m => ` ${ m } `)\r\n        .trim()\r\n        .split(/\\s+/g);\r\n}\r\n\r\nexport function normalizeExpression(str) {\r\n    // Remove any instances of \"--\" or \"++\" that might occur from negating a negative number\r\n    // by adding a space that are not in a string.\r\n    return str.replace(/[-+]{2,}/, val => {\r\n        let positive = true;\r\n        for (let i = 0, l = val.length; i < l; i++) {\r\n            const operator = val[i];\r\n            if (operator === '-') {\r\n                positive = !positive;\r\n            }\r\n        }\r\n\r\n        return positive ? '+' : '-';\r\n    });\r\n}\r\n\r\n// Property Set Helpers\r\nexport const PARENT_SCOPE = Symbol('parent');\r\n\r\n// merges a set of properties together into a single set retaining\r\n// the parent scope link as well.\r\nexport function mergePropertySets(...args) {\r\n    const res = {};\r\n    for (let i = 0, l = args.length; i < l; i++) {\r\n        const obj = args[i];\r\n        for (const key in obj) {\r\n            res[key] = obj[key];\r\n        }\r\n        if (PARENT_SCOPE in obj) {\r\n            res[PARENT_SCOPE] = obj[PARENT_SCOPE];\r\n        }\r\n    }\r\n    return res;\r\n}\r\n\r\n// Copies a property set and creates a link to the original set as a parent scope\r\nexport function createNewPropertyScope(properties) {\r\n    const res = mergePropertySets(properties);\r\n    res[PARENT_SCOPE] = properties;\r\n    return res;\r\n}\r\n","import {\r\n    getUrlBase,\r\n    removeEndCommentsFromArray,\r\n    getElementsWithName,\r\n    deepClone,\r\n    isOperator,\r\n    isString,\r\n    isNumber,\r\n    normalizeExpression,\r\n    tokenize,\r\n    mergePropertySets,\r\n    createNewPropertyScope,\r\n    PARENT_SCOPE,\r\n} from './utils.js';\r\nimport { evaluateExpression } from './evaluateExpression.js';\r\n\r\nexport class XacroParser {\r\n\r\n    constructor() {\r\n        this.inOrder = true;\r\n        this.requirePrefix = true;\r\n        this.localProperties = true;\r\n        this.rospackCommands = {};\r\n        this.workingPath = '';\r\n    }\r\n\r\n    async getFileContents(path) {\r\n        throw new Error('XacroParser: getFileContents() not implemented.');\r\n    }\r\n\r\n    async parse(data) {\r\n\r\n        /* Evaluation */\r\n        // Evaluate expressions and rospack commands in attribute text\r\n        // TODO: expressions can basically be any python expression\r\n        function evaluateAttribute(str, properties, finalValue = false) {\r\n\r\n            // recursively unpack parameters\r\n            function unpackParams(str, properties) {\r\n\r\n                // if we're unpacking something that's already a number then just return\r\n                if (typeof str === 'number') {\r\n                    return str;\r\n                }\r\n\r\n                // process all of the ${} and $() expressions\r\n                const res = str.replace(/(\\$?\\$\\([^)]+\\))|(\\$?\\${[^}]+})/g, match => {\r\n\r\n                    // if we encounter an escaped $$ then return early\r\n                    if (/^\\$\\$/.test(match)) {\r\n                        return match;\r\n                    }\r\n\r\n                    const isRospackCommand = /^\\$\\(/.test(match);\r\n                    let contents = match.substring(2, match.length - 1);\r\n                    contents = unpackParams(contents, properties);\r\n\r\n                    if (isRospackCommand) {\r\n\r\n                        const command = unpackParams(contents, properties);\r\n                        const tokens = command.split(/\\s+/g);\r\n                        const stem = tokens.shift();\r\n\r\n                        try {\r\n                            return handleRospackCommand(stem, ...tokens);\r\n                        } catch (e) {\r\n                            throw new Error(`XacroParser: Cannot run rospack command \"${ contents }\".\\n` + e.message);\r\n                        }\r\n\r\n                    } else {\r\n                        if (stack.includes(contents)) {\r\n                            throw new Error(\r\n                                `XacroParser: Cannot evaluate infinitely recursive expression: ${\r\n                                    stack.join(' > ')\r\n                                } > ${\r\n                                    contents\r\n                                }`\r\n                            );\r\n                        }\r\n\r\n                        stack.push(contents);\r\n\r\n                        const operators = /(()|()|()|[()/*+\\-%|&=[\\]])+/g;\r\n                        const expr = tokenize(contents)\r\n                            .map(t => {\r\n                                operators.lastIndex = 0;\r\n                                if (isOperator(t)) return t;\r\n                                if (isNumber(t)) return t;\r\n                                if (isString(t)) return t;\r\n\r\n                                if (t in properties) {\r\n                                    const arg = unpackParams(properties[t], properties);\r\n                                    if (!isNumber(arg)) {\r\n                                        return `\"${ arg.toString().replace(/\\\\/g, '\\\\\\\\').replace(/\"/g, '\\\\\"') }\"`;\r\n                                    } else {\r\n                                        return arg;\r\n                                    }\r\n                                } else {\r\n                                    return t;\r\n                                }\r\n                            })\r\n                            .join('');\r\n\r\n                        stack.pop();\r\n\r\n                        if (isString(expr)) {\r\n                            return expr.substring(1, expr.length - 1);\r\n                        } else if (isNumber(expr)) {\r\n                            return expr;\r\n                        } else {\r\n                            const cleanExpr = normalizeExpression(expr);\r\n                            return handleExpressionEvaluation(cleanExpr);\r\n                        }\r\n                    }\r\n                });\r\n\r\n                return res;\r\n\r\n            }\r\n\r\n            const stack = [];\r\n            const allProps = mergePropertySets(globalProperties, properties);\r\n            try {\r\n                // fix the escaped dollar signs only at the end to prevent double evaluation and only\r\n                // if the value is not an intermediate value like a computed property.\r\n                let result = unpackParams(str, allProps);\r\n                if (finalValue) {\r\n                    result = result.replace(/\\${2}([({])/g, (val, brace) => `$${ brace }`);\r\n                }\r\n                return result;\r\n            } catch (e) {\r\n                throw new Error(`XacroParser: Failed to process expression \"${ str }\". \\n` + e.message);\r\n            }\r\n\r\n        }\r\n\r\n        // Evaluate the given node as a macro\r\n        async function evaluateMacro(node, properties, macros, resultsList) {\r\n\r\n            // Find the macro\r\n            const macroName = node.tagName.replace(/^xacro:/, '');\r\n            const macro = macros[macroName];\r\n\r\n            if (!macro) {\r\n                throw new Error(`XacroParser: Cannot find macro \"${ macroName }\"`);\r\n            }\r\n\r\n            // Copy the properties and macros so we can modify them with\r\n            // macro input fields and local macro definitions.\r\n            const ogProperties = properties;\r\n            const ogMacros = macros;\r\n            properties = createNewPropertyScope(properties);\r\n            macros = mergePropertySets(macros);\r\n\r\n            // Modify the properties with macro param inputs\r\n            let children = [];\r\n            for (const c of node.children) {\r\n                await processNode(c, ogProperties, ogMacros, children);\r\n            }\r\n            children = children.filter(c => c.nodeType === c.ELEMENT_NODE);\r\n\r\n            let blockCount = 0;\r\n            for (const p in macro.params) {\r\n                const param = macro.params[p];\r\n                if (node.hasAttribute(p)) {\r\n                    properties[p] = evaluateAttribute(node.getAttribute(p), ogProperties);\r\n                } else if (param.type === 'BLOCK') {\r\n                    properties[p] = [children[blockCount]];\r\n                    blockCount++;\r\n                } else if (param.type === 'MULTI_BLOCK') {\r\n                    properties[p] = [...children.filter(c => c.tagName === p)[0].childNodes];\r\n                } else {\r\n                    properties[p] = evaluateAttribute(macro.params[p].def, ogProperties);\r\n                }\r\n            }\r\n\r\n            // Expand the macro\r\n            const macroChildren = [...macro.node.childNodes];\r\n            for (const c of macroChildren) {\r\n                const nodes = [];\r\n                await processNode(c, properties, macros, nodes);\r\n                resultsList.push(...nodes);\r\n            }\r\n        }\r\n\r\n        /* Parsing */\r\n        // Conver the params into an object representation\r\n        function parseMacroParam(param) {\r\n            const obj = {};\r\n\r\n            // Save the type of parameter\r\n            // - two asterisks means an element expands input multiple\r\n            // - one asterisk means copy the first elemnt\r\n            // - no asterisks means value param\r\n            if (/^\\*\\*/.test(param)) {\r\n                obj.type = 'MULTI_BLOCK';\r\n            } else if (/^\\*/.test(param)) {\r\n                obj.type = 'BLOCK';\r\n            } else {\r\n                obj.type = 'PARAM';\r\n            }\r\n\r\n            // strip the asterisks\r\n            param = param.replace(/^\\*{1,2}/g, '');\r\n\r\n            // Check if a default value is provided\r\n            if (/:=/.test(param)) {\r\n                const [name, def] = param.split(':=');\r\n\r\n                // TODO: Support caret and default syntax\r\n                // TODO: is there any difference between the := and = syntax?\r\n                if (/^\\^/.test(def) || /\\|/.test(def)) {\r\n                    throw new Error(`XacroParser: ROS Jade pass-through notation not supported in macro defaults: ${ def }`);\r\n                }\r\n\r\n                obj.name = name;\r\n                obj.def = def;\r\n            } else {\r\n                obj.name = param;\r\n                obj.def = null;\r\n            }\r\n\r\n            return obj;\r\n        }\r\n\r\n        // Parse a xacro:macro tag\r\n        function parseMacro(node) {\r\n            // get attributes\r\n            const name = node.getAttribute('name').replace(/^xacro:/, '');\r\n            const params = node.getAttribute('params');\r\n\r\n            // parse params\r\n            const inputMap = {};\r\n            if (params) {\r\n                const inputs = params\r\n                    .trim()\r\n                    .split(/\\s+/g)\r\n                    .map(s => parseMacroParam(s));\r\n                inputs.forEach(inp => {\r\n                    inputMap[inp.name] = inp;\r\n                });\r\n            }\r\n\r\n            return {\r\n                name,\r\n                node: deepClone(node, false),\r\n                params: inputMap,\r\n            };\r\n        }\r\n\r\n        // Recursively process and expand a node\r\n        async function processNode(node, properties, macros, resultsList = []) {\r\n            if (node.nodeType !== node.ELEMENT_NODE) {\r\n                const res = node.cloneNode();\r\n                res.textContent = evaluateAttribute(res.textContent, properties, true);\r\n                resultsList.push(res);\r\n                return;\r\n            }\r\n\r\n            let tagName = node.tagName.toLowerCase();\r\n            if (!requirePrefix) {\r\n                switch (tagName) {\r\n\r\n                    case 'arg':\r\n                    case 'property':\r\n                    case 'macro':\r\n                    case 'insert_block':\r\n                    case 'if':\r\n                    case 'unless':\r\n                    case 'include':\r\n                    case 'element':\r\n                    case 'attribute':\r\n                        tagName = `xacro:${ tagName }`;\r\n                        break;\r\n                    default:\r\n                        if (tagName in macros) {\r\n                            tagName = `xacro:${ tagName }`;\r\n                        }\r\n                        break;\r\n\r\n                }\r\n            }\r\n\r\n            switch (tagName) {\r\n\r\n                case 'xacro:property': {\r\n                    removeEndCommentsFromArray(resultsList);\r\n\r\n                    const name = node.getAttribute('name');\r\n\r\n                    let value;\r\n                    if (node.hasAttribute('value')) {\r\n                        value = node.getAttribute('value');\r\n                    } else if (node.hasAttribute('default')) {\r\n                        value = node.getAttribute('default');\r\n                    } else {\r\n                        const childNodes = [...node.childNodes];\r\n                        value = [];\r\n                        for (const c of childNodes) {\r\n                            value.push(deepClone(c, false));\r\n                        }\r\n                    }\r\n\r\n                    let scope = 'global';\r\n                    if (localProperties) {\r\n                        scope = node.getAttribute('scope') || 'local';\r\n                    }\r\n\r\n                    // Emulated behavior here\r\n                    // https://github.com/ros/xacro/blob/melodic-devel/src/xacro/__init__.py#L565\r\n                    if (scope !== 'local') {\r\n                        value = evaluateAttribute(value, properties);\r\n                    }\r\n\r\n                    if (scope === 'global') {\r\n                        globalProperties[name] = value;\r\n                    } else if (scope === 'parent') {\r\n                        properties[PARENT_SCOPE][name] = value;\r\n                    } else {\r\n                        properties[name] = value;\r\n                    }\r\n\r\n                    break;\r\n                }\r\n                case 'xacro:macro': {\r\n                    removeEndCommentsFromArray(resultsList);\r\n\r\n                    const macro = parseMacro(node);\r\n                    macros[macro.name] = macro;\r\n                    break;\r\n                }\r\n                case 'xacro:insert_block': {\r\n                    removeEndCommentsFromArray(resultsList);\r\n\r\n                    const name = node.getAttribute('name');\r\n                    const nodes = properties[name];\r\n\r\n                    for (const c of nodes) {\r\n                        await processNode(c, properties, macros, resultsList);\r\n                    }\r\n                    return;\r\n                }\r\n                case 'xacro:if':\r\n                case 'xacro:unless': {\r\n                    removeEndCommentsFromArray(resultsList);\r\n\r\n                    const value = evaluateAttribute(node.getAttribute('value'), properties, true);\r\n                    let bool = null;\r\n                    if (!isNaN(parseFloat(value))) {\r\n                        bool = !!parseFloat(value);\r\n                    } else if (value === 'true' || value === 'false') {\r\n                        bool = value === 'true';\r\n                    } else {\r\n                        bool = value;\r\n                    }\r\n\r\n                    if (tagName === 'xacro:unless') {\r\n                        bool = !bool;\r\n                    }\r\n\r\n                    if (bool) {\r\n                        const childNodes = [...node.childNodes];\r\n                        for (const c of childNodes) {\r\n                            await processNode(c, properties, macros, resultsList);\r\n                        }\r\n                    }\r\n                    return;\r\n                }\r\n                case 'xacro:include': {\r\n                    removeEndCommentsFromArray(resultsList);\r\n\r\n                    if (node.hasAttribute('ns')) {\r\n                        throw new Error('XacroParser: xacro:include name spaces not supported.');\r\n                    }\r\n                    const filename = evaluateAttribute(node.getAttribute('filename'), properties, true);\r\n                    const isAbsolute = /^[/\\\\]/.test(filename) || /^[a-zA-Z]+:[/\\\\]/.test(filename);\r\n                    const filePath = isAbsolute ? filename : currWorkingPath + filename;\r\n\r\n                    const prevWorkingPath = currWorkingPath;\r\n                    currWorkingPath = getUrlBase(filePath);\r\n\r\n                    const includeContent = await loadInclude(filePath);\r\n                    const childNodes = [...includeContent.children[0].childNodes];\r\n                    for (const c of childNodes) {\r\n                        await processNode(c, properties, macros, resultsList);\r\n                    }\r\n\r\n                    currWorkingPath = prevWorkingPath;\r\n                    return;\r\n                }\r\n                case 'xacro:arg':\r\n                case 'xacro:attribute':\r\n                case 'xacro:element':\r\n                    throw new Error(`XacroParser: ${ tagName } tags not supported.`);\r\n                default: {\r\n                    // TODO: check if there's a 'call' attribute here which indicates that\r\n                    // a macro should be invoked?\r\n                    if (/^xacro:/.test(tagName) || tagName in macros) {\r\n                        removeEndCommentsFromArray(resultsList);\r\n\r\n                        return evaluateMacro(node, properties, macros, resultsList);\r\n                    } else {\r\n\r\n                        const res = node.cloneNode();\r\n                        for (let i = 0, l = res.attributes.length; i < l; i++) {\r\n                            const attr = res.attributes[i];\r\n                            const value = evaluateAttribute(attr.value, properties, true);\r\n                            res.setAttribute(attr.name, value);\r\n                        }\r\n\r\n                        const childNodes = [...node.childNodes];\r\n                        const resultChildren = [];\r\n                        for (let i = 0, l = childNodes.length; i < l; i++) {\r\n                            await processNode(childNodes[i], properties, macros, resultChildren);\r\n                        }\r\n                        resultChildren.forEach(c => res.appendChild(c));\r\n                        resultsList.push(res);\r\n                    }\r\n                }\r\n\r\n            }\r\n        }\r\n\r\n        // Process all property and macro tags into the objects\r\n        async function gatherPropertiesAndMacros(el, properties, macros) {\r\n            const propertyEl = getElementsWithName(el, 'xacro:property');\r\n            if (!requirePrefix) {\r\n                propertyEl.push(...getElementsWithName(el, 'property'));\r\n            }\r\n            for (const el of propertyEl) {\r\n                await processNode(el, properties, macros);\r\n            }\r\n\r\n            const macroEl = getElementsWithName(el, 'xacro:macro');\r\n            if (!requirePrefix) {\r\n                macroEl.push(...getElementsWithName(el, 'macro'));\r\n            }\r\n            for (const el of macroEl) {\r\n                await processNode(el, properties, macros);\r\n            }\r\n        }\r\n\r\n        // Process a document node with a new property and macro scope\r\n        async function processXacro(xacro, properties, macros) {\r\n            const res = xacro.cloneNode();\r\n            for (let i = 0, l = xacro.children.length; i < l; i++) {\r\n                const child = [];\r\n                await processNode(xacro.children[i], properties, macros, child);\r\n\r\n                const root = child[0];\r\n                root.removeAttribute('xmlns:xacro');\r\n                res.appendChild(root);\r\n            }\r\n            return res;\r\n        }\r\n\r\n        async function loadInclude(path) {\r\n\r\n            try {\r\n                const text = await scope.getFileContents(path);\r\n                return new DOMParser().parseFromString(text, 'text/xml');\r\n            } catch (e) {\r\n                throw new Error(`XacroParser: Could not load included file: ${ path }`);\r\n            }\r\n\r\n        }\r\n\r\n        async function loadIncludes(xacro, workingPath, results = []) {\r\n\r\n            const includeEl = getElementsWithName(xacro, 'xacro:include');\r\n            if (!requirePrefix) {\r\n                includeEl.push(...getElementsWithName(xacro, 'include'));\r\n            }\r\n\r\n            const promises = includeEl.map(el => {\r\n                // TODO: Handle namespaces on the include.\r\n                if (el.hasAttribute('ns')) {\r\n                    throw new Error('XacroParser: xacro:include name spaces not supported.');\r\n                }\r\n\r\n                const filename = el.getAttribute('filename');\r\n                const namespace = el.getAttribute('ns') || null;\r\n                const isAbsolute = /^[/\\\\]/.test(filename) || /^[a-zA-Z]+:[/\\\\]/.test(filename);\r\n                const filePath = isAbsolute ? filename : workingPath + filename;\r\n                const pr = loadInclude(filePath)\r\n                    .then(content => {\r\n                        results.push({ filename, namespace, content });\r\n\r\n                        const relPath = getUrlBase(filePath);\r\n                        return loadIncludes(content, relPath, results);\r\n                    });\r\n                return pr;\r\n            });\r\n\r\n            await Promise.all(promises);\r\n            return results;\r\n        }\r\n\r\n        // TODO: Provide a default \"arg\" command function that defaults to\r\n        // xacro:arg fields.\r\n        const scope = this;\r\n        const inOrder = this.inOrder;\r\n\r\n        // add a file separator to the end of the working path if it's specified\r\n        // and doesn't have one.\r\n        const workingPath = this.workingPath + (this.workingPath && !/[\\\\/]$/.test(this.workingPath) ? '/' : '');\r\n        const requirePrefix = this.requirePrefix;\r\n        const rospackCommands = this.rospackCommands;\r\n        const globalMacros = {};\r\n        const includeMap = {};\r\n        const globalProperties = { True: 1, False: 0 };\r\n        globalProperties[PARENT_SCOPE] = globalProperties;\r\n\r\n        const handleRospackCommand = (stem, ...args) => {\r\n\r\n            if (rospackCommands instanceof Function) {\r\n\r\n                return rospackCommands(stem, ...args);\r\n\r\n            } else {\r\n\r\n                return rospackCommands[stem](...args);\r\n\r\n            }\r\n\r\n        };\r\n        const handleExpressionEvaluation = evaluateExpression;\r\n\r\n        let localProperties = this.localProperties;\r\n        let currWorkingPath = workingPath;\r\n        let content = new DOMParser().parseFromString(data, 'text/xml');\r\n\r\n        if (localProperties && !inOrder) {\r\n            console.warn('XacroParser: Implicitly setting \"localProperties\" option to false because \"inOrder\" is false.');\r\n            localProperties = false;\r\n        }\r\n\r\n        let inOrderPromise = null;\r\n        if (!inOrder) {\r\n            inOrderPromise = (async function() {\r\n                await gatherPropertiesAndMacros(content, globalProperties, globalMacros);\r\n                content = deepClone(content, true);\r\n\r\n                return loadIncludes(content, workingPath)\r\n                    .then(arr => {\r\n                        arr.forEach(inc => {\r\n                            // TODO: handle namespaces here when rolling up properties and macros\r\n                            gatherPropertiesAndMacros(inc.content, globalProperties, globalMacros);\r\n                            inc.content = deepClone(inc.content, true);\r\n                            includeMap[inc.filename] = inc.content;\r\n                        });\r\n                    });\r\n            })();\r\n        } else {\r\n            inOrderPromise = Promise.resolve();\r\n        }\r\n\r\n        await inOrderPromise;\r\n        return processXacro(content, globalProperties, globalMacros);\r\n    }\r\n\r\n}\r\n","import { isNumber } from './utils.js';\r\nimport { Parser } from 'expr-eval';\r\n\r\nconst parser = new Parser();\r\n\r\nparser.unaryOps = {\r\n    '-': parser.unaryOps['-'],\r\n    '+': parser.unaryOps['+'],\r\n    '!': parser.unaryOps['!'],\r\n};\r\n\r\nparser.functions = {\r\n    sin: Math.sin,\r\n    cos: Math.cos,\r\n    tan: Math.tan,\r\n    asin: Math.asin,\r\n    acos: Math.acos,\r\n    atan: Math.atan,\r\n    log: Math.log,\r\n    atan2: Math.atan2,\r\n    pow: Math.pow,\r\n    radians: (degrees) => { return degrees * (Math.PI / 180); },\r\n    degrees: (radians) => { return radians * (180 / Math.PI); },\r\n};\r\n\r\nparser.binaryOps = {\r\n    ...parser.binaryOps,\r\n    '+': (a, b) => {\r\n        if (isNumber(a)) {\r\n            a = Number(a);\r\n        }\r\n\r\n        if (isNumber(b)) {\r\n            b = Number(b);\r\n        }\r\n\r\n        return a + b;\r\n    },\r\n    'in': (a, b) => {\r\n        if (Array.isArray(b)) {\r\n            return b.includes(a);\r\n        } else if (typeof b === 'string') {\r\n            return b.includes(a);\r\n        } else {\r\n            return a in b;\r\n        }\r\n    },\r\n};\r\n\r\nparser.consts = {\r\n    ...parser.consts,\r\n    pi: Math.PI,\r\n    e: Math.E,\r\n};\r\n\r\nexport function evaluateExpression(expr) {\r\n    return parser.evaluate(expr);\r\n}\r\n","var INUMBER = 'INUMBER';\nvar IOP1 = 'IOP1';\nvar IOP2 = 'IOP2';\nvar IOP3 = 'IOP3';\nvar IVAR = 'IVAR';\nvar IVARNAME = 'IVARNAME';\nvar IFUNCALL = 'IFUNCALL';\nvar IFUNDEF = 'IFUNDEF';\nvar IEXPR = 'IEXPR';\nvar IEXPREVAL = 'IEXPREVAL';\nvar IMEMBER = 'IMEMBER';\nvar IENDSTATEMENT = 'IENDSTATEMENT';\nvar IARRAY = 'IARRAY';\n\nfunction Instruction(type, value) {\n  this.type = type;\n  this.value = (value !== undefined && value !== null) ? value : 0;\n}\n\nInstruction.prototype.toString = function () {\n  switch (this.type) {\n    case INUMBER:\n    case IOP1:\n    case IOP2:\n    case IOP3:\n    case IVAR:\n    case IVARNAME:\n    case IENDSTATEMENT:\n      return this.value;\n    case IFUNCALL:\n      return 'CALL ' + this.value;\n    case IFUNDEF:\n      return 'DEF ' + this.value;\n    case IARRAY:\n      return 'ARRAY ' + this.value;\n    case IMEMBER:\n      return '.' + this.value;\n    default:\n      return 'Invalid Instruction';\n  }\n};\n\nfunction unaryInstruction(value) {\n  return new Instruction(IOP1, value);\n}\n\nfunction binaryInstruction(value) {\n  return new Instruction(IOP2, value);\n}\n\nfunction ternaryInstruction(value) {\n  return new Instruction(IOP3, value);\n}\n\nfunction simplify(tokens, unaryOps, binaryOps, ternaryOps, values) {\n  var nstack = [];\n  var newexpression = [];\n  var n1, n2, n3;\n  var f;\n  for (var i = 0; i < tokens.length; i++) {\n    var item = tokens[i];\n    var type = item.type;\n    if (type === INUMBER || type === IVARNAME) {\n      if (Array.isArray(item.value)) {\n        nstack.push.apply(nstack, simplify(item.value.map(function (x) {\n          return new Instruction(INUMBER, x);\n        }).concat(new Instruction(IARRAY, item.value.length)), unaryOps, binaryOps, ternaryOps, values));\n      } else {\n        nstack.push(item);\n      }\n    } else if (type === IVAR && values.hasOwnProperty(item.value)) {\n      item = new Instruction(INUMBER, values[item.value]);\n      nstack.push(item);\n    } else if (type === IOP2 && nstack.length > 1) {\n      n2 = nstack.pop();\n      n1 = nstack.pop();\n      f = binaryOps[item.value];\n      item = new Instruction(INUMBER, f(n1.value, n2.value));\n      nstack.push(item);\n    } else if (type === IOP3 && nstack.length > 2) {\n      n3 = nstack.pop();\n      n2 = nstack.pop();\n      n1 = nstack.pop();\n      if (item.value === '?') {\n        nstack.push(n1.value ? n2.value : n3.value);\n      } else {\n        f = ternaryOps[item.value];\n        item = new Instruction(INUMBER, f(n1.value, n2.value, n3.value));\n        nstack.push(item);\n      }\n    } else if (type === IOP1 && nstack.length > 0) {\n      n1 = nstack.pop();\n      f = unaryOps[item.value];\n      item = new Instruction(INUMBER, f(n1.value));\n      nstack.push(item);\n    } else if (type === IEXPR) {\n      while (nstack.length > 0) {\n        newexpression.push(nstack.shift());\n      }\n      newexpression.push(new Instruction(IEXPR, simplify(item.value, unaryOps, binaryOps, ternaryOps, values)));\n    } else if (type === IMEMBER && nstack.length > 0) {\n      n1 = nstack.pop();\n      nstack.push(new Instruction(INUMBER, n1.value[item.value]));\n    } /* else if (type === IARRAY && nstack.length >= item.value) {\n      var length = item.value;\n      while (length-- > 0) {\n        newexpression.push(nstack.pop());\n      }\n      newexpression.push(new Instruction(IARRAY, item.value));\n    } */ else {\n      while (nstack.length > 0) {\n        newexpression.push(nstack.shift());\n      }\n      newexpression.push(item);\n    }\n  }\n  while (nstack.length > 0) {\n    newexpression.push(nstack.shift());\n  }\n  return newexpression;\n}\n\nfunction substitute(tokens, variable, expr) {\n  var newexpression = [];\n  for (var i = 0; i < tokens.length; i++) {\n    var item = tokens[i];\n    var type = item.type;\n    if (type === IVAR && item.value === variable) {\n      for (var j = 0; j < expr.tokens.length; j++) {\n        var expritem = expr.tokens[j];\n        var replitem;\n        if (expritem.type === IOP1) {\n          replitem = unaryInstruction(expritem.value);\n        } else if (expritem.type === IOP2) {\n          replitem = binaryInstruction(expritem.value);\n        } else if (expritem.type === IOP3) {\n          replitem = ternaryInstruction(expritem.value);\n        } else {\n          replitem = new Instruction(expritem.type, expritem.value);\n        }\n        newexpression.push(replitem);\n      }\n    } else if (type === IEXPR) {\n      newexpression.push(new Instruction(IEXPR, substitute(item.value, variable, expr)));\n    } else {\n      newexpression.push(item);\n    }\n  }\n  return newexpression;\n}\n\nfunction evaluate(tokens, expr, values) {\n  var nstack = [];\n  var n1, n2, n3;\n  var f, args, argCount;\n\n  if (isExpressionEvaluator(tokens)) {\n    return resolveExpression(tokens, values);\n  }\n\n  var numTokens = tokens.length;\n\n  for (var i = 0; i < numTokens; i++) {\n    var item = tokens[i];\n    var type = item.type;\n    if (type === INUMBER || type === IVARNAME) {\n      nstack.push(item.value);\n    } else if (type === IOP2) {\n      n2 = nstack.pop();\n      n1 = nstack.pop();\n      if (item.value === 'and') {\n        nstack.push(n1 ? !!evaluate(n2, expr, values) : false);\n      } else if (item.value === 'or') {\n        nstack.push(n1 ? true : !!evaluate(n2, expr, values));\n      } else if (item.value === '=') {\n        f = expr.binaryOps[item.value];\n        nstack.push(f(n1, evaluate(n2, expr, values), values));\n      } else {\n        f = expr.binaryOps[item.value];\n        nstack.push(f(resolveExpression(n1, values), resolveExpression(n2, values)));\n      }\n    } else if (type === IOP3) {\n      n3 = nstack.pop();\n      n2 = nstack.pop();\n      n1 = nstack.pop();\n      if (item.value === '?') {\n        nstack.push(evaluate(n1 ? n2 : n3, expr, values));\n      } else {\n        f = expr.ternaryOps[item.value];\n        nstack.push(f(resolveExpression(n1, values), resolveExpression(n2, values), resolveExpression(n3, values)));\n      }\n    } else if (type === IVAR) {\n      if (item.value in expr.functions) {\n        nstack.push(expr.functions[item.value]);\n      } else if (item.value in expr.unaryOps && expr.parser.isOperatorEnabled(item.value)) {\n        nstack.push(expr.unaryOps[item.value]);\n      } else {\n        var v = values[item.value];\n        if (v !== undefined) {\n          nstack.push(v);\n        } else {\n          throw new Error('undefined variable: ' + item.value);\n        }\n      }\n    } else if (type === IOP1) {\n      n1 = nstack.pop();\n      f = expr.unaryOps[item.value];\n      nstack.push(f(resolveExpression(n1, values)));\n    } else if (type === IFUNCALL) {\n      argCount = item.value;\n      args = [];\n      while (argCount-- > 0) {\n        args.unshift(resolveExpression(nstack.pop(), values));\n      }\n      f = nstack.pop();\n      if (f.apply && f.call) {\n        nstack.push(f.apply(undefined, args));\n      } else {\n        throw new Error(f + ' is not a function');\n      }\n    } else if (type === IFUNDEF) {\n      // Create closure to keep references to arguments and expression\n      nstack.push((function () {\n        var n2 = nstack.pop();\n        var args = [];\n        var argCount = item.value;\n        while (argCount-- > 0) {\n          args.unshift(nstack.pop());\n        }\n        var n1 = nstack.pop();\n        var f = function () {\n          var scope = Object.assign({}, values);\n          for (var i = 0, len = args.length; i < len; i++) {\n            scope[args[i]] = arguments[i];\n          }\n          return evaluate(n2, expr, scope);\n        };\n        // f.name = n1\n        Object.defineProperty(f, 'name', {\n          value: n1,\n          writable: false\n        });\n        values[n1] = f;\n        return f;\n      })());\n    } else if (type === IEXPR) {\n      nstack.push(createExpressionEvaluator(item, expr));\n    } else if (type === IEXPREVAL) {\n      nstack.push(item);\n    } else if (type === IMEMBER) {\n      n1 = nstack.pop();\n      nstack.push(n1[item.value]);\n    } else if (type === IENDSTATEMENT) {\n      nstack.pop();\n    } else if (type === IARRAY) {\n      argCount = item.value;\n      args = [];\n      while (argCount-- > 0) {\n        args.unshift(nstack.pop());\n      }\n      nstack.push(args);\n    } else {\n      throw new Error('invalid Expression');\n    }\n  }\n  if (nstack.length > 1) {\n    throw new Error('invalid Expression (parity)');\n  }\n  // Explicitly return zero to avoid test issues caused by -0\n  return nstack[0] === 0 ? 0 : resolveExpression(nstack[0], values);\n}\n\nfunction createExpressionEvaluator(token, expr, values) {\n  if (isExpressionEvaluator(token)) return token;\n  return {\n    type: IEXPREVAL,\n    value: function (scope) {\n      return evaluate(token.value, expr, scope);\n    }\n  };\n}\n\nfunction isExpressionEvaluator(n) {\n  return n && n.type === IEXPREVAL;\n}\n\nfunction resolveExpression(n, values) {\n  return isExpressionEvaluator(n) ? n.value(values) : n;\n}\n\nfunction expressionToString(tokens, toJS) {\n  var nstack = [];\n  var n1, n2, n3;\n  var f, args, argCount;\n  for (var i = 0; i < tokens.length; i++) {\n    var item = tokens[i];\n    var type = item.type;\n    if (type === INUMBER) {\n      if (typeof item.value === 'number' && item.value < 0) {\n        nstack.push('(' + item.value + ')');\n      } else if (Array.isArray(item.value)) {\n        nstack.push('[' + item.value.map(escapeValue).join(', ') + ']');\n      } else {\n        nstack.push(escapeValue(item.value));\n      }\n    } else if (type === IOP2) {\n      n2 = nstack.pop();\n      n1 = nstack.pop();\n      f = item.value;\n      if (toJS) {\n        if (f === '^') {\n          nstack.push('Math.pow(' + n1 + ', ' + n2 + ')');\n        } else if (f === 'and') {\n          nstack.push('(!!' + n1 + ' && !!' + n2 + ')');\n        } else if (f === 'or') {\n          nstack.push('(!!' + n1 + ' || !!' + n2 + ')');\n        } else if (f === '||') {\n          nstack.push('(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }((' + n1 + '),(' + n2 + ')))');\n        } else if (f === '==') {\n          nstack.push('(' + n1 + ' === ' + n2 + ')');\n        } else if (f === '!=') {\n          nstack.push('(' + n1 + ' !== ' + n2 + ')');\n        } else if (f === '[') {\n          nstack.push(n1 + '[(' + n2 + ') | 0]');\n        } else {\n          nstack.push('(' + n1 + ' ' + f + ' ' + n2 + ')');\n        }\n      } else {\n        if (f === '[') {\n          nstack.push(n1 + '[' + n2 + ']');\n        } else {\n          nstack.push('(' + n1 + ' ' + f + ' ' + n2 + ')');\n        }\n      }\n    } else if (type === IOP3) {\n      n3 = nstack.pop();\n      n2 = nstack.pop();\n      n1 = nstack.pop();\n      f = item.value;\n      if (f === '?') {\n        nstack.push('(' + n1 + ' ? ' + n2 + ' : ' + n3 + ')');\n      } else {\n        throw new Error('invalid Expression');\n      }\n    } else if (type === IVAR || type === IVARNAME) {\n      nstack.push(item.value);\n    } else if (type === IOP1) {\n      n1 = nstack.pop();\n      f = item.value;\n      if (f === '-' || f === '+') {\n        nstack.push('(' + f + n1 + ')');\n      } else if (toJS) {\n        if (f === 'not') {\n          nstack.push('(' + '!' + n1 + ')');\n        } else if (f === '!') {\n          nstack.push('fac(' + n1 + ')');\n        } else {\n          nstack.push(f + '(' + n1 + ')');\n        }\n      } else if (f === '!') {\n        nstack.push('(' + n1 + '!)');\n      } else {\n        nstack.push('(' + f + ' ' + n1 + ')');\n      }\n    } else if (type === IFUNCALL) {\n      argCount = item.value;\n      args = [];\n      while (argCount-- > 0) {\n        args.unshift(nstack.pop());\n      }\n      f = nstack.pop();\n      nstack.push(f + '(' + args.join(', ') + ')');\n    } else if (type === IFUNDEF) {\n      n2 = nstack.pop();\n      argCount = item.value;\n      args = [];\n      while (argCount-- > 0) {\n        args.unshift(nstack.pop());\n      }\n      n1 = nstack.pop();\n      if (toJS) {\n        nstack.push('(' + n1 + ' = function(' + args.join(', ') + ') { return ' + n2 + ' })');\n      } else {\n        nstack.push('(' + n1 + '(' + args.join(', ') + ') = ' + n2 + ')');\n      }\n    } else if (type === IMEMBER) {\n      n1 = nstack.pop();\n      nstack.push(n1 + '.' + item.value);\n    } else if (type === IARRAY) {\n      argCount = item.value;\n      args = [];\n      while (argCount-- > 0) {\n        args.unshift(nstack.pop());\n      }\n      nstack.push('[' + args.join(', ') + ']');\n    } else if (type === IEXPR) {\n      nstack.push('(' + expressionToString(item.value, toJS) + ')');\n    } else if (type === IENDSTATEMENT) ; else {\n      throw new Error('invalid Expression');\n    }\n  }\n  if (nstack.length > 1) {\n    if (toJS) {\n      nstack = [ nstack.join(',') ];\n    } else {\n      nstack = [ nstack.join(';') ];\n    }\n  }\n  return String(nstack[0]);\n}\n\nfunction escapeValue(v) {\n  if (typeof v === 'string') {\n    return JSON.stringify(v).replace(/\\u2028/g, '\\\\u2028').replace(/\\u2029/g, '\\\\u2029');\n  }\n  return v;\n}\n\nfunction contains(array, obj) {\n  for (var i = 0; i < array.length; i++) {\n    if (array[i] === obj) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction getSymbols(tokens, symbols, options) {\n  options = options || {};\n  var withMembers = !!options.withMembers;\n  var prevVar = null;\n\n  for (var i = 0; i < tokens.length; i++) {\n    var item = tokens[i];\n    if (item.type === IVAR || item.type === IVARNAME) {\n      if (!withMembers && !contains(symbols, item.value)) {\n        symbols.push(item.value);\n      } else if (prevVar !== null) {\n        if (!contains(symbols, prevVar)) {\n          symbols.push(prevVar);\n        }\n        prevVar = item.value;\n      } else {\n        prevVar = item.value;\n      }\n    } else if (item.type === IMEMBER && withMembers && prevVar !== null) {\n      prevVar += '.' + item.value;\n    } else if (item.type === IEXPR) {\n      getSymbols(item.value, symbols, options);\n    } else if (prevVar !== null) {\n      if (!contains(symbols, prevVar)) {\n        symbols.push(prevVar);\n      }\n      prevVar = null;\n    }\n  }\n\n  if (prevVar !== null && !contains(symbols, prevVar)) {\n    symbols.push(prevVar);\n  }\n}\n\nfunction Expression(tokens, parser) {\n  this.tokens = tokens;\n  this.parser = parser;\n  this.unaryOps = parser.unaryOps;\n  this.binaryOps = parser.binaryOps;\n  this.ternaryOps = parser.ternaryOps;\n  this.functions = parser.functions;\n}\n\nExpression.prototype.simplify = function (values) {\n  values = values || {};\n  return new Expression(simplify(this.tokens, this.unaryOps, this.binaryOps, this.ternaryOps, values), this.parser);\n};\n\nExpression.prototype.substitute = function (variable, expr) {\n  if (!(expr instanceof Expression)) {\n    expr = this.parser.parse(String(expr));\n  }\n\n  return new Expression(substitute(this.tokens, variable, expr), this.parser);\n};\n\nExpression.prototype.evaluate = function (values) {\n  values = values || {};\n  return evaluate(this.tokens, this, values);\n};\n\nExpression.prototype.toString = function () {\n  return expressionToString(this.tokens, false);\n};\n\nExpression.prototype.symbols = function (options) {\n  options = options || {};\n  var vars = [];\n  getSymbols(this.tokens, vars, options);\n  return vars;\n};\n\nExpression.prototype.variables = function (options) {\n  options = options || {};\n  var vars = [];\n  getSymbols(this.tokens, vars, options);\n  var functions = this.functions;\n  return vars.filter(function (name) {\n    return !(name in functions);\n  });\n};\n\nExpression.prototype.toJSFunction = function (param, variables) {\n  var expr = this;\n  var f = new Function(param, 'with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return ' + expressionToString(this.simplify(variables).tokens, true) + '; }'); // eslint-disable-line no-new-func\n  return function () {\n    return f.apply(expr, arguments);\n  };\n};\n\nvar TEOF = 'TEOF';\nvar TOP = 'TOP';\nvar TNUMBER = 'TNUMBER';\nvar TSTRING = 'TSTRING';\nvar TPAREN = 'TPAREN';\nvar TBRACKET = 'TBRACKET';\nvar TCOMMA = 'TCOMMA';\nvar TNAME = 'TNAME';\nvar TSEMICOLON = 'TSEMICOLON';\n\nfunction Token(type, value, index) {\n  this.type = type;\n  this.value = value;\n  this.index = index;\n}\n\nToken.prototype.toString = function () {\n  return this.type + ': ' + this.value;\n};\n\nfunction TokenStream(parser, expression) {\n  this.pos = 0;\n  this.current = null;\n  this.unaryOps = parser.unaryOps;\n  this.binaryOps = parser.binaryOps;\n  this.ternaryOps = parser.ternaryOps;\n  this.consts = parser.consts;\n  this.expression = expression;\n  this.savedPosition = 0;\n  this.savedCurrent = null;\n  this.options = parser.options;\n  this.parser = parser;\n}\n\nTokenStream.prototype.newToken = function (type, value, pos) {\n  return new Token(type, value, pos != null ? pos : this.pos);\n};\n\nTokenStream.prototype.save = function () {\n  this.savedPosition = this.pos;\n  this.savedCurrent = this.current;\n};\n\nTokenStream.prototype.restore = function () {\n  this.pos = this.savedPosition;\n  this.current = this.savedCurrent;\n};\n\nTokenStream.prototype.next = function () {\n  if (this.pos >= this.expression.length) {\n    return this.newToken(TEOF, 'EOF');\n  }\n\n  if (this.isWhitespace() || this.isComment()) {\n    return this.next();\n  } else if (this.isRadixInteger() ||\n      this.isNumber() ||\n      this.isOperator() ||\n      this.isString() ||\n      this.isParen() ||\n      this.isBracket() ||\n      this.isComma() ||\n      this.isSemicolon() ||\n      this.isNamedOp() ||\n      this.isConst() ||\n      this.isName()) {\n    return this.current;\n  } else {\n    this.parseError('Unknown character \"' + this.expression.charAt(this.pos) + '\"');\n  }\n};\n\nTokenStream.prototype.isString = function () {\n  var r = false;\n  var startPos = this.pos;\n  var quote = this.expression.charAt(startPos);\n\n  if (quote === '\\'' || quote === '\"') {\n    var index = this.expression.indexOf(quote, startPos + 1);\n    while (index >= 0 && this.pos < this.expression.length) {\n      this.pos = index + 1;\n      if (this.expression.charAt(index - 1) !== '\\\\') {\n        var rawString = this.expression.substring(startPos + 1, index);\n        this.current = this.newToken(TSTRING, this.unescape(rawString), startPos);\n        r = true;\n        break;\n      }\n      index = this.expression.indexOf(quote, index + 1);\n    }\n  }\n  return r;\n};\n\nTokenStream.prototype.isParen = function () {\n  var c = this.expression.charAt(this.pos);\n  if (c === '(' || c === ')') {\n    this.current = this.newToken(TPAREN, c);\n    this.pos++;\n    return true;\n  }\n  return false;\n};\n\nTokenStream.prototype.isBracket = function () {\n  var c = this.expression.charAt(this.pos);\n  if ((c === '[' || c === ']') && this.isOperatorEnabled('[')) {\n    this.current = this.newToken(TBRACKET, c);\n    this.pos++;\n    return true;\n  }\n  return false;\n};\n\nTokenStream.prototype.isComma = function () {\n  var c = this.expression.charAt(this.pos);\n  if (c === ',') {\n    this.current = this.newToken(TCOMMA, ',');\n    this.pos++;\n    return true;\n  }\n  return false;\n};\n\nTokenStream.prototype.isSemicolon = function () {\n  var c = this.expression.charAt(this.pos);\n  if (c === ';') {\n    this.current = this.newToken(TSEMICOLON, ';');\n    this.pos++;\n    return true;\n  }\n  return false;\n};\n\nTokenStream.prototype.isConst = function () {\n  var startPos = this.pos;\n  var i = startPos;\n  for (; i < this.expression.length; i++) {\n    var c = this.expression.charAt(i);\n    if (c.toUpperCase() === c.toLowerCase()) {\n      if (i === this.pos || (c !== '_' && c !== '.' && (c < '0' || c > '9'))) {\n        break;\n      }\n    }\n  }\n  if (i > startPos) {\n    var str = this.expression.substring(startPos, i);\n    if (str in this.consts) {\n      this.current = this.newToken(TNUMBER, this.consts[str]);\n      this.pos += str.length;\n      return true;\n    }\n  }\n  return false;\n};\n\nTokenStream.prototype.isNamedOp = function () {\n  var startPos = this.pos;\n  var i = startPos;\n  for (; i < this.expression.length; i++) {\n    var c = this.expression.charAt(i);\n    if (c.toUpperCase() === c.toLowerCase()) {\n      if (i === this.pos || (c !== '_' && (c < '0' || c > '9'))) {\n        break;\n      }\n    }\n  }\n  if (i > startPos) {\n    var str = this.expression.substring(startPos, i);\n    if (this.isOperatorEnabled(str) && (str in this.binaryOps || str in this.unaryOps || str in this.ternaryOps)) {\n      this.current = this.newToken(TOP, str);\n      this.pos += str.length;\n      return true;\n    }\n  }\n  return false;\n};\n\nTokenStream.prototype.isName = function () {\n  var startPos = this.pos;\n  var i = startPos;\n  var hasLetter = false;\n  for (; i < this.expression.length; i++) {\n    var c = this.expression.charAt(i);\n    if (c.toUpperCase() === c.toLowerCase()) {\n      if (i === this.pos && (c === '$' || c === '_')) {\n        if (c === '_') {\n          hasLetter = true;\n        }\n        continue;\n      } else if (i === this.pos || !hasLetter || (c !== '_' && (c < '0' || c > '9'))) {\n        break;\n      }\n    } else {\n      hasLetter = true;\n    }\n  }\n  if (hasLetter) {\n    var str = this.expression.substring(startPos, i);\n    this.current = this.newToken(TNAME, str);\n    this.pos += str.length;\n    return true;\n  }\n  return false;\n};\n\nTokenStream.prototype.isWhitespace = function () {\n  var r = false;\n  var c = this.expression.charAt(this.pos);\n  while (c === ' ' || c === '\\t' || c === '\\n' || c === '\\r') {\n    r = true;\n    this.pos++;\n    if (this.pos >= this.expression.length) {\n      break;\n    }\n    c = this.expression.charAt(this.pos);\n  }\n  return r;\n};\n\nvar codePointPattern = /^[0-9a-f]{4}$/i;\n\nTokenStream.prototype.unescape = function (v) {\n  var index = v.indexOf('\\\\');\n  if (index < 0) {\n    return v;\n  }\n\n  var buffer = v.substring(0, index);\n  while (index >= 0) {\n    var c = v.charAt(++index);\n    switch (c) {\n      case '\\'':\n        buffer += '\\'';\n        break;\n      case '\"':\n        buffer += '\"';\n        break;\n      case '\\\\':\n        buffer += '\\\\';\n        break;\n      case '/':\n        buffer += '/';\n        break;\n      case 'b':\n        buffer += '\\b';\n        break;\n      case 'f':\n        buffer += '\\f';\n        break;\n      case 'n':\n        buffer += '\\n';\n        break;\n      case 'r':\n        buffer += '\\r';\n        break;\n      case 't':\n        buffer += '\\t';\n        break;\n      case 'u':\n        // interpret the following 4 characters as the hex of the unicode code point\n        var codePoint = v.substring(index + 1, index + 5);\n        if (!codePointPattern.test(codePoint)) {\n          this.parseError('Illegal escape sequence: \\\\u' + codePoint);\n        }\n        buffer += String.fromCharCode(parseInt(codePoint, 16));\n        index += 4;\n        break;\n      default:\n        throw this.parseError('Illegal escape sequence: \"\\\\' + c + '\"');\n    }\n    ++index;\n    var backslash = v.indexOf('\\\\', index);\n    buffer += v.substring(index, backslash < 0 ? v.length : backslash);\n    index = backslash;\n  }\n\n  return buffer;\n};\n\nTokenStream.prototype.isComment = function () {\n  var c = this.expression.charAt(this.pos);\n  if (c === '/' && this.expression.charAt(this.pos + 1) === '*') {\n    this.pos = this.expression.indexOf('*/', this.pos) + 2;\n    if (this.pos === 1) {\n      this.pos = this.expression.length;\n    }\n    return true;\n  }\n  return false;\n};\n\nTokenStream.prototype.isRadixInteger = function () {\n  var pos = this.pos;\n\n  if (pos >= this.expression.length - 2 || this.expression.charAt(pos) !== '0') {\n    return false;\n  }\n  ++pos;\n\n  var radix;\n  var validDigit;\n  if (this.expression.charAt(pos) === 'x') {\n    radix = 16;\n    validDigit = /^[0-9a-f]$/i;\n    ++pos;\n  } else if (this.expression.charAt(pos) === 'b') {\n    radix = 2;\n    validDigit = /^[01]$/i;\n    ++pos;\n  } else {\n    return false;\n  }\n\n  var valid = false;\n  var startPos = pos;\n\n  while (pos < this.expression.length) {\n    var c = this.expression.charAt(pos);\n    if (validDigit.test(c)) {\n      pos++;\n      valid = true;\n    } else {\n      break;\n    }\n  }\n\n  if (valid) {\n    this.current = this.newToken(TNUMBER, parseInt(this.expression.substring(startPos, pos), radix));\n    this.pos = pos;\n  }\n  return valid;\n};\n\nTokenStream.prototype.isNumber = function () {\n  var valid = false;\n  var pos = this.pos;\n  var startPos = pos;\n  var resetPos = pos;\n  var foundDot = false;\n  var foundDigits = false;\n  var c;\n\n  while (pos < this.expression.length) {\n    c = this.expression.charAt(pos);\n    if ((c >= '0' && c <= '9') || (!foundDot && c === '.')) {\n      if (c === '.') {\n        foundDot = true;\n      } else {\n        foundDigits = true;\n      }\n      pos++;\n      valid = foundDigits;\n    } else {\n      break;\n    }\n  }\n\n  if (valid) {\n    resetPos = pos;\n  }\n\n  if (c === 'e' || c === 'E') {\n    pos++;\n    var acceptSign = true;\n    var validExponent = false;\n    while (pos < this.expression.length) {\n      c = this.expression.charAt(pos);\n      if (acceptSign && (c === '+' || c === '-')) {\n        acceptSign = false;\n      } else if (c >= '0' && c <= '9') {\n        validExponent = true;\n        acceptSign = false;\n      } else {\n        break;\n      }\n      pos++;\n    }\n\n    if (!validExponent) {\n      pos = resetPos;\n    }\n  }\n\n  if (valid) {\n    this.current = this.newToken(TNUMBER, parseFloat(this.expression.substring(startPos, pos)));\n    this.pos = pos;\n  } else {\n    this.pos = resetPos;\n  }\n  return valid;\n};\n\nTokenStream.prototype.isOperator = function () {\n  var startPos = this.pos;\n  var c = this.expression.charAt(this.pos);\n\n  if (c === '+' || c === '-' || c === '*' || c === '/' || c === '%' || c === '^' || c === '?' || c === ':' || c === '.') {\n    this.current = this.newToken(TOP, c);\n  } else if (c === '∙' || c === '•') {\n    this.current = this.newToken(TOP, '*');\n  } else if (c === '>') {\n    if (this.expression.charAt(this.pos + 1) === '=') {\n      this.current = this.newToken(TOP, '>=');\n      this.pos++;\n    } else {\n      this.current = this.newToken(TOP, '>');\n    }\n  } else if (c === '<') {\n    if (this.expression.charAt(this.pos + 1) === '=') {\n      this.current = this.newToken(TOP, '<=');\n      this.pos++;\n    } else {\n      this.current = this.newToken(TOP, '<');\n    }\n  } else if (c === '|') {\n    if (this.expression.charAt(this.pos + 1) === '|') {\n      this.current = this.newToken(TOP, '||');\n      this.pos++;\n    } else {\n      return false;\n    }\n  } else if (c === '=') {\n    if (this.expression.charAt(this.pos + 1) === '=') {\n      this.current = this.newToken(TOP, '==');\n      this.pos++;\n    } else {\n      this.current = this.newToken(TOP, c);\n    }\n  } else if (c === '!') {\n    if (this.expression.charAt(this.pos + 1) === '=') {\n      this.current = this.newToken(TOP, '!=');\n      this.pos++;\n    } else {\n      this.current = this.newToken(TOP, c);\n    }\n  } else {\n    return false;\n  }\n  this.pos++;\n\n  if (this.isOperatorEnabled(this.current.value)) {\n    return true;\n  } else {\n    this.pos = startPos;\n    return false;\n  }\n};\n\nTokenStream.prototype.isOperatorEnabled = function (op) {\n  return this.parser.isOperatorEnabled(op);\n};\n\nTokenStream.prototype.getCoordinates = function () {\n  var line = 0;\n  var column;\n  var newline = -1;\n  do {\n    line++;\n    column = this.pos - newline;\n    newline = this.expression.indexOf('\\n', newline + 1);\n  } while (newline >= 0 && newline < this.pos);\n\n  return {\n    line: line,\n    column: column\n  };\n};\n\nTokenStream.prototype.parseError = function (msg) {\n  var coords = this.getCoordinates();\n  throw new Error('parse error [' + coords.line + ':' + coords.column + ']: ' + msg);\n};\n\nfunction ParserState(parser, tokenStream, options) {\n  this.parser = parser;\n  this.tokens = tokenStream;\n  this.current = null;\n  this.nextToken = null;\n  this.next();\n  this.savedCurrent = null;\n  this.savedNextToken = null;\n  this.allowMemberAccess = options.allowMemberAccess !== false;\n}\n\nParserState.prototype.next = function () {\n  this.current = this.nextToken;\n  return (this.nextToken = this.tokens.next());\n};\n\nParserState.prototype.tokenMatches = function (token, value) {\n  if (typeof value === 'undefined') {\n    return true;\n  } else if (Array.isArray(value)) {\n    return contains(value, token.value);\n  } else if (typeof value === 'function') {\n    return value(token);\n  } else {\n    return token.value === value;\n  }\n};\n\nParserState.prototype.save = function () {\n  this.savedCurrent = this.current;\n  this.savedNextToken = this.nextToken;\n  this.tokens.save();\n};\n\nParserState.prototype.restore = function () {\n  this.tokens.restore();\n  this.current = this.savedCurrent;\n  this.nextToken = this.savedNextToken;\n};\n\nParserState.prototype.accept = function (type, value) {\n  if (this.nextToken.type === type && this.tokenMatches(this.nextToken, value)) {\n    this.next();\n    return true;\n  }\n  return false;\n};\n\nParserState.prototype.expect = function (type, value) {\n  if (!this.accept(type, value)) {\n    var coords = this.tokens.getCoordinates();\n    throw new Error('parse error [' + coords.line + ':' + coords.column + ']: Expected ' + (value || type));\n  }\n};\n\nParserState.prototype.parseAtom = function (instr) {\n  var unaryOps = this.tokens.unaryOps;\n  function isPrefixOperator(token) {\n    return token.value in unaryOps;\n  }\n\n  if (this.accept(TNAME) || this.accept(TOP, isPrefixOperator)) {\n    instr.push(new Instruction(IVAR, this.current.value));\n  } else if (this.accept(TNUMBER)) {\n    instr.push(new Instruction(INUMBER, this.current.value));\n  } else if (this.accept(TSTRING)) {\n    instr.push(new Instruction(INUMBER, this.current.value));\n  } else if (this.accept(TPAREN, '(')) {\n    this.parseExpression(instr);\n    this.expect(TPAREN, ')');\n  } else if (this.accept(TBRACKET, '[')) {\n    if (this.accept(TBRACKET, ']')) {\n      instr.push(new Instruction(IARRAY, 0));\n    } else {\n      var argCount = this.parseArrayList(instr);\n      instr.push(new Instruction(IARRAY, argCount));\n    }\n  } else {\n    throw new Error('unexpected ' + this.nextToken);\n  }\n};\n\nParserState.prototype.parseExpression = function (instr) {\n  var exprInstr = [];\n  if (this.parseUntilEndStatement(instr, exprInstr)) {\n    return;\n  }\n  this.parseVariableAssignmentExpression(exprInstr);\n  if (this.parseUntilEndStatement(instr, exprInstr)) {\n    return;\n  }\n  this.pushExpression(instr, exprInstr);\n};\n\nParserState.prototype.pushExpression = function (instr, exprInstr) {\n  for (var i = 0, len = exprInstr.length; i < len; i++) {\n    instr.push(exprInstr[i]);\n  }\n};\n\nParserState.prototype.parseUntilEndStatement = function (instr, exprInstr) {\n  if (!this.accept(TSEMICOLON)) return false;\n  if (this.nextToken && this.nextToken.type !== TEOF && !(this.nextToken.type === TPAREN && this.nextToken.value === ')')) {\n    exprInstr.push(new Instruction(IENDSTATEMENT));\n  }\n  if (this.nextToken.type !== TEOF) {\n    this.parseExpression(exprInstr);\n  }\n  instr.push(new Instruction(IEXPR, exprInstr));\n  return true;\n};\n\nParserState.prototype.parseArrayList = function (instr) {\n  var argCount = 0;\n\n  while (!this.accept(TBRACKET, ']')) {\n    this.parseExpression(instr);\n    ++argCount;\n    while (this.accept(TCOMMA)) {\n      this.parseExpression(instr);\n      ++argCount;\n    }\n  }\n\n  return argCount;\n};\n\nParserState.prototype.parseVariableAssignmentExpression = function (instr) {\n  this.parseConditionalExpression(instr);\n  while (this.accept(TOP, '=')) {\n    var varName = instr.pop();\n    var varValue = [];\n    var lastInstrIndex = instr.length - 1;\n    if (varName.type === IFUNCALL) {\n      if (!this.tokens.isOperatorEnabled('()=')) {\n        throw new Error('function definition is not permitted');\n      }\n      for (var i = 0, len = varName.value + 1; i < len; i++) {\n        var index = lastInstrIndex - i;\n        if (instr[index].type === IVAR) {\n          instr[index] = new Instruction(IVARNAME, instr[index].value);\n        }\n      }\n      this.parseVariableAssignmentExpression(varValue);\n      instr.push(new Instruction(IEXPR, varValue));\n      instr.push(new Instruction(IFUNDEF, varName.value));\n      continue;\n    }\n    if (varName.type !== IVAR && varName.type !== IMEMBER) {\n      throw new Error('expected variable for assignment');\n    }\n    this.parseVariableAssignmentExpression(varValue);\n    instr.push(new Instruction(IVARNAME, varName.value));\n    instr.push(new Instruction(IEXPR, varValue));\n    instr.push(binaryInstruction('='));\n  }\n};\n\nParserState.prototype.parseConditionalExpression = function (instr) {\n  this.parseOrExpression(instr);\n  while (this.accept(TOP, '?')) {\n    var trueBranch = [];\n    var falseBranch = [];\n    this.parseConditionalExpression(trueBranch);\n    this.expect(TOP, ':');\n    this.parseConditionalExpression(falseBranch);\n    instr.push(new Instruction(IEXPR, trueBranch));\n    instr.push(new Instruction(IEXPR, falseBranch));\n    instr.push(ternaryInstruction('?'));\n  }\n};\n\nParserState.prototype.parseOrExpression = function (instr) {\n  this.parseAndExpression(instr);\n  while (this.accept(TOP, 'or')) {\n    var falseBranch = [];\n    this.parseAndExpression(falseBranch);\n    instr.push(new Instruction(IEXPR, falseBranch));\n    instr.push(binaryInstruction('or'));\n  }\n};\n\nParserState.prototype.parseAndExpression = function (instr) {\n  this.parseComparison(instr);\n  while (this.accept(TOP, 'and')) {\n    var trueBranch = [];\n    this.parseComparison(trueBranch);\n    instr.push(new Instruction(IEXPR, trueBranch));\n    instr.push(binaryInstruction('and'));\n  }\n};\n\nvar COMPARISON_OPERATORS = ['==', '!=', '<', '<=', '>=', '>', 'in'];\n\nParserState.prototype.parseComparison = function (instr) {\n  this.parseAddSub(instr);\n  while (this.accept(TOP, COMPARISON_OPERATORS)) {\n    var op = this.current;\n    this.parseAddSub(instr);\n    instr.push(binaryInstruction(op.value));\n  }\n};\n\nvar ADD_SUB_OPERATORS = ['+', '-', '||'];\n\nParserState.prototype.parseAddSub = function (instr) {\n  this.parseTerm(instr);\n  while (this.accept(TOP, ADD_SUB_OPERATORS)) {\n    var op = this.current;\n    this.parseTerm(instr);\n    instr.push(binaryInstruction(op.value));\n  }\n};\n\nvar TERM_OPERATORS = ['*', '/', '%'];\n\nParserState.prototype.parseTerm = function (instr) {\n  this.parseFactor(instr);\n  while (this.accept(TOP, TERM_OPERATORS)) {\n    var op = this.current;\n    this.parseFactor(instr);\n    instr.push(binaryInstruction(op.value));\n  }\n};\n\nParserState.prototype.parseFactor = function (instr) {\n  var unaryOps = this.tokens.unaryOps;\n  function isPrefixOperator(token) {\n    return token.value in unaryOps;\n  }\n\n  this.save();\n  if (this.accept(TOP, isPrefixOperator)) {\n    if (this.current.value !== '-' && this.current.value !== '+') {\n      if (this.nextToken.type === TPAREN && this.nextToken.value === '(') {\n        this.restore();\n        this.parseExponential(instr);\n        return;\n      } else if (this.nextToken.type === TSEMICOLON || this.nextToken.type === TCOMMA || this.nextToken.type === TEOF || (this.nextToken.type === TPAREN && this.nextToken.value === ')')) {\n        this.restore();\n        this.parseAtom(instr);\n        return;\n      }\n    }\n\n    var op = this.current;\n    this.parseFactor(instr);\n    instr.push(unaryInstruction(op.value));\n  } else {\n    this.parseExponential(instr);\n  }\n};\n\nParserState.prototype.parseExponential = function (instr) {\n  this.parsePostfixExpression(instr);\n  while (this.accept(TOP, '^')) {\n    this.parseFactor(instr);\n    instr.push(binaryInstruction('^'));\n  }\n};\n\nParserState.prototype.parsePostfixExpression = function (instr) {\n  this.parseFunctionCall(instr);\n  while (this.accept(TOP, '!')) {\n    instr.push(unaryInstruction('!'));\n  }\n};\n\nParserState.prototype.parseFunctionCall = function (instr) {\n  var unaryOps = this.tokens.unaryOps;\n  function isPrefixOperator(token) {\n    return token.value in unaryOps;\n  }\n\n  if (this.accept(TOP, isPrefixOperator)) {\n    var op = this.current;\n    this.parseAtom(instr);\n    instr.push(unaryInstruction(op.value));\n  } else {\n    this.parseMemberExpression(instr);\n    while (this.accept(TPAREN, '(')) {\n      if (this.accept(TPAREN, ')')) {\n        instr.push(new Instruction(IFUNCALL, 0));\n      } else {\n        var argCount = this.parseArgumentList(instr);\n        instr.push(new Instruction(IFUNCALL, argCount));\n      }\n    }\n  }\n};\n\nParserState.prototype.parseArgumentList = function (instr) {\n  var argCount = 0;\n\n  while (!this.accept(TPAREN, ')')) {\n    this.parseExpression(instr);\n    ++argCount;\n    while (this.accept(TCOMMA)) {\n      this.parseExpression(instr);\n      ++argCount;\n    }\n  }\n\n  return argCount;\n};\n\nParserState.prototype.parseMemberExpression = function (instr) {\n  this.parseAtom(instr);\n  while (this.accept(TOP, '.') || this.accept(TBRACKET, '[')) {\n    var op = this.current;\n\n    if (op.value === '.') {\n      if (!this.allowMemberAccess) {\n        throw new Error('unexpected \".\", member access is not permitted');\n      }\n\n      this.expect(TNAME);\n      instr.push(new Instruction(IMEMBER, this.current.value));\n    } else if (op.value === '[') {\n      if (!this.tokens.isOperatorEnabled('[')) {\n        throw new Error('unexpected \"[]\", arrays are disabled');\n      }\n\n      this.parseExpression(instr);\n      this.expect(TBRACKET, ']');\n      instr.push(binaryInstruction('['));\n    } else {\n      throw new Error('unexpected symbol: ' + op.value);\n    }\n  }\n};\n\nfunction add(a, b) {\n  return Number(a) + Number(b);\n}\n\nfunction sub(a, b) {\n  return a - b;\n}\n\nfunction mul(a, b) {\n  return a * b;\n}\n\nfunction div(a, b) {\n  return a / b;\n}\n\nfunction mod(a, b) {\n  return a % b;\n}\n\nfunction concat(a, b) {\n  if (Array.isArray(a) && Array.isArray(b)) {\n    return a.concat(b);\n  }\n  return '' + a + b;\n}\n\nfunction equal(a, b) {\n  return a === b;\n}\n\nfunction notEqual(a, b) {\n  return a !== b;\n}\n\nfunction greaterThan(a, b) {\n  return a > b;\n}\n\nfunction lessThan(a, b) {\n  return a < b;\n}\n\nfunction greaterThanEqual(a, b) {\n  return a >= b;\n}\n\nfunction lessThanEqual(a, b) {\n  return a <= b;\n}\n\nfunction andOperator(a, b) {\n  return Boolean(a && b);\n}\n\nfunction orOperator(a, b) {\n  return Boolean(a || b);\n}\n\nfunction inOperator(a, b) {\n  return contains(b, a);\n}\n\nfunction sinh(a) {\n  return ((Math.exp(a) - Math.exp(-a)) / 2);\n}\n\nfunction cosh(a) {\n  return ((Math.exp(a) + Math.exp(-a)) / 2);\n}\n\nfunction tanh(a) {\n  if (a === Infinity) return 1;\n  if (a === -Infinity) return -1;\n  return (Math.exp(a) - Math.exp(-a)) / (Math.exp(a) + Math.exp(-a));\n}\n\nfunction asinh(a) {\n  if (a === -Infinity) return a;\n  return Math.log(a + Math.sqrt((a * a) + 1));\n}\n\nfunction acosh(a) {\n  return Math.log(a + Math.sqrt((a * a) - 1));\n}\n\nfunction atanh(a) {\n  return (Math.log((1 + a) / (1 - a)) / 2);\n}\n\nfunction log10(a) {\n  return Math.log(a) * Math.LOG10E;\n}\n\nfunction neg(a) {\n  return -a;\n}\n\nfunction not(a) {\n  return !a;\n}\n\nfunction trunc(a) {\n  return a < 0 ? Math.ceil(a) : Math.floor(a);\n}\n\nfunction random(a) {\n  return Math.random() * (a || 1);\n}\n\nfunction factorial(a) { // a!\n  return gamma(a + 1);\n}\n\nfunction isInteger(value) {\n  return isFinite(value) && (value === Math.round(value));\n}\n\nvar GAMMA_G = 4.7421875;\nvar GAMMA_P = [\n  0.99999999999999709182,\n  57.156235665862923517, -59.597960355475491248,\n  14.136097974741747174, -0.49191381609762019978,\n  0.33994649984811888699e-4,\n  0.46523628927048575665e-4, -0.98374475304879564677e-4,\n  0.15808870322491248884e-3, -0.21026444172410488319e-3,\n  0.21743961811521264320e-3, -0.16431810653676389022e-3,\n  0.84418223983852743293e-4, -0.26190838401581408670e-4,\n  0.36899182659531622704e-5\n];\n\n// Gamma function from math.js\nfunction gamma(n) {\n  var t, x;\n\n  if (isInteger(n)) {\n    if (n <= 0) {\n      return isFinite(n) ? Infinity : NaN;\n    }\n\n    if (n > 171) {\n      return Infinity; // Will overflow\n    }\n\n    var value = n - 2;\n    var res = n - 1;\n    while (value > 1) {\n      res *= value;\n      value--;\n    }\n\n    if (res === 0) {\n      res = 1; // 0! is per definition 1\n    }\n\n    return res;\n  }\n\n  if (n < 0.5) {\n    return Math.PI / (Math.sin(Math.PI * n) * gamma(1 - n));\n  }\n\n  if (n >= 171.35) {\n    return Infinity; // will overflow\n  }\n\n  if (n > 85.0) { // Extended Stirling Approx\n    var twoN = n * n;\n    var threeN = twoN * n;\n    var fourN = threeN * n;\n    var fiveN = fourN * n;\n    return Math.sqrt(2 * Math.PI / n) * Math.pow((n / Math.E), n) *\n      (1 + (1 / (12 * n)) + (1 / (288 * twoN)) - (139 / (51840 * threeN)) -\n      (571 / (2488320 * fourN)) + (163879 / (209018880 * fiveN)) +\n      (5246819 / (75246796800 * fiveN * n)));\n  }\n\n  --n;\n  x = GAMMA_P[0];\n  for (var i = 1; i < GAMMA_P.length; ++i) {\n    x += GAMMA_P[i] / (n + i);\n  }\n\n  t = n + GAMMA_G + 0.5;\n  return Math.sqrt(2 * Math.PI) * Math.pow(t, n + 0.5) * Math.exp(-t) * x;\n}\n\nfunction stringOrArrayLength(s) {\n  if (Array.isArray(s)) {\n    return s.length;\n  }\n  return String(s).length;\n}\n\nfunction hypot() {\n  var sum = 0;\n  var larg = 0;\n  for (var i = 0; i < arguments.length; i++) {\n    var arg = Math.abs(arguments[i]);\n    var div;\n    if (larg < arg) {\n      div = larg / arg;\n      sum = (sum * div * div) + 1;\n      larg = arg;\n    } else if (arg > 0) {\n      div = arg / larg;\n      sum += div * div;\n    } else {\n      sum += arg;\n    }\n  }\n  return larg === Infinity ? Infinity : larg * Math.sqrt(sum);\n}\n\nfunction condition(cond, yep, nope) {\n  return cond ? yep : nope;\n}\n\n/**\n* Decimal adjustment of a number.\n* From @escopecz.\n*\n* @param {Number} value The number.\n* @param {Integer} exp  The exponent (the 10 logarithm of the adjustment base).\n* @return {Number} The adjusted value.\n*/\nfunction roundTo(value, exp) {\n  // If the exp is undefined or zero...\n  if (typeof exp === 'undefined' || +exp === 0) {\n    return Math.round(value);\n  }\n  value = +value;\n  exp = -(+exp);\n  // If the value is not a number or the exp is not an integer...\n  if (isNaN(value) || !(typeof exp === 'number' && exp % 1 === 0)) {\n    return NaN;\n  }\n  // Shift\n  value = value.toString().split('e');\n  value = Math.round(+(value[0] + 'e' + (value[1] ? (+value[1] - exp) : -exp)));\n  // Shift back\n  value = value.toString().split('e');\n  return +(value[0] + 'e' + (value[1] ? (+value[1] + exp) : exp));\n}\n\nfunction setVar(name, value, variables) {\n  if (variables) variables[name] = value;\n  return value;\n}\n\nfunction arrayIndex(array, index) {\n  return array[index | 0];\n}\n\nfunction max(array) {\n  if (arguments.length === 1 && Array.isArray(array)) {\n    return Math.max.apply(Math, array);\n  } else {\n    return Math.max.apply(Math, arguments);\n  }\n}\n\nfunction min(array) {\n  if (arguments.length === 1 && Array.isArray(array)) {\n    return Math.min.apply(Math, array);\n  } else {\n    return Math.min.apply(Math, arguments);\n  }\n}\n\nfunction arrayMap(f, a) {\n  if (typeof f !== 'function') {\n    throw new Error('First argument to map is not a function');\n  }\n  if (!Array.isArray(a)) {\n    throw new Error('Second argument to map is not an array');\n  }\n  return a.map(function (x, i) {\n    return f(x, i);\n  });\n}\n\nfunction arrayFold(f, init, a) {\n  if (typeof f !== 'function') {\n    throw new Error('First argument to fold is not a function');\n  }\n  if (!Array.isArray(a)) {\n    throw new Error('Second argument to fold is not an array');\n  }\n  return a.reduce(function (acc, x, i) {\n    return f(acc, x, i);\n  }, init);\n}\n\nfunction arrayFilter(f, a) {\n  if (typeof f !== 'function') {\n    throw new Error('First argument to filter is not a function');\n  }\n  if (!Array.isArray(a)) {\n    throw new Error('Second argument to filter is not an array');\n  }\n  return a.filter(function (x, i) {\n    return f(x, i);\n  });\n}\n\nfunction stringOrArrayIndexOf(target, s) {\n  if (!(Array.isArray(s) || typeof s === 'string')) {\n    throw new Error('Second argument to indexOf is not a string or array');\n  }\n\n  return s.indexOf(target);\n}\n\nfunction arrayJoin(sep, a) {\n  if (!Array.isArray(a)) {\n    throw new Error('Second argument to join is not an array');\n  }\n\n  return a.join(sep);\n}\n\nfunction sign(x) {\n  return ((x > 0) - (x < 0)) || +x;\n}\n\nvar ONE_THIRD = 1/3;\nfunction cbrt(x) {\n  return x < 0 ? -Math.pow(-x, ONE_THIRD) : Math.pow(x, ONE_THIRD);\n}\n\nfunction expm1(x) {\n  return Math.exp(x) - 1;\n}\n\nfunction log1p(x) {\n  return Math.log(1 + x);\n}\n\nfunction log2(x) {\n  return Math.log(x) / Math.LN2;\n}\n\nfunction Parser(options) {\n  this.options = options || {};\n  this.unaryOps = {\n    sin: Math.sin,\n    cos: Math.cos,\n    tan: Math.tan,\n    asin: Math.asin,\n    acos: Math.acos,\n    atan: Math.atan,\n    sinh: Math.sinh || sinh,\n    cosh: Math.cosh || cosh,\n    tanh: Math.tanh || tanh,\n    asinh: Math.asinh || asinh,\n    acosh: Math.acosh || acosh,\n    atanh: Math.atanh || atanh,\n    sqrt: Math.sqrt,\n    cbrt: Math.cbrt || cbrt,\n    log: Math.log,\n    log2: Math.log2 || log2,\n    ln: Math.log,\n    lg: Math.log10 || log10,\n    log10: Math.log10 || log10,\n    expm1: Math.expm1 || expm1,\n    log1p: Math.log1p || log1p,\n    abs: Math.abs,\n    ceil: Math.ceil,\n    floor: Math.floor,\n    round: Math.round,\n    trunc: Math.trunc || trunc,\n    '-': neg,\n    '+': Number,\n    exp: Math.exp,\n    not: not,\n    length: stringOrArrayLength,\n    '!': factorial,\n    sign: Math.sign || sign\n  };\n\n  this.binaryOps = {\n    '+': add,\n    '-': sub,\n    '*': mul,\n    '/': div,\n    '%': mod,\n    '^': Math.pow,\n    '||': concat,\n    '==': equal,\n    '!=': notEqual,\n    '>': greaterThan,\n    '<': lessThan,\n    '>=': greaterThanEqual,\n    '<=': lessThanEqual,\n    and: andOperator,\n    or: orOperator,\n    'in': inOperator,\n    '=': setVar,\n    '[': arrayIndex\n  };\n\n  this.ternaryOps = {\n    '?': condition\n  };\n\n  this.functions = {\n    random: random,\n    fac: factorial,\n    min: min,\n    max: max,\n    hypot: Math.hypot || hypot,\n    pyt: Math.hypot || hypot, // backward compat\n    pow: Math.pow,\n    atan2: Math.atan2,\n    'if': condition,\n    gamma: gamma,\n    roundTo: roundTo,\n    map: arrayMap,\n    fold: arrayFold,\n    filter: arrayFilter,\n    indexOf: stringOrArrayIndexOf,\n    join: arrayJoin\n  };\n\n  this.consts = {\n    E: Math.E,\n    PI: Math.PI,\n    'true': true,\n    'false': false\n  };\n}\n\nParser.prototype.parse = function (expr) {\n  var instr = [];\n  var parserState = new ParserState(\n    this,\n    new TokenStream(this, expr),\n    { allowMemberAccess: this.options.allowMemberAccess }\n  );\n\n  parserState.parseExpression(instr);\n  parserState.expect(TEOF, 'EOF');\n\n  return new Expression(instr, this);\n};\n\nParser.prototype.evaluate = function (expr, variables) {\n  return this.parse(expr).evaluate(variables);\n};\n\nvar sharedParser = new Parser();\n\nParser.parse = function (expr) {\n  return sharedParser.parse(expr);\n};\n\nParser.evaluate = function (expr, variables) {\n  return sharedParser.parse(expr).evaluate(variables);\n};\n\nvar optionNameMap = {\n  '+': 'add',\n  '-': 'subtract',\n  '*': 'multiply',\n  '/': 'divide',\n  '%': 'remainder',\n  '^': 'power',\n  '!': 'factorial',\n  '<': 'comparison',\n  '>': 'comparison',\n  '<=': 'comparison',\n  '>=': 'comparison',\n  '==': 'comparison',\n  '!=': 'comparison',\n  '||': 'concatenate',\n  'and': 'logical',\n  'or': 'logical',\n  'not': 'logical',\n  '?': 'conditional',\n  ':': 'conditional',\n  '=': 'assignment',\n  '[': 'array',\n  '()=': 'fndef'\n};\n\nfunction getOptionName(op) {\n  return optionNameMap.hasOwnProperty(op) ? optionNameMap[op] : op;\n}\n\nParser.prototype.isOperatorEnabled = function (op) {\n  var optionName = getOptionName(op);\n  var operators = this.options.operators || {};\n\n  return !(optionName in operators) || !!operators[optionName];\n};\n\n/*!\n Based on ndef.parser, by Raphael Graf(r@undefined.ch)\n http://www.undefined.ch/mparser/index.html\n\n Ported to JavaScript and modified by Matthew Crumley (email@matthewcrumley.com, http://silentmatt.com/)\n\n You are free to use and modify this code in anyway you find useful. Please leave this comment in the code\n to acknowledge its original source. If you feel like it, I enjoy hearing about projects that use my code,\n but don't feel like you have to let me know or ask permission.\n*/\n\n// Backwards compatibility\nvar index = {\n  Parser: Parser,\n  Expression: Expression\n};\n\nexport default index;\nexport { Expression, Parser };\n"],"names":["$53dcce4e9343ab5c$var$convertColorsAndTextures","root","_apply","material","color","convertSRGBToLinear","map","encoding","$ilwiq","sRGBEncoding","traverse","c","Array","isArray","forEach","$53dcce4e9343ab5c$export$17659427f433e9a5","Promise","resolve","reject","xacroLoader","$crxIg","XacroLoader","rospackCommands","find","pkg","load","xacro","ik","urdf","goalMap","manager","LoadingManager","onLoad","toRemove","isLight","isLineSegments","push","l","parent","remove","helperScale","urdfLoader","$8C12l","default","packages","curiosity_mars_rover_description","parse","joints","arm_03_joint","limit","upper","Math","PI","$4CEV9","urdfRobotToIKRoot","clearDoF","$6yEsn","quat","fromEuler","quaternion","position","setMatrixNeedsUpdate","setJointValue","setIKFromUrdf","Map","tool","name","link","links","arm_tools","ee","Joint","makeClosure","getWorldPosition","getWorldQuaternion","set","$53dcce4e9343ab5c$export$6fcd1d7de9eef84d","staubli_tx2_90_support","tool0","$53dcce4e9343ab5c$export$4078f69740e7bc66","result","DEG2RAD","rotation","i","isJoint","dofRestPose","dofValues","restPoseSet","test","$53dcce4e9343ab5c$export$356755f6346ac8bd","loader","r2_description","$8FOWU","$6452ad36f92729a4$var$tempQuaternion","Quaternion","$6452ad36f92729a4$var$tempEuler","Euler","val","trim","split","num","parseFloat","$6452ad36f92729a4$var$applyRotation","obj","rpy","additive","setFromEuler","multiply","copy","this","DefaultLoadingManager","loadMeshCb","defaultMeshLoader","bind","parseVisual","parseCollision","loadAsync","onComplete","onProgress","onError","workingPath","LoaderUtils","extractUrlBase","urdfPath","resolveURL","itemStart","fetch","fetchOptions","then","res","ok","text","Error","status","statusText","data","model","itemEnd","catch","e","console","error","itemError","resolvePath","path","targetPkg","relPath","replace","endsWith","Function","node","children","MeshPhongMaterial","getAttribute","matNodes","n","type","nodeName","toLowerCase","rgba","v","setRGB","opacity","transparent","depthWrite","filename","TextureLoader","filePath","vn","materialMap","filter","materialNode","$3iDF4","URDFCollider","URDFVisual","scaleAttr","scale","$6452ad36f92729a4$var$processTuple","group","err","Mesh","identity","add","geoType","primitiveModel","geometry","BoxBufferGeometry","size","SphereBufferGeometry","radius","CylinderBufferGeometry","length","xyz","Document","parseFromString","robot","robotNodes","materials","URDFRobot","robotName","urdfRobotNode","m","materialMap1","processMaterial","visualMap","colliderMap","isRoot","querySelector","target","URDFLink","processLinkElement","hasAttribute","urdfName","cn","processLink","j","jointMap","joint","jointType","mimicTag","URDFMimicJoint","mimicJoint","multiplier","offset","URDFJoint","child","linkMap","lower","axisNode","axisXYZ","axis","Vector3","normalize","processJoint","Object","values","jointList","mimicJoints","j1","uniqueJoints","Set","iterFunction","has","frames","processRobot","$09c9a4300c0632b1$export$78deb5981b3aff86","Loader","super","url","scope","FileLoader","setPath","setResponseType","setRequestHeader","requestHeader","setWithCredentials","withCredentials","data1","matchDataViewAt","query","reader","il","getUint8","binData","buffer","array_buffer","Uint8Array","charCodeAt","ensureBinary","DataView","getUint32","byteLength","solid","off","isBinary","faces","r","g","b","colors","defaultR","defaultG","defaultB","alpha","hasColors","index","Float32Array","BufferGeometry","vertices","normals","face","start","normalX","getFloat32","normalY","normalZ","packedColor","getUint16","vertexstart","componentIdx","setAttribute","BufferAttribute","parseBinary","patternSolid","patternFace","faceCounter","patternFloat","source","patternVertex","RegExp","patternNormal","normal","groupCount","startVertex","endVertex","exec","vertexCountPerFace","normalCountPerFace","x","y","z","count","addGroup","Float32BufferAttribute","parseASCII","decodeText","$7f99d0845977052a$export$ce4e0fe932362815","text1","getElementsByTagName","xml","array","childNodes","parseStrings","parts","parseFloats","parseInts","parseInt","parseId","substring","isEmpty","object","keys","parseAssetUnit","undefined","parseAssetUpAxis","textContent","parseLibrary","libraryName","parser","library","elements","buildLibrary","builder","build","getBuild","parseAnimationSampler","inputs","nodeType","id","semantic","parseAnimationChannel","shift","sid","arraySyntax","indexOf","memberSyntax","member","indices","sampler","buildAnimation","tracks","channels","samplers","sources","hasOwnProperty","channel","inputId","INPUT","outputId","OUTPUT","createKeyframeTracks","buildAnimationChannel","getAnimation","library1","animations","inputSource","outputSource","nodes","object3D","getNode","transform","transforms","defaultMatrix","matrix","clone","transpose","time","stride","jl","value","warn","keyframes","sort","ascending","transformAnimationData","a","prepareAnimationData","uuid","position1","animation","times","positionData","quaternionData","scaleData","keyframe","matrix1","fromArray","decompose","w","VectorKeyframeTrack","QuaternionKeyframeTrack","property","defaultValue","empty","prev","next","getPrev","getNext","interpolate","createMissingKeyframes","key","buildAnimationClip","duration","end","animationTracks","AnimationClip","getAnimationClip","clips","parseSkin","bindShapeMatrix","parseSource","parseJoints","vertexWeights","parseVertexWeights","vcount","buildController","geometries","skin","BONE_LIMIT","weights","jointOffset","JOINT","weightOffset","WEIGHT","jointSource","inverseSource","INV_BIND_MATRIX","jointCount","vertexSkinData","skinIndex","skinWeight","weight","descending","d","bindMatrix","Matrix4","boneInverse","buildSkin","skinIndices","skinWeights","buildImage","init_from","getImage","images","parseEffectProfileCOMMON","surfaces","parseEffectNewparam","technique","parseEffectTechnique","extra","parseEffectExtra","parseEffectSurface","parseEffectSampler","parameters","parseEffectParameters","parseEffectParameter","opaque","parseEffectParameterTexture","parseEffectParameterTextureExtra","parseEffectParameterTextureExtraTechnique","toUpperCase","parseEffectExtraTechniqueBump","parseEffectExtraTechnique","texcoord","buildEffect","buildMaterial","effect","effects","technique1","profile","MeshLambertMaterial","MeshBasicMaterial","getTexture","textureObject","image","extension","slice","lastIndexOf","tgaLoader","textureLoader","getTextureLoader","texture","wrapS","wrapU","RepeatWrapping","ClampToEdgeWrapping","wrapT","wrapV","offsetU","offsetV","repeat","repeatU","repeatV","parameter","specular","specularMap","normalMap","lightMap","float","shininess","emissive","emissiveMap","transparency","techniques","k","side","DoubleSide","FrontSide","normalScale","Vector2","getMaterial","parseCameraOptics","parseCameraTechnique","parseCameraParameters","buildCamera","camera","optics","PerspectiveCamera","yfov","aspect_ratio","znear","zfar","ymag","xmag","aspectRatio","OrthographicCamera","getCamera","cameras","parseLightTechnique","parseLightParameters","Color","falloffAngle","f","distance","sqrt","buildLight","light","DirectionalLight","PointLight","SpotLight","AmbientLight","getLight","lights","accessor","parseGeometryVertices","parseGeometryPrimitive","primitive","hasUV","inputname","max","p","checkUVCoordinates","primitives","uvsNeedsFix","buildGeometry","groupedPrimitives","groupPrimitives","primitiveType","buildGeometryType","uv","uv2","materialKeys","vc","input","prevLength","buildGeometryData","isColor","pushVector","sourceStride","sourceArray","startIndex","tempColor","kl","getGeometry","buildKinematicsModel","parseKinematicsTechniqueCommon","parseKinematicsJoint","parseKinematicsLink","parseKinematicsJointParameter","limits","min","static","zeroPosition","middlePosition","attachments","parseKinematicsAttachment","parseKinematicsTransform","pop","angle","MathUtils","degToRad","parsePhysicsRigidBody","parsePhysicsTechniqueCommon","inertia","mass","parseKinematicsBindJointAxis","param","tmpJointIndex","jointIndex","buildKinematicsScene","buildTransformList","collada","vector","vector1","parseNode","instanceCameras","instanceControllers","instanceLights","instanceGeometries","instanceNodes","parseNodeInstance","makeTranslation","makeRotationAxis","log","hasNode","skeletons","instances","instance","symbol","buildSkeleton","boneData","sortedBoneData","skeleton","buildBoneHierarchy","visualScenes","bone","processed","bones","boneInverses","Skeleton","isBone","buildNode","objects","i2","l1","instanceCamera","i3","l2","controller","controllers","newObjects","buildObjects","isSkinnedMesh","normalizeSkinWeights","i4","l3","instanceLight","i5","l4","i6","l5","Bone","Group","fallbackMaterial","resolveMaterialBinding","instanceMaterials","LineBasicMaterial","skinning","attributes","LineSegments","Line","SkinnedMesh","buildVisualScene","getVisualScene","scene","Scene","xml1","DOMParser","parserError1","errorElement","errorText","parserError","stack","Node","TEXT_NODE","apply","parserErrorToText","version","asset","unit","upAxis","resourcePath","setCrossOrigin","crossOrigin","$iVtfO","TGALoader","animations1","kinematics","count1","kinematicsModels","physicsModels","kinematicsScenes","parseAnimation","hasChildren","generateUUID","mesh","element","prepareNodes","rigidBodies","bindJointAxis","setupAnimations","kinematicsModelId","kinematicsSceneId","visualSceneId","kinematicsModel","kinematicsScene","getKinematicsScene","visualScene","i1","targetElement","parentVisualElement","parentElement","connect","visualElement","visualElementName","m0","getJointValue","jointData","setupKinematics","parseScene","multiplyScalar","$dc743e2081fd10a7$export$f133a99b4c3153a","DataTextureLoader","TGA_TYPE_NO_DATA","TGA_TYPE_INDEXED","TGA_TYPE_RGB","TGA_TYPE_GREY","TGA_TYPE_RLE_INDEXED","TGA_TYPE_RLE_RGB","TGA_TYPE_RLE_GREY","TGA_ORIGIN_MASK","TGA_ORIGIN_SHIFT","TGA_ORIGIN_BL","TGA_ORIGIN_BR","TGA_ORIGIN_UL","TGA_ORIGIN_UR","offset1","content","header1","id_length","colormap_type","image_type","colormap_index","colormap_length","colormap_size","origin","width","height","pixel_size","flags","header","tgaCheckHeader","use_rle1","use_pal1","use_grey","imageData1","use_rle","use_pal","pixel_data","palettes","pixel_total","subarray","pixels","tgaParse","palette","x_start","y_start","x_step","y_step","x_end","y_end","imageData","tgaGetImageDataGrey8bits","tgaGetImageDataGrey16bits","colormap","tgaGetImageData8bits","tgaGetImageData16bits","tgaGetImageData24bits","tgaGetImageData32bits","getTgaRGBA","flipY","generateMipmaps","minFilter","LinearMipmapLinearFilter","$2671d175603a2bfb$var$URDFBase","Object3D","args","urdfNode","recursive","$2671d175603a2bfb$export$96148412cb4c79c1","isURDFCollider","$2671d175603a2bfb$export$344798c61faaed1d","isURDFVisual","$2671d175603a2bfb$export$57ce561fd28b62ce","isURDFLink","$2671d175603a2bfb$export$f821a5e904506851","_jointType","matrixWorldNeedsUpdate","jointValue","fill","isURDFJoint","ignoreLimits","origPosition","origQuaternion","didUpdate","updateFromMimickedJoint","setFromAxisAngle","premultiply","pos","addScaledVector","$2671d175603a2bfb$export$d1c279877ffff143","modifiedValues","$2671d175603a2bfb$export$3b6eeb5211e1c44","isURDFRobot","colliders","visual","getFrame","jointName","setJointValues","didChange","$90f2285487609b00$export$20d4cdea3605edba","$46e2R","XacroParser","$dWajn","getUrlBase","getFileContents","$a258b0ce13bc87d4$export$808f821920713542","tokens","join","$a258b0ce13bc87d4$export$d4e3728d787f4318","tagName","$a258b0ce13bc87d4$export$b7d58db314e0ac27","stripPropsMacros","cloned","cloneNode","appendChild","$a258b0ce13bc87d4$export$9ac9d97bb14e572","arr","el","ELEMENT_NODE","$a258b0ce13bc87d4$export$4e40859592ee7ac2","str","$a258b0ce13bc87d4$export$844ec244b1367d54","$a258b0ce13bc87d4$export$7e4aa119212bc614","isNaN","$a258b0ce13bc87d4$export$660b2ee2d4fb4eff","$a258b0ce13bc87d4$export$ea098e0ad93a8b80","positive","$a258b0ce13bc87d4$export$f3c94b0efd66345b","Symbol","$a258b0ce13bc87d4$export$2c0d50a82a0126d6","$a258b0ce13bc87d4$export$4183f2c8c900e548","properties","$2fc29e02cf53df74$export$95de28ea7d6fc1fe","inOrder","requirePrefix","localProperties","evaluateAttribute","str1","properties1","finalValue","allProps","mergePropertySets","globalProperties","unpackParams","match","isRospackCommand","contents","includes","operators","expr","tokenize","t","lastIndex","isOperator","isNumber","isString","arg","toString","cleanExpr","normalizeExpression","handleExpressionEvaluation","stem","handleRospackCommand","message","brace","parseMacro","params","inputMap","s","def","parseMacroParam","inp","deepClone","processNode","macros","resultsList","removeEndCommentsFromArray","PARENT_SCOPE","macro","bool","currWorkingPath","prevWorkingPath","loadInclude","macroName","ogProperties","ogMacros","createNewPropertyScope","c2","blockCount","macroChildren","c1","evaluateMacro","attr","resultChildren","gatherPropertiesAndMacros","propertyEl","getElementsWithName","el1","macroEl","el2","scope1","loadIncludes","results","includeEl","promises","namespace","all","workingPath1","globalMacros","includeMap","True","False","$5NdfP","evaluateExpression","content1","inOrderPromise","inc","removeAttribute","processXacro","$437bcf6535dc9392$var$parser","Parser","$437bcf6535dc9392$export$3191fa0ae67b450c","evaluate","unaryOps","functions","sin","cos","tan","asin","acos","atan","atan2","pow","radians","degrees","binaryOps","Number","in","consts","pi","E","$59b260dcf264c202$var$INUMBER","$59b260dcf264c202$var$IOP1","$59b260dcf264c202$var$IOP2","$59b260dcf264c202$var$IOP3","$59b260dcf264c202$var$IVAR","$59b260dcf264c202$var$IVARNAME","$59b260dcf264c202$var$IFUNCALL","$59b260dcf264c202$var$IFUNDEF","$59b260dcf264c202$var$IEXPR","$59b260dcf264c202$var$IEXPREVAL","$59b260dcf264c202$var$IMEMBER","$59b260dcf264c202$var$IENDSTATEMENT","$59b260dcf264c202$var$IARRAY","$59b260dcf264c202$var$Instruction","$59b260dcf264c202$var$unaryInstruction","$59b260dcf264c202$var$binaryInstruction","$59b260dcf264c202$var$ternaryInstruction","$59b260dcf264c202$var$simplify","ternaryOps","n1","n2","n3","nstack","newexpression","item","concat","$59b260dcf264c202$var$substitute","variable","replitem","expritem","$59b260dcf264c202$var$evaluate","n11","n21","f1","args1","argCount1","$59b260dcf264c202$var$isExpressionEvaluator","$59b260dcf264c202$var$resolveExpression","numTokens","isOperatorEnabled","unshift","call","argCount","assign","len","arguments","defineProperty","writable","$59b260dcf264c202$var$createExpressionEvaluator","token","$59b260dcf264c202$var$expressionToString","toJS","$59b260dcf264c202$var$escapeValue","String","JSON","stringify","$59b260dcf264c202$var$contains","$59b260dcf264c202$var$getSymbols","symbols","options","withMembers","prevVar","$59b260dcf264c202$export$bfe37c1342e5eb83","prototype","simplify","substitute","vars","variables","toJSFunction","$59b260dcf264c202$var$TEOF","$59b260dcf264c202$var$TOP","$59b260dcf264c202$var$TNUMBER","$59b260dcf264c202$var$TSTRING","$59b260dcf264c202$var$TPAREN","$59b260dcf264c202$var$TBRACKET","$59b260dcf264c202$var$TCOMMA","$59b260dcf264c202$var$TNAME","$59b260dcf264c202$var$TSEMICOLON","$59b260dcf264c202$var$Token","$59b260dcf264c202$var$TokenStream","expression","current","savedPosition","savedCurrent","newToken","save","restore","isWhitespace","isComment","isRadixInteger","isParen","isBracket","isComma","isSemicolon","isNamedOp","isConst","isName","parseError","charAt","startPos","quote","rawString","unescape","hasLetter","$59b260dcf264c202$var$codePointPattern","$59b260dcf264c202$var$ParserState","tokenStream","nextToken","savedNextToken","allowMemberAccess","codePoint","fromCharCode","backslash","radix","validDigit","valid","resetPos","foundDot","foundDigits","acceptSign","validExponent","op","getCoordinates","column","line","newline","msg","coords","tokenMatches","accept","expect","parseAtom","instr","parseExpression","parseArrayList","exprInstr","parseUntilEndStatement","parseVariableAssignmentExpression","pushExpression","parseConditionalExpression","varName","varValue","lastInstrIndex","parseOrExpression","trueBranch","falseBranch","parseAndExpression","parseComparison","$59b260dcf264c202$var$COMPARISON_OPERATORS","parseAddSub","$59b260dcf264c202$var$ADD_SUB_OPERATORS","parseTerm","$59b260dcf264c202$var$TERM_OPERATORS","$59b260dcf264c202$var$add","$59b260dcf264c202$var$sub","$59b260dcf264c202$var$mul","$59b260dcf264c202$var$div","$59b260dcf264c202$var$mod","$59b260dcf264c202$var$concat","$59b260dcf264c202$var$equal","$59b260dcf264c202$var$notEqual","$59b260dcf264c202$var$greaterThan","$59b260dcf264c202$var$lessThan","$59b260dcf264c202$var$greaterThanEqual","$59b260dcf264c202$var$lessThanEqual","$59b260dcf264c202$var$andOperator","Boolean","$59b260dcf264c202$var$orOperator","$59b260dcf264c202$var$inOperator","$59b260dcf264c202$var$sinh","exp","$59b260dcf264c202$var$cosh","$59b260dcf264c202$var$tanh","Infinity","$59b260dcf264c202$var$asinh","$59b260dcf264c202$var$acosh","$59b260dcf264c202$var$atanh","$59b260dcf264c202$var$log10","LOG10E","$59b260dcf264c202$var$neg","$59b260dcf264c202$var$not","$59b260dcf264c202$var$trunc","ceil","floor","$59b260dcf264c202$var$random","random","$59b260dcf264c202$var$factorial","$59b260dcf264c202$var$gamma","parseFactor","parseExponential","parsePostfixExpression","parseFunctionCall","parseMemberExpression","parseArgumentList","$59b260dcf264c202$var$GAMMA_P","isFinite","round","$59b260dcf264c202$var$isInteger","NaN","twoN","threeN","fourN","fiveN","$59b260dcf264c202$var$stringOrArrayLength","$59b260dcf264c202$var$hypot","sum","larg","div","abs","$59b260dcf264c202$var$condition","cond","yep","nope","$59b260dcf264c202$var$roundTo","$59b260dcf264c202$var$setVar","$59b260dcf264c202$var$arrayIndex","$59b260dcf264c202$var$max","$59b260dcf264c202$var$min","$59b260dcf264c202$var$arrayMap","$59b260dcf264c202$var$arrayFold","init","reduce","acc","$59b260dcf264c202$var$arrayFilter","$59b260dcf264c202$var$stringOrArrayIndexOf","$59b260dcf264c202$var$arrayJoin","sep","$59b260dcf264c202$var$sign","$59b260dcf264c202$var$ONE_THIRD","$59b260dcf264c202$var$cbrt","$59b260dcf264c202$var$expm1","$59b260dcf264c202$var$log1p","$59b260dcf264c202$var$log2","LN2","$59b260dcf264c202$export$7acfa6ed01010e37","sinh","cosh","tanh","asinh","acosh","atanh","cbrt","log2","ln","lg","log10","expm1","log1p","trunc","not","sign","and","or","fac","hypot","pyt","if","gamma","roundTo","fold","true","false","parserState","$59b260dcf264c202$var$sharedParser","$59b260dcf264c202$var$optionNameMap","optionName","$59b260dcf264c202$var$getOptionName"],"version":3,"file":"index.3b69dfe7.js.map"}